{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\u200b\\-]"},"docs":[{"location":"","text":"F5 CIS-C \u00b6 \u6b22\u8fce\u4f7f\u7528CIS-C\u3002 F5 CIS-C\uff08Container Ingress Service for China Market, \u955c\u50cf\u540d\u79f0\uff1ak8s-bigip-ctlr-c\uff09\u662f\u4e00\u6b3e\u5c06Kubernetes\u96c6\u7fa4\u5185\u670d\u52a1\u901a\u8fc7F5 BIG-IP\u8fdb\u884c\u81ea\u52a8\u5316\u53d1\u5e03\u7684\u63a7\u5236\u5668\u8f6f\u4ef6\u3002\u5e2e\u52a9\u7528\u6237\u6253\u901aKubernetes\u96c6\u7fa4\u4e0e\u5916\u90e8\u5165\u53e3\uff0c\u5c06BIG-IP\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u96c6\u6210\u5230kubernetes\u6280\u672f\u6808\u7684\u4e91\u73af\u5883\u4e2d\u3002\u5b83\u5b9e\u73b0\u4e86\u591a\u56e2\u961f\u5408\u4f5c\uff0c\u5ba2\u6237\u53ef\u4ee5\u7075\u6d3b\u7684\u3001\u81ea\u52a8\u5316\u7684\u521b\u5efa\u3001\u53d8\u66f4\u5e94\u7528\u6216\u8005\u670d\u52a1\u5165\u53e3\u7b56\u7565\uff0c\u53ef\u6709\u6548\u4fc3\u8fdb\u4f01\u4e1a\u4e91\u539f\u751f\u67b6\u6784\u8f6c\u578b\u3002 F5 CIS-C\u4e2d\u7684 -C \u4ee3\u8868\u9762\u5411\u4e2d\u56fd\u5e02\u573a\uff0c\u4ee3\u8868\u53ef\u5b9a\u5236\u3002\u5b83\u4e5f\u662fF5 CIS \uff08\u5168\u7403\u65b9\u6848\uff09 \u7684\u6027\u80fd\u589e\u5f3a\u7248\u672c\u3002 \u5173\u4e8e\u4ea7\u54c1\u7684\u4efb\u4f55\u5efa\u8bae\u4e0e\u95ee\u9898\uff0c\u8bf7 \u8054\u7cfb\u6211\u4eec \u3002 \u70b9\u51fb \u8fd9\u91cc \u7acb\u5373\u67e5\u770b\u6700\u65b0\u7248\u672c\u53d1\u5e03","title":"\u4e3b\u9875"},{"location":"#f5-cis-c","text":"\u6b22\u8fce\u4f7f\u7528CIS-C\u3002 F5 CIS-C\uff08Container Ingress Service for China Market, \u955c\u50cf\u540d\u79f0\uff1ak8s-bigip-ctlr-c\uff09\u662f\u4e00\u6b3e\u5c06Kubernetes\u96c6\u7fa4\u5185\u670d\u52a1\u901a\u8fc7F5 BIG-IP\u8fdb\u884c\u81ea\u52a8\u5316\u53d1\u5e03\u7684\u63a7\u5236\u5668\u8f6f\u4ef6\u3002\u5e2e\u52a9\u7528\u6237\u6253\u901aKubernetes\u96c6\u7fa4\u4e0e\u5916\u90e8\u5165\u53e3\uff0c\u5c06BIG-IP\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u96c6\u6210\u5230kubernetes\u6280\u672f\u6808\u7684\u4e91\u73af\u5883\u4e2d\u3002\u5b83\u5b9e\u73b0\u4e86\u591a\u56e2\u961f\u5408\u4f5c\uff0c\u5ba2\u6237\u53ef\u4ee5\u7075\u6d3b\u7684\u3001\u81ea\u52a8\u5316\u7684\u521b\u5efa\u3001\u53d8\u66f4\u5e94\u7528\u6216\u8005\u670d\u52a1\u5165\u53e3\u7b56\u7565\uff0c\u53ef\u6709\u6548\u4fc3\u8fdb\u4f01\u4e1a\u4e91\u539f\u751f\u67b6\u6784\u8f6c\u578b\u3002 F5 CIS-C\u4e2d\u7684 -C \u4ee3\u8868\u9762\u5411\u4e2d\u56fd\u5e02\u573a\uff0c\u4ee3\u8868\u53ef\u5b9a\u5236\u3002\u5b83\u4e5f\u662fF5 CIS \uff08\u5168\u7403\u65b9\u6848\uff09 \u7684\u6027\u80fd\u589e\u5f3a\u7248\u672c\u3002 \u5173\u4e8e\u4ea7\u54c1\u7684\u4efb\u4f55\u5efa\u8bae\u4e0e\u95ee\u9898\uff0c\u8bf7 \u8054\u7cfb\u6211\u4eec \u3002 \u70b9\u51fb \u8fd9\u91cc \u7acb\u5373\u67e5\u770b\u6700\u65b0\u7248\u672c\u53d1\u5e03","title":"F5 CIS-C"},{"location":"Architecture/","text":"\u4ea7\u54c1\u67b6\u6784\u4ecb\u7ecd \u00b6 F5 CIS-C\u7a0b\u5e8f\u76d1\u63a7K8s\u4e2dConfigmap\uff08\u5305\u542bAS3\u6a21\u677f\u683c\u5f0f\u7684\u4ea4\u4ed8\u914d\u7f6e\uff09\u548cEndpoints\u8d44\u6e90\uff08\u5305\u542b\u5ba2\u6237\u5e94\u7528\u670d\u52a1\u4fe1\u606f\uff09\uff0c\u5c06\u5176\u8f6c\u6362\u5e76\u4e0b\u53d1\u4e3aBIG-IP\u4e0a\u7684\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u3002\u4e4b\u540e\uff0cBIG-IP\u4f5c\u4e3a\u5ba2\u6237\u7684\u5e94\u7528\u670d\u52a1\u5165\u53e3\uff0c\u63d0\u4f9bL4-L7\u7684\u4e1a\u52a1\u53ca\u6d41\u91cf\u7684\u7ba1\u63a7\u3002 \u5de5\u4f5c\u6a21\u578b\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6240\u91c7\u7528\u7684\u6280\u672f\u6808\u5305\u62ec\uff1a","title":"\u6574\u4f53\u67b6\u6784"},{"location":"Architecture/#_1","text":"F5 CIS-C\u7a0b\u5e8f\u76d1\u63a7K8s\u4e2dConfigmap\uff08\u5305\u542bAS3\u6a21\u677f\u683c\u5f0f\u7684\u4ea4\u4ed8\u914d\u7f6e\uff09\u548cEndpoints\u8d44\u6e90\uff08\u5305\u542b\u5ba2\u6237\u5e94\u7528\u670d\u52a1\u4fe1\u606f\uff09\uff0c\u5c06\u5176\u8f6c\u6362\u5e76\u4e0b\u53d1\u4e3aBIG-IP\u4e0a\u7684\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u3002\u4e4b\u540e\uff0cBIG-IP\u4f5c\u4e3a\u5ba2\u6237\u7684\u5e94\u7528\u670d\u52a1\u5165\u53e3\uff0c\u63d0\u4f9bL4-L7\u7684\u4e1a\u52a1\u53ca\u6d41\u91cf\u7684\u7ba1\u63a7\u3002 \u5de5\u4f5c\u6a21\u578b\u5982\u4e0b\u56fe\u6240\u793a\uff1a \u6240\u91c7\u7528\u7684\u6280\u672f\u6808\u5305\u62ec\uff1a","title":"\u4ea7\u54c1\u67b6\u6784\u4ecb\u7ecd"},{"location":"Architecture/as3/","text":"AS3\u5185\u5bb9\u914d\u7f6e\u6307\u5f15 \u00b6 \u7528\u6237\u7684\u4e1a\u52a1\u914d\u7f6e\u901a\u8fc7configmap\u65b9\u5f0f\u4ea4\u4ed8\u7ed9CIS-C\u5b8c\u6210\u4e1a\u52a1\u4e0b\u53d1\uff0cconfigmap\u4e2d\u7684\u5185\u5bb9\u683c\u5f0f\u4e3a AS3 JSON\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e00\u70b9\u4e0eCIS configmap\u6a21\u5f0f\u4e00\u81f4\u3002 \u4e0eCIS\u4e0d\u540c\u7684\u662f\uff0cCIS-C\u4e3a\u8ffd\u6c42\u4e0b\u53d1\u6027\u80fd\uff0c\u5728\u7a0b\u5e8f\u5185\u90e8\u5b9e\u73b0\u4e86AS3\u683c\u5f0f\u7684\u89e3\u6790\uff0c\u7136\u540e\u901a\u8fc7iControlRest\u65b9\u5f0f\u5b8c\u6210\u914d\u7f6e\u4e0b\u53d1\u3002CIS\u5219\u662f\u4f9d\u9760\u8fd0\u884c\u4e8eBIG-IP\u4e0a\u7684AS3 iApp\u7a0b\u5e8f\u5b8c\u6210\u914d\u7f6e\u89e3\u6790\u3001\u4e0b\u53d1\u3002 \u968f\u7740CIS-C\u9879\u76ee\u7684\u63a8\u8fdb\u548c\u5ba2\u6237\u9700\u6c42\u7684\u589e\u52a0\uff0cCIS-C\u5bf9AS3\u683c\u5f0f\u7684\u89e3\u6790\u80fd\u529b\u548c\u8303\u56f4\u4f1a\u4e0d\u65ad\u5b8c\u5584\u3001\u4e30\u5bcc\u3002 \u76ee\u524d\uff0cCIS-C\u652f\u6301\u7684AS3\u7c7b\u578b\u548cAS3\u5b57\u6bb5\uff0c\u5982\u4e0b\u8868\u6240\u793a\u3002 \u5982\u9700\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u201cAS3\u7c7b\u578b\u201d\u548c\u5404\u4e2a\u201cAS3\u5b57\u6bb5\u201d\u7684\u542b\u4e49\uff0c\u8bf7\u53c2\u8003\uff1aAS3\u5b98\u7f51 Schema\u5b9a\u4e49 \u3002 AS3\u7c7b\u578b AS3\u5b57\u6bb5\u96c6\u5408 AS3 ['declaration'] ADC [] Application ['template'] Tenant [] Service_HTTP ['virtualAddresses', 'virtualPort', 'profileHTTP', 'persistenceMethods', 'iRules', 'pool', 'serviceDownImmediateAction', 'snat', 'profileMultiplex', 'profileTCP'] Service_TCP ['virtualPort', 'virtualAddresses', 'profileTCP', 'pool', 'snat', 'serviceDownImmediateAction', 'profileFTP'] Service_HTTPS ['virtualAddresses', 'redirect80', 'serverTLS', 'pool', 'virtualPort', 'clientTLS', 'profileHTTP', 'profileMultiplex', 'iRules'] Service_Address ['virtualAddress', 'arpEnabled'] Service_UDP ['virtualPort', 'virtualAddresses', 'profileUDP', 'pool', 'snat'] Service_L4 ['virtualAddresses', 'virtualPort', 'layer4', 'persistenceMethods', 'profileL4', 'pool'] HTTP_Profile ['xForwardedFor', 'insertHeader', 'hstsPeriod', 'headerErase', 'fallbackRedirect', 'fallbackStatusCodes'] Multiplex_Profile ['sourceMask', 'maxConnectionReuse', 'maxConnections', 'maxConnectionAge', 'idleTimeoutOverride', 'connectionLimitEnforcement'] TCP_Profile ['idleTimeout'] UDP_Profile ['idleTimeout', 'datagramLoadBalancing'] FTP_Profile ['remark', 'port', 'ftpsMode', 'enforceTlsSessionReuseEnabled', 'activeModeEnabled', 'securityEnabled', 'translateExtendedEnabled', 'inheritParentProfileEnabled'] Pool ['monitors', 'minimumMonitors', 'members', 'minimumMembersActive', 'loadBalancingMode'] iRule ['remark', 'iRule'] Persist ['persistenceMethod', 'encrypt', 'cookieMethod', 'passphrase', 'hashAlgorithm', 'addressMask', 'duration'] Monitor ['monitorType', 'send', 'interval', 'timeout', 'receive'] SNAT_Pool ['snatAddresses'] TLS_Server ['certificates', 'authenticationMode', 'authenticationFrequency', 'authenticationTrustCA'] Certificate ['remark', 'certificate', 'privateKey', 'passphrase', 'chainCA'] CA_Bundle ['bundle'] TLS_Client ['trustCA', 'sendSNI', 'ciphers', 'serverName', 'validateCertificate', 'ignoreExpired', 'ignoreUntrusted', 'sessionTickets', 'clientCertificate'] \u53c2\u8003 < \u4ee3\u7801\u5e93> tests/funcs/test.automation/collect_types.py \u81ea\u52a8\u751f\u6210\u8be5\u8868\u683c\u3002","title":"AS3\u53c2\u8003"},{"location":"Architecture/as3/#as3","text":"\u7528\u6237\u7684\u4e1a\u52a1\u914d\u7f6e\u901a\u8fc7configmap\u65b9\u5f0f\u4ea4\u4ed8\u7ed9CIS-C\u5b8c\u6210\u4e1a\u52a1\u4e0b\u53d1\uff0cconfigmap\u4e2d\u7684\u5185\u5bb9\u683c\u5f0f\u4e3a AS3 JSON\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e00\u70b9\u4e0eCIS configmap\u6a21\u5f0f\u4e00\u81f4\u3002 \u4e0eCIS\u4e0d\u540c\u7684\u662f\uff0cCIS-C\u4e3a\u8ffd\u6c42\u4e0b\u53d1\u6027\u80fd\uff0c\u5728\u7a0b\u5e8f\u5185\u90e8\u5b9e\u73b0\u4e86AS3\u683c\u5f0f\u7684\u89e3\u6790\uff0c\u7136\u540e\u901a\u8fc7iControlRest\u65b9\u5f0f\u5b8c\u6210\u914d\u7f6e\u4e0b\u53d1\u3002CIS\u5219\u662f\u4f9d\u9760\u8fd0\u884c\u4e8eBIG-IP\u4e0a\u7684AS3 iApp\u7a0b\u5e8f\u5b8c\u6210\u914d\u7f6e\u89e3\u6790\u3001\u4e0b\u53d1\u3002 \u968f\u7740CIS-C\u9879\u76ee\u7684\u63a8\u8fdb\u548c\u5ba2\u6237\u9700\u6c42\u7684\u589e\u52a0\uff0cCIS-C\u5bf9AS3\u683c\u5f0f\u7684\u89e3\u6790\u80fd\u529b\u548c\u8303\u56f4\u4f1a\u4e0d\u65ad\u5b8c\u5584\u3001\u4e30\u5bcc\u3002 \u76ee\u524d\uff0cCIS-C\u652f\u6301\u7684AS3\u7c7b\u578b\u548cAS3\u5b57\u6bb5\uff0c\u5982\u4e0b\u8868\u6240\u793a\u3002 \u5982\u9700\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u201cAS3\u7c7b\u578b\u201d\u548c\u5404\u4e2a\u201cAS3\u5b57\u6bb5\u201d\u7684\u542b\u4e49\uff0c\u8bf7\u53c2\u8003\uff1aAS3\u5b98\u7f51 Schema\u5b9a\u4e49 \u3002 AS3\u7c7b\u578b AS3\u5b57\u6bb5\u96c6\u5408 AS3 ['declaration'] ADC [] Application ['template'] Tenant [] Service_HTTP ['virtualAddresses', 'virtualPort', 'profileHTTP', 'persistenceMethods', 'iRules', 'pool', 'serviceDownImmediateAction', 'snat', 'profileMultiplex', 'profileTCP'] Service_TCP ['virtualPort', 'virtualAddresses', 'profileTCP', 'pool', 'snat', 'serviceDownImmediateAction', 'profileFTP'] Service_HTTPS ['virtualAddresses', 'redirect80', 'serverTLS', 'pool', 'virtualPort', 'clientTLS', 'profileHTTP', 'profileMultiplex', 'iRules'] Service_Address ['virtualAddress', 'arpEnabled'] Service_UDP ['virtualPort', 'virtualAddresses', 'profileUDP', 'pool', 'snat'] Service_L4 ['virtualAddresses', 'virtualPort', 'layer4', 'persistenceMethods', 'profileL4', 'pool'] HTTP_Profile ['xForwardedFor', 'insertHeader', 'hstsPeriod', 'headerErase', 'fallbackRedirect', 'fallbackStatusCodes'] Multiplex_Profile ['sourceMask', 'maxConnectionReuse', 'maxConnections', 'maxConnectionAge', 'idleTimeoutOverride', 'connectionLimitEnforcement'] TCP_Profile ['idleTimeout'] UDP_Profile ['idleTimeout', 'datagramLoadBalancing'] FTP_Profile ['remark', 'port', 'ftpsMode', 'enforceTlsSessionReuseEnabled', 'activeModeEnabled', 'securityEnabled', 'translateExtendedEnabled', 'inheritParentProfileEnabled'] Pool ['monitors', 'minimumMonitors', 'members', 'minimumMembersActive', 'loadBalancingMode'] iRule ['remark', 'iRule'] Persist ['persistenceMethod', 'encrypt', 'cookieMethod', 'passphrase', 'hashAlgorithm', 'addressMask', 'duration'] Monitor ['monitorType', 'send', 'interval', 'timeout', 'receive'] SNAT_Pool ['snatAddresses'] TLS_Server ['certificates', 'authenticationMode', 'authenticationFrequency', 'authenticationTrustCA'] Certificate ['remark', 'certificate', 'privateKey', 'passphrase', 'chainCA'] CA_Bundle ['bundle'] TLS_Client ['trustCA', 'sendSNI', 'ciphers', 'serverName', 'validateCertificate', 'ignoreExpired', 'ignoreUntrusted', 'sessionTickets', 'clientCertificate'] \u53c2\u8003 < \u4ee3\u7801\u5e93> tests/funcs/test.automation/collect_types.py \u81ea\u52a8\u751f\u6210\u8be5\u8868\u683c\u3002","title":"AS3\u5185\u5bb9\u914d\u7f6e\u6307\u5f15"},{"location":"Architecture/parameters/","text":"\u542f\u52a8\u53c2\u6570 \u00b6 \u7a0b\u5e8f\u7ec4\u6210\u4e0e\u4ea4\u4ed8\u65b9\u5f0f \u00b6 CIS-C\u7a0b\u5e8f\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a Golang\u7a0b\u5e8f\uff1a\u57fa\u4e8ek8s client-go \uff0c\u5c01\u88c5\u4e86BIG-IP iControlRest \u3002 \u4ea4\u4ed8\u65b9\u5f0f\uff1adocker image f5devcentral/k8s-bigip-ctlr-c \u3002 \u542f\u52a8\u53c2\u6570\uff1a\u89c1 \u542f\u52a8\u53c2\u6570\u89e3\u6790 \u90e8\u5206\u9610\u8ff0\u3002 NodeJS\u7a0b\u5e8f\uff1a\u57fa\u4e8eAS3\u5373 F5Networks/f5-appsvcs-extension \uff0c\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u62bd\u53d6\u4e86AS3\u7a0b\u5e8f\u7684\u89e3\u6790\u903b\u8f91\u90e8\u5206\uff0c\u5b9e\u73b0\u4e3a\u4e00\u4e2a\u670d\u52a1(webservice)\u3002 \u4ea4\u4ed8\u65b9\u5f0f\uff1adocker image f5devcentral/cis-c-as3-parser \u3002 \u542f\u52a8\u53c2\u6570\uff1a\u65e0 \u542f\u52a8\u53c2\u6570\u89e3\u6790 \u00b6 CIS-C\u5b89\u88c5\u90e8\u7f72\u65b9\u5f0f\uff0c\u53ef\u53c2\u89c1\u201c \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u201d\u63cf\u8ff0\u3002\u8fd9\u91cc\u8be6\u7ec6\u9610\u8ff0\u4e0bGoLang\u7a0b\u5e8f\u7684\u542f\u52a8\u53c2\u6570\u3002 --as3-service string \u53ef\u9009\uff0c\u7528\u4e8e\u6307\u5b9aNodeJS\u7a0b\u5e8f\u5165\u53e3\uff0c\u9ed8\u8ba4\u4e3a http://localhost:8081 \u3002 --bigip-url string \u53ef\u9009\uff0cBig-IP\u7684web\u7ba1\u7406\u5730\u5740\u3002 \u5982: https://10.10.10.10:8443 \u3002 --bigip-username string \u53ef\u9009\uff0cBig-IP\u7528\u6237\u7684\u8d26\u53f7\u540d\uff0c\u9ed8\u8ba4\u4e3a admin \u3002 --bigip-password string \u53ef\u9009\uff0cBig-IP \u76f8\u5e94\u8d26\u53f7\u7684\u5bc6\u7801\u3002 --credentials-directory string \u53ef\u9009\u3002\u8be5\u76ee\u5f55\u91cc\u5305\u542b\u4e09\u4e2a\u6587\u4ef6\u3002\u6587\u4ef6\u540d\u5206\u522b\u4e3a \"username\", \"password\" \u548c \"url\"\uff0c\u5206\u522b\u5bf9\u5e94 BIGIP \u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\u548cURL\u3002 \u8fd9\u4e9b\u6587\u4ef6\u91cc\u7684\u5185\u5bb9\u6bd4\u4f20\u5165\u7684 --bigip-url,--bigip-username \u6216 --bigip-password \u53c2\u6570\u4f18\u5148\u7ea7\u66f4\u9ad8. \u4f7f\u7528\u65b9\u5f0f\u53c2\u8003 \u201c \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u201d \u4e2d\u7684\u65b9\u5f0f2. --flannel-name string \u53ef\u9009\u3002\u9ed8\u8ba4\u503c\u4e3a \"\" (\u7a7a\u5b57\u7b26\u4e32)\u3002 \u82e5flannel-name\u4e0d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u793a\u8be5k8s\u7f51\u7edc\u73af\u5883\u4f7f\u7528ipv4 flannel \u573a\u666f. \u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684BIG-IP\u914d\u7f6e\u53c2\u89c1\u201c \u51c6\u5907\u5de5\u4f5c \u201d\u90e8\u5206\u63cf\u8ff0\u3002 --flannel-name-v6 string \u53ef\u9009\u3002\u9ed8\u8ba4\u503c\u4e3a \"\" (\u7a7a\u5b57\u7b26\u4e32)\u3002 \u82e5flannel-name-v6\u4e0d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u793a\u8be5k8s\u7f51\u7edc\u73af\u5883\u4f7f\u7528ipv6 flannel \u573a\u666f. \u82e5flannel-name \u4e0e flannel-name-v6 \u540c\u65f6\u8bbe\u7f6e\uff0c\u5219\u610f\u5473\u7740\u73af\u5883\u4e3a v4 \u4e0e v6 \u5171\u5b58\u73af\u5883\u3002 \u82e5flannel-name \u4e0e flannel-name-v6 \u540c\u65f6\u4e3a\u7a7a\uff0c\u5219\u6807\u8bc6\u8be5\u73af\u5883\u4f7f\u7528calico\u3002 \u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684BIG-IP\u914d\u7f6e\u53c2\u89c1\u201c \u51c6\u5907\u5de5\u4f5c \u201d\u90e8\u5206\u63cf\u8ff0\u3002 --hub-mode \u53ef\u9009\uff0c boolean \u7c7b\u578b\uff0c\u6807\u8bc6CIS-C\u662f\u5426\u4f7f\u7528hub\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a false \u3002 hub\u6a21\u5f0f\u7684\u542b\u4e49\u53ca\u5904\u7406\u7ec6\u8282\u8bf7\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002 --ignore-service-port \u53ef\u9009\uff0c boolean \u7c7b\u578b\uff0c\u6807\u8bc6CIS-C\u5bf9\u4e1a\u52a1\u7aef\u53e3\u7684\u7ed1\u5b9a\u884c\u4e3a\uff1a\u5f53configmap\u4e2d\u914d\u7f6e\u4e2d servicePort \u4e0d\u5b58\u5728\u6216\u8005\u4e0e\u5b9e\u9645\u4e1a\u52a1\u4e0d\u5339\u914d\u65f6\uff0c\u662f\u5426\u7ed1\u5b9a\u5b9e\u9645\u4e1a\u52a1\u7b2c\u4e00\u7ec4\u7aef\u53e3\u3002\u9ed8\u8ba4\u4e3a false \u3002 --kube-config string \u96c6\u7fa4\u5916\u90e8\u7f72\u6a21\u5f0f\u4e0b\uff0c\u5fc5\u9009\u3002k8s\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u4f8b\u5982\uff1a~/.kube/config --log-level \u53ef\u9009\u3002\u8f93\u51fa\u65e5\u5fd7\u7684\u7ea7\u522b\uff0c\u53d6\u503c\u4e3a\uff1a debug , info , warn , error , \u9ed8\u8ba4\u4e3a info \u3002 --namespace string \u6807\u8bc6CIS-C\u5c06\u76d1\u542c\u7684namespace\u540d\u79f0\u3002 \u53ef\u4ee5\u591a\u6b21\u4f7f\u7528\u6b64\u53c2\u6570\uff0cCIS-C\u5c06\u76d1\u542c\u6240\u6709\u6307\u5b9a\u7684namespace\u5185\u7684\u8d44\u6e90\u53d8\u5316\u3002 \u8be5\u53c2\u6570\u53ef\u4e0e --namespace-label \u53c2\u6570\u6df7\u5408\u4f7f\u7528\uff0c\u6700\u7ec8\u88ab\u76d1\u63a7\u7684namespaces \u53d6\u4e24\u8005\u5408\u96c6\u3002 \u5982\u679c --namespace \u548c --namespace-label \u5747\u672a\u88ab\u4f7f\u7528\uff0c\u5219\u6240\u6709namespace\u4e0b\u7684\u8d44\u6e90\u90fd\u4f1a\u88ab\u76d1\u63a7\u3002 \u5f53\u4e0e --hub-mode \u53c2\u6570\u8054\u7528\u65f6\uff0c --namespace \u548c --namespace-label \u6807\u8bc6\u542b\u4e49\u6709\u6240\u4e0d\u540c\uff0c\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002 --namespace-label string \u6807\u8bc6CIS-C\u5c06\u76d1\u542c\u8be5label\u7b5b\u9009\u540e\u7684namespaces\u3002 \u8be5\u53c2\u6570\u53ef\u4e0e --namespace \u53c2\u6570\u6df7\u5408\u4f7f\u7528\uff0c\u6700\u7ec8\u88ab\u76d1\u63a7\u7684namespaces \u53d6\u4e24\u8005\u5408\u96c6\u3002 \u5982\u679c --namespace \u548c --namespace-label \u5747\u672a\u88ab\u4f7f\u7528\uff0c\u5219\u6240\u6709namespace\u4e0b\u7684\u8d44\u6e90\u90fd\u4f1a\u88ab\u76d1\u63a7\u3002 \u5f53\u4e0e --hub-mode \u53c2\u6570\u8054\u7528\u65f6\uff0c --namespace \u548c --namespace-label \u6807\u8bc6\u542b\u4e49\u6709\u6240\u4e0d\u540c\uff0c\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002 \u5b8c\u6574\u82f1\u6587\u53c2\u6570\u5217\u8868 \u00b6 \u542f\u52a8\u53c2\u6570\u7684\u5b8c\u6574\u82f1\u6587\u63cf\u8ff0\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6\uff1a $ docker run f5devcentral/k8s-bigip-ctlr-c:<version> /f5-kic-linux --help \u547d\u4ee4\u7684\u8f93\u51fa\u4e3a\uff1a $ ./f5-kic-linux --help Usage of ./f5-kic-linux: -as3-service string Optional, as3 service for AS3 declaration parsing (default \"http://localhost:8081\") -bigip-password string Required, BIG-IP password for connection, i.e. admin -bigip-url string Required, BIG-IP url, i.e. https://enr.yuxn.com:8443 -bigip-username string Optional, BIG-IP username for connection, i.e. admin (default \"admin\") -flannel-name string Optional, if not default, BigIP Flannel VxLAN Tunnel name, i.e. fl-tunnel -hub-mode Optional, specify whether or not to manage ConfigMap resources in hub-mode -ignore-service-port Optional, use the 1st targetPort when Pool's servicePort matching fails -kube-config string Required if runs as non-inCluster mode, kubernetes configuration i.e. ~/.kube/config -log-level string Optional, logging level: debug info warn error (default \"info\") -namespace value Optional, namespace to watch, can be used multiple times, all namespaces would be watched if neither namespaces nor namespace-label is specified -namespace-label string Optional, namespace labels to select for watching, all namespaces would be watched if neither namespaces nor namespace-label is specified","title":"\u542f\u52a8\u53c2\u6570"},{"location":"Architecture/parameters/#_1","text":"","title":"\u542f\u52a8\u53c2\u6570"},{"location":"Architecture/parameters/#_2","text":"CIS-C\u7a0b\u5e8f\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a Golang\u7a0b\u5e8f\uff1a\u57fa\u4e8ek8s client-go \uff0c\u5c01\u88c5\u4e86BIG-IP iControlRest \u3002 \u4ea4\u4ed8\u65b9\u5f0f\uff1adocker image f5devcentral/k8s-bigip-ctlr-c \u3002 \u542f\u52a8\u53c2\u6570\uff1a\u89c1 \u542f\u52a8\u53c2\u6570\u89e3\u6790 \u90e8\u5206\u9610\u8ff0\u3002 NodeJS\u7a0b\u5e8f\uff1a\u57fa\u4e8eAS3\u5373 F5Networks/f5-appsvcs-extension \uff0c\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u62bd\u53d6\u4e86AS3\u7a0b\u5e8f\u7684\u89e3\u6790\u903b\u8f91\u90e8\u5206\uff0c\u5b9e\u73b0\u4e3a\u4e00\u4e2a\u670d\u52a1(webservice)\u3002 \u4ea4\u4ed8\u65b9\u5f0f\uff1adocker image f5devcentral/cis-c-as3-parser \u3002 \u542f\u52a8\u53c2\u6570\uff1a\u65e0","title":"\u7a0b\u5e8f\u7ec4\u6210\u4e0e\u4ea4\u4ed8\u65b9\u5f0f"},{"location":"Architecture/parameters/#_3","text":"CIS-C\u5b89\u88c5\u90e8\u7f72\u65b9\u5f0f\uff0c\u53ef\u53c2\u89c1\u201c \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u201d\u63cf\u8ff0\u3002\u8fd9\u91cc\u8be6\u7ec6\u9610\u8ff0\u4e0bGoLang\u7a0b\u5e8f\u7684\u542f\u52a8\u53c2\u6570\u3002 --as3-service string \u53ef\u9009\uff0c\u7528\u4e8e\u6307\u5b9aNodeJS\u7a0b\u5e8f\u5165\u53e3\uff0c\u9ed8\u8ba4\u4e3a http://localhost:8081 \u3002 --bigip-url string \u53ef\u9009\uff0cBig-IP\u7684web\u7ba1\u7406\u5730\u5740\u3002 \u5982: https://10.10.10.10:8443 \u3002 --bigip-username string \u53ef\u9009\uff0cBig-IP\u7528\u6237\u7684\u8d26\u53f7\u540d\uff0c\u9ed8\u8ba4\u4e3a admin \u3002 --bigip-password string \u53ef\u9009\uff0cBig-IP \u76f8\u5e94\u8d26\u53f7\u7684\u5bc6\u7801\u3002 --credentials-directory string \u53ef\u9009\u3002\u8be5\u76ee\u5f55\u91cc\u5305\u542b\u4e09\u4e2a\u6587\u4ef6\u3002\u6587\u4ef6\u540d\u5206\u522b\u4e3a \"username\", \"password\" \u548c \"url\"\uff0c\u5206\u522b\u5bf9\u5e94 BIGIP \u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\u548cURL\u3002 \u8fd9\u4e9b\u6587\u4ef6\u91cc\u7684\u5185\u5bb9\u6bd4\u4f20\u5165\u7684 --bigip-url,--bigip-username \u6216 --bigip-password \u53c2\u6570\u4f18\u5148\u7ea7\u66f4\u9ad8. \u4f7f\u7528\u65b9\u5f0f\u53c2\u8003 \u201c \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u201d \u4e2d\u7684\u65b9\u5f0f2. --flannel-name string \u53ef\u9009\u3002\u9ed8\u8ba4\u503c\u4e3a \"\" (\u7a7a\u5b57\u7b26\u4e32)\u3002 \u82e5flannel-name\u4e0d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u793a\u8be5k8s\u7f51\u7edc\u73af\u5883\u4f7f\u7528ipv4 flannel \u573a\u666f. \u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684BIG-IP\u914d\u7f6e\u53c2\u89c1\u201c \u51c6\u5907\u5de5\u4f5c \u201d\u90e8\u5206\u63cf\u8ff0\u3002 --flannel-name-v6 string \u53ef\u9009\u3002\u9ed8\u8ba4\u503c\u4e3a \"\" (\u7a7a\u5b57\u7b26\u4e32)\u3002 \u82e5flannel-name-v6\u4e0d\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u793a\u8be5k8s\u7f51\u7edc\u73af\u5883\u4f7f\u7528ipv6 flannel \u573a\u666f. \u82e5flannel-name \u4e0e flannel-name-v6 \u540c\u65f6\u8bbe\u7f6e\uff0c\u5219\u610f\u5473\u7740\u73af\u5883\u4e3a v4 \u4e0e v6 \u5171\u5b58\u73af\u5883\u3002 \u82e5flannel-name \u4e0e flannel-name-v6 \u540c\u65f6\u4e3a\u7a7a\uff0c\u5219\u6807\u8bc6\u8be5\u73af\u5883\u4f7f\u7528calico\u3002 \u4e0d\u540c\u7f51\u7edc\u73af\u5883\u7684BIG-IP\u914d\u7f6e\u53c2\u89c1\u201c \u51c6\u5907\u5de5\u4f5c \u201d\u90e8\u5206\u63cf\u8ff0\u3002 --hub-mode \u53ef\u9009\uff0c boolean \u7c7b\u578b\uff0c\u6807\u8bc6CIS-C\u662f\u5426\u4f7f\u7528hub\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a false \u3002 hub\u6a21\u5f0f\u7684\u542b\u4e49\u53ca\u5904\u7406\u7ec6\u8282\u8bf7\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002 --ignore-service-port \u53ef\u9009\uff0c boolean \u7c7b\u578b\uff0c\u6807\u8bc6CIS-C\u5bf9\u4e1a\u52a1\u7aef\u53e3\u7684\u7ed1\u5b9a\u884c\u4e3a\uff1a\u5f53configmap\u4e2d\u914d\u7f6e\u4e2d servicePort \u4e0d\u5b58\u5728\u6216\u8005\u4e0e\u5b9e\u9645\u4e1a\u52a1\u4e0d\u5339\u914d\u65f6\uff0c\u662f\u5426\u7ed1\u5b9a\u5b9e\u9645\u4e1a\u52a1\u7b2c\u4e00\u7ec4\u7aef\u53e3\u3002\u9ed8\u8ba4\u4e3a false \u3002 --kube-config string \u96c6\u7fa4\u5916\u90e8\u7f72\u6a21\u5f0f\u4e0b\uff0c\u5fc5\u9009\u3002k8s\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff0c\u4f8b\u5982\uff1a~/.kube/config --log-level \u53ef\u9009\u3002\u8f93\u51fa\u65e5\u5fd7\u7684\u7ea7\u522b\uff0c\u53d6\u503c\u4e3a\uff1a debug , info , warn , error , \u9ed8\u8ba4\u4e3a info \u3002 --namespace string \u6807\u8bc6CIS-C\u5c06\u76d1\u542c\u7684namespace\u540d\u79f0\u3002 \u53ef\u4ee5\u591a\u6b21\u4f7f\u7528\u6b64\u53c2\u6570\uff0cCIS-C\u5c06\u76d1\u542c\u6240\u6709\u6307\u5b9a\u7684namespace\u5185\u7684\u8d44\u6e90\u53d8\u5316\u3002 \u8be5\u53c2\u6570\u53ef\u4e0e --namespace-label \u53c2\u6570\u6df7\u5408\u4f7f\u7528\uff0c\u6700\u7ec8\u88ab\u76d1\u63a7\u7684namespaces \u53d6\u4e24\u8005\u5408\u96c6\u3002 \u5982\u679c --namespace \u548c --namespace-label \u5747\u672a\u88ab\u4f7f\u7528\uff0c\u5219\u6240\u6709namespace\u4e0b\u7684\u8d44\u6e90\u90fd\u4f1a\u88ab\u76d1\u63a7\u3002 \u5f53\u4e0e --hub-mode \u53c2\u6570\u8054\u7528\u65f6\uff0c --namespace \u548c --namespace-label \u6807\u8bc6\u542b\u4e49\u6709\u6240\u4e0d\u540c\uff0c\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002 --namespace-label string \u6807\u8bc6CIS-C\u5c06\u76d1\u542c\u8be5label\u7b5b\u9009\u540e\u7684namespaces\u3002 \u8be5\u53c2\u6570\u53ef\u4e0e --namespace \u53c2\u6570\u6df7\u5408\u4f7f\u7528\uff0c\u6700\u7ec8\u88ab\u76d1\u63a7\u7684namespaces \u53d6\u4e24\u8005\u5408\u96c6\u3002 \u5982\u679c --namespace \u548c --namespace-label \u5747\u672a\u88ab\u4f7f\u7528\uff0c\u5219\u6240\u6709namespace\u4e0b\u7684\u8d44\u6e90\u90fd\u4f1a\u88ab\u76d1\u63a7\u3002 \u5f53\u4e0e --hub-mode \u53c2\u6570\u8054\u7528\u65f6\uff0c --namespace \u548c --namespace-label \u6807\u8bc6\u542b\u4e49\u6709\u6240\u4e0d\u540c\uff0c\u53c2\u89c1\u201c hub\u6a21\u5f0f \u201d\u63cf\u8ff0\u3002","title":"\u542f\u52a8\u53c2\u6570\u89e3\u6790"},{"location":"Architecture/parameters/#_4","text":"\u542f\u52a8\u53c2\u6570\u7684\u5b8c\u6574\u82f1\u6587\u63cf\u8ff0\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6\uff1a $ docker run f5devcentral/k8s-bigip-ctlr-c:<version> /f5-kic-linux --help \u547d\u4ee4\u7684\u8f93\u51fa\u4e3a\uff1a $ ./f5-kic-linux --help Usage of ./f5-kic-linux: -as3-service string Optional, as3 service for AS3 declaration parsing (default \"http://localhost:8081\") -bigip-password string Required, BIG-IP password for connection, i.e. admin -bigip-url string Required, BIG-IP url, i.e. https://enr.yuxn.com:8443 -bigip-username string Optional, BIG-IP username for connection, i.e. admin (default \"admin\") -flannel-name string Optional, if not default, BigIP Flannel VxLAN Tunnel name, i.e. fl-tunnel -hub-mode Optional, specify whether or not to manage ConfigMap resources in hub-mode -ignore-service-port Optional, use the 1st targetPort when Pool's servicePort matching fails -kube-config string Required if runs as non-inCluster mode, kubernetes configuration i.e. ~/.kube/config -log-level string Optional, logging level: debug info warn error (default \"info\") -namespace value Optional, namespace to watch, can be used multiple times, all namespaces would be watched if neither namespaces nor namespace-label is specified -namespace-label string Optional, namespace labels to select for watching, all namespaces would be watched if neither namespaces nor namespace-label is specified","title":"\u5b8c\u6574\u82f1\u6587\u53c2\u6570\u5217\u8868"},{"location":"Operation-and-troubleshooting/ki/","text":"\u5df2\u77e5\u95ee\u9898 \u00b6 \u95ee\u98981\uff1a\u76f4\u63a5\u5220\u9664ns\u5bfc\u81f4\u7a0b\u5e8f\u5d29\u6e83\u91cd\u542f\uff0c\u6b64\u95ee\u9898\u6781\u5c11\u5076\u7136\u51fa\u73b0\u3002 \u5f71\u54cd\u8303\u56f4\uff1a\u8d44\u6e90\u4f9d\u65e7\u4f1a\u88ab\u5220\u9664\uff0c\u4f46\u662f\u7a0b\u5e8f\u91cd\u542f\u4f1a\u5bfc\u81f4\u91cd\u542f\u8fc7\u7a0b\u4e2d\u7684\u90e8\u5206\u4e0b\u53d1\u5ef6\u65f6\u589e\u52a0\uff0c\u589e\u52a0\u4e0b\u53d1\u5931\u8d25\u7684\u53ef\u80fd\u6027\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u76f4\u63a5\u5220\u9664namespace\u65f6\uff0c\u5176\u4e0b\u7684\u5404\u8d44\u6e90\u4e00\u5e76\u4f1a\u88ab\u5220\u9664\uff0c\u7a0b\u5e8f\u5728\u4e0a\u4f20\u8d44\u6e90\u72b6\u6001\u65f6\u56e0\u627e\u4e0d\u5230namespace\u800c\u5931\u8d25\u3002\u5177\u4f53\u95ee\u9898\u63cf\u8ff0\u89c1\uff1a https://github.com/kubernetes/client-go/issues/1125 \u89e3\u51b3\u65b9\u6848\uff1a\u5173\u95ed\u8d44\u6e90\u72b6\u6001\u4e0a\u4f20\u529f\u80fd\uff0c\u6216\u5bfb\u6c42\u793e\u533a\u652f\u6301\uff0c\u534f\u52a9\u5b9a\u4f4d\u5e76\u89e3\u51b3\u95ee\u9898\u3002 \u95ee\u98982\uff1a\u7528\u6237\u80fd\u591f\u5c06AS3 declaration\u62c6\u5206\u4e3a\u591a\u4e2aconfigmap\u5206\u522b\u4e0b\u53d1\u3002 \u5f71\u54cd\u8303\u56f4\uff1a\u5373\uff0c\u5b8c\u6574\u7684AS3 declaration\u5c06\u7531\u591a\u4e2aconfigmap \u7ec4\u6210\uff0c\u6bcf\u4e2aconfigmap\u8d1f\u8d23\u58f0\u660e\u8be5AS3 declaration\u6240\u6307\u5b9a\u7684partition\u7684\u4e00\u90e8\u5206 \u95ee\u9898\u539f\u56e0\uff1a\u636eAS3 declaration \u58f0\u660e\u5f0f\u7684\u7279\u6027\uff0c\u540c\u4e00declaration\u9700\u8981\u5305\u542b\u5b8c\u6574\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5206\u62c6declaration \u8fdd\u80cc\u4e86\u8fd9\u4e00\u58f0\u660e\u5f0f\u8bed\u8a00\u7684\u57fa\u672c\u7279\u6027\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u76ee\u524d\u65e0\u6cd5\u652f\u6301\u5c06AS3 declaration\u5206\u62c6\u4e0b\u53d1\u7684\u80fd\u529b\uff0c\u8fd9\u6837\u975e\u5e38\u5bb9\u6613\u5f15\u53d1\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u589e\u52a0\u7a0b\u5e8f\u7ef4\u62a4\u590d\u6742\u5ea6\u3002\u8003\u8651\u653e\u5728\u5c06\u6765\u7279\u6027\u4e2d\u8c03\u7814\u5b9e\u73b0\u601d\u8def\u3002 \u95ee\u98983\uff1a\u9488\u5bf9\u67d0\u79df\u6237\uff08partition\uff09\u7684\u914d\u7f6e\uff0c\u5fc5\u987b\u901a\u8fc7\u67d0\u4e00\u786e\u5b9aconfigmap\u4e0b\u53d1\uff0cconfigmap\u4e0d\u53ef\u53d8\u66f4\u3002 \u5f71\u54cd\u8303\u56f4\uff1apartition x \u901a\u8fc7 configmap a\u5b8c\u6210\u4e0b\u53d1\u540e\uff0cconfigmap b\u4e2d\u5373\u4fbf\u5305\u542b\u4e86partition x\u7684\u5b9a\u4e49\uff0c\u4e0b\u53d1\u540e\u4e5f\u4e0d\u4f1a\u751f\u6548\u3002\u60f3\u8981\u6539\u52a8partition x\uff0c\u53ea\u80fd\u901a\u8fc7 configmap a\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u6b64\u95ee\u9898\u5e76\u975e\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u800c\u662f\u4e00\u79cd\u7ea6\u675f\u3002configmap a\u4e0b\u53d1\u540e\u4f1a\u5f62\u6210\u5bf9partition x\u7684\u7ed1\u5b9a\u5173\u7cfb\uff0c\u907f\u514d\u540e\u7eed\u5230\u6765\u7684configmap\u5bf9\u65e2\u6709\u4e1a\u52a1\u4ea7\u751f\u9519\u8bef\u5f71\u54cd\u3002\u6b64\u7ea6\u675f\u5bf9endpoints\u8d44\u6e90\u4e5f\u6709\u6548\uff0c\u5373\uff0c\u5bf9\u67d0\u4e00\u4e2a\u7279\u5b9apool x\u7684\u6539\u52a8\u53ea\u80fd\u901a\u8fc7endpoints a\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u5982\u4e0a\u6240\u793a\uff0cpartition x \u4ec5\u80fd\u901a\u8fc7configmap a\u4e0b\u53d1\uff0c\u540e\u7eed\u5bf9partition x\u7684\u4fee\u6539\u3001\u5220\u9664\uff0c\u5747\u53ea\u80fd\u901a\u8fc7configmap a\u5b8c\u6210\u3002 \u95ee\u98984\uff1a\u5207\u6362snat\u65b9\u5f0f\u65f6\u62a5\u9519\uff0c\u8868\u73b0\u4e3a\u4ece\u201csnat\u201d\u6216\u8005\u201cself\u201d\u5207\u6362\u4e3a\u201cauto\u201d\u65f6\u4e0b\u53d1\u5931\u8d25 \u5f71\u54cd\u8303\u56f4\uff1a\u4ece\u201csnat\u201d\u6216\u8005\u201cself\u201d\u5207\u6362\u4e3a\u201cauto\u201d\u65f6\u4e0b\u53d1\u5931\u8d25\uff0c\u53cd\u4e4b\uff0c\u5373\u7531\u201cauto\u201d\u53d8\u4e3a\u201csnat\u201d\u6216\u8005\u201cself\u201d\u65f6\u4e0d\u5b58\u5728\u6b64\u95ee\u9898\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u6b64\u95ee\u9898\u6e90\u81eaBIG-IP iControlRest\u7684bug\uff0c\u5c06\u5bf9\u5e94virtual\u7684\u5c5e\u6027 sourceAddressTranslation \u66f4\u65b0\u4e3a'automap'\u540e\uff0c\u5bf9\u539f\u6709snatpool\u7684\u5173\u8054\u5173\u7cfb\u6ca1\u6709\u53ca\u65f6\u6e05\u9664\uff0c\u5bfc\u81f4\u540e\u7eed\u5bf9snatpool\u7684\u6e05\u7406\u5931\u8d25\uff0c\u65e5\u5fd7\u62a5\u9519\uff1a -1-> PATCH xxxx/mgmt/tm/ltm/virtual/myvirtual {... \"sourceAddressTranslation\":{\"type\":\"automap\"} ...} -2-> DELETE xxxx/mgmt/tm/ltm/snatpool/mysnatpool {\"code\":400,\"message\":\"transaction failed:01070320:3: Snatpool mysnatpool is still referenced by a virtual server.\",\"errorStack\":[],\"apiError\":2} \u89e3\u51b3\u65b9\u6848\uff1a \u65b9\u6848\u4e00\uff1a\u767b\u9646BIG-IP\uff0c\u624b\u52a8\u4fee\u6539\u5bf9\u5e94virtual\u7684 sourceAddressTranslation \u5c5e\u6027\u4e3aautomap\uff0c\u7136\u540e\u6267\u884ckubectl apply \u64cd\u4f5c\uff0c\u5b8c\u6210\u4ece\u201csnat\u201d\u6216\u201cself\u201d\u5230\u201cauto\u201d\u7684\u5207\u6362\u3002 \u65b9\u6848\u4e8c\uff1a\u4f7f\u7528\u5220\u9664+\u521b\u5efa\u7684\u65b9\u5f0f\u4ee3\u66ff\u4fee\u6539\uff0c\u5373\u5148\u6267\u884ckubectl delete -f \u7136\u540e\u6267\u884c kubectl create -f, \u800c\u4e0d\u662f\u76f4\u63a5kubectl apply -f\u505a\u66f4\u65b0\u64cd\u4f5c\u3002 \u5173\u4e8e\u4e1a\u52a1\u8fde\u7eed\u6027\u7684\u8003\u8651\uff1a\u56e0\u4e3a\u4ecesnat\u53d8\u4e3aautomap\u64cd\u4f5c\u672c\u8eab\u4f1a\u9020\u6210\u4e1a\u52a1\u65ad\u8054\uff0c\u6240\u4ee5 delete->create \u65b9\u5f0f\u5c1a\u53ef\u63a5\u53d7\uff08\u662f\u5426\u771f\u7684\u53ef\u63a5\u53d7\uff0c\u5f85\u8bc4\u4f30\uff09\u3002 \u95ee\u98985\uff1aCIS-C\u4e0d\u80fd\u611f\u77e5\u5176\u9000\u51fa\u72b6\u6001\u4e0b\u7684\u5220\u9664\u4e8b\u4ef6\uff0c\u5373CIS-C\u542f\u52a8\u4e4b\u524d\u7684\u5220\u9664\u4e8b\u4ef6\u4e0d\u4f1a\u88ab\u76d1\u63a7 \u5f71\u54cd\u8303\u56f4\uff1a\u5728CIS-C\u542f\u52a8\u524d\u505a\u8fc7\u7684k8s\u8d44\u6e90\u5220\u9664\u52a8\u4f5c\u4e0d\u4f1a\u89e6\u53d1\u542f\u52a8\u540eCIS-C\u7684\u5220\u9664\u884c\u4e3a\u3002 \u95ee\u9898\u539f\u56e0\uff1ak8s\u7684list watch\u672c\u8d28\u5c31\u662f\u7ef4\u6301\u4e00\u4e2aetcd\u7684\u526f\u672c\uff0c\u800c\u4e0d\u662f\u5ba1\u8ba1\u4e8b\u52a1\u4e8b\u4ef6\u5217\u8868\u3002CIS-C\u4e0d\u80fd\u611f\u77e5\u5b83\u4e0d\u5728\u7684\u65f6\u5019\u7684\u5220\u9664\u4e8b\u4ef6\uff0c\u56e0\u4e3a\u5220\u9664\u4e8b\u4ef6\u4e0d\u80fd\u4f53\u73b0\u5728k8s list watch\u5217\u8868\u4e2d\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u4e0d\u8981\u5728CIS-C\u9000\u51fa\u72b6\u6001\u4e0b\u505a\u5220\u9664\u64cd\u4f5c\u3002 \u5982\u679c\u5df2\u7ecf\u8fdb\u884c\u8fc7\u5220\u9664\u64cd\u4f5c\uff0c\u53ea\u80fd\u901a\u8fc7\u624b\u52a8\u5220\u9664BIG-IP\u4e0a\u76f8\u5173\u914d\u7f6e\uff08\u4e0d\u63a8\u8350\uff09\uff0c\u6216\u8005\u5728\u542f\u52a8CIS-C\u540e\u91cd\u65b0\u4e0b\u53d1\u4e00\u6b21\u914d\u7f6e(\u4f8b\u5982kubectl apply ..)\u540e\uff0c\u518d\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff08\u4f8b\u5982kubectl delete ..\uff09\uff0c\u4ee5\u89e6\u53d1CIS-C\u7684\u5220\u9664\u884c\u4e3a\uff08\u63a8\u8350\uff09\u3002","title":"\u5e38\u89c1\u95ee\u9898"},{"location":"Operation-and-troubleshooting/ki/#_1","text":"\u95ee\u98981\uff1a\u76f4\u63a5\u5220\u9664ns\u5bfc\u81f4\u7a0b\u5e8f\u5d29\u6e83\u91cd\u542f\uff0c\u6b64\u95ee\u9898\u6781\u5c11\u5076\u7136\u51fa\u73b0\u3002 \u5f71\u54cd\u8303\u56f4\uff1a\u8d44\u6e90\u4f9d\u65e7\u4f1a\u88ab\u5220\u9664\uff0c\u4f46\u662f\u7a0b\u5e8f\u91cd\u542f\u4f1a\u5bfc\u81f4\u91cd\u542f\u8fc7\u7a0b\u4e2d\u7684\u90e8\u5206\u4e0b\u53d1\u5ef6\u65f6\u589e\u52a0\uff0c\u589e\u52a0\u4e0b\u53d1\u5931\u8d25\u7684\u53ef\u80fd\u6027\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u76f4\u63a5\u5220\u9664namespace\u65f6\uff0c\u5176\u4e0b\u7684\u5404\u8d44\u6e90\u4e00\u5e76\u4f1a\u88ab\u5220\u9664\uff0c\u7a0b\u5e8f\u5728\u4e0a\u4f20\u8d44\u6e90\u72b6\u6001\u65f6\u56e0\u627e\u4e0d\u5230namespace\u800c\u5931\u8d25\u3002\u5177\u4f53\u95ee\u9898\u63cf\u8ff0\u89c1\uff1a https://github.com/kubernetes/client-go/issues/1125 \u89e3\u51b3\u65b9\u6848\uff1a\u5173\u95ed\u8d44\u6e90\u72b6\u6001\u4e0a\u4f20\u529f\u80fd\uff0c\u6216\u5bfb\u6c42\u793e\u533a\u652f\u6301\uff0c\u534f\u52a9\u5b9a\u4f4d\u5e76\u89e3\u51b3\u95ee\u9898\u3002 \u95ee\u98982\uff1a\u7528\u6237\u80fd\u591f\u5c06AS3 declaration\u62c6\u5206\u4e3a\u591a\u4e2aconfigmap\u5206\u522b\u4e0b\u53d1\u3002 \u5f71\u54cd\u8303\u56f4\uff1a\u5373\uff0c\u5b8c\u6574\u7684AS3 declaration\u5c06\u7531\u591a\u4e2aconfigmap \u7ec4\u6210\uff0c\u6bcf\u4e2aconfigmap\u8d1f\u8d23\u58f0\u660e\u8be5AS3 declaration\u6240\u6307\u5b9a\u7684partition\u7684\u4e00\u90e8\u5206 \u95ee\u9898\u539f\u56e0\uff1a\u636eAS3 declaration \u58f0\u660e\u5f0f\u7684\u7279\u6027\uff0c\u540c\u4e00declaration\u9700\u8981\u5305\u542b\u5b8c\u6574\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5206\u62c6declaration \u8fdd\u80cc\u4e86\u8fd9\u4e00\u58f0\u660e\u5f0f\u8bed\u8a00\u7684\u57fa\u672c\u7279\u6027\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u76ee\u524d\u65e0\u6cd5\u652f\u6301\u5c06AS3 declaration\u5206\u62c6\u4e0b\u53d1\u7684\u80fd\u529b\uff0c\u8fd9\u6837\u975e\u5e38\u5bb9\u6613\u5f15\u53d1\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u589e\u52a0\u7a0b\u5e8f\u7ef4\u62a4\u590d\u6742\u5ea6\u3002\u8003\u8651\u653e\u5728\u5c06\u6765\u7279\u6027\u4e2d\u8c03\u7814\u5b9e\u73b0\u601d\u8def\u3002 \u95ee\u98983\uff1a\u9488\u5bf9\u67d0\u79df\u6237\uff08partition\uff09\u7684\u914d\u7f6e\uff0c\u5fc5\u987b\u901a\u8fc7\u67d0\u4e00\u786e\u5b9aconfigmap\u4e0b\u53d1\uff0cconfigmap\u4e0d\u53ef\u53d8\u66f4\u3002 \u5f71\u54cd\u8303\u56f4\uff1apartition x \u901a\u8fc7 configmap a\u5b8c\u6210\u4e0b\u53d1\u540e\uff0cconfigmap b\u4e2d\u5373\u4fbf\u5305\u542b\u4e86partition x\u7684\u5b9a\u4e49\uff0c\u4e0b\u53d1\u540e\u4e5f\u4e0d\u4f1a\u751f\u6548\u3002\u60f3\u8981\u6539\u52a8partition x\uff0c\u53ea\u80fd\u901a\u8fc7 configmap a\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u6b64\u95ee\u9898\u5e76\u975e\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u800c\u662f\u4e00\u79cd\u7ea6\u675f\u3002configmap a\u4e0b\u53d1\u540e\u4f1a\u5f62\u6210\u5bf9partition x\u7684\u7ed1\u5b9a\u5173\u7cfb\uff0c\u907f\u514d\u540e\u7eed\u5230\u6765\u7684configmap\u5bf9\u65e2\u6709\u4e1a\u52a1\u4ea7\u751f\u9519\u8bef\u5f71\u54cd\u3002\u6b64\u7ea6\u675f\u5bf9endpoints\u8d44\u6e90\u4e5f\u6709\u6548\uff0c\u5373\uff0c\u5bf9\u67d0\u4e00\u4e2a\u7279\u5b9apool x\u7684\u6539\u52a8\u53ea\u80fd\u901a\u8fc7endpoints a\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u5982\u4e0a\u6240\u793a\uff0cpartition x \u4ec5\u80fd\u901a\u8fc7configmap a\u4e0b\u53d1\uff0c\u540e\u7eed\u5bf9partition x\u7684\u4fee\u6539\u3001\u5220\u9664\uff0c\u5747\u53ea\u80fd\u901a\u8fc7configmap a\u5b8c\u6210\u3002 \u95ee\u98984\uff1a\u5207\u6362snat\u65b9\u5f0f\u65f6\u62a5\u9519\uff0c\u8868\u73b0\u4e3a\u4ece\u201csnat\u201d\u6216\u8005\u201cself\u201d\u5207\u6362\u4e3a\u201cauto\u201d\u65f6\u4e0b\u53d1\u5931\u8d25 \u5f71\u54cd\u8303\u56f4\uff1a\u4ece\u201csnat\u201d\u6216\u8005\u201cself\u201d\u5207\u6362\u4e3a\u201cauto\u201d\u65f6\u4e0b\u53d1\u5931\u8d25\uff0c\u53cd\u4e4b\uff0c\u5373\u7531\u201cauto\u201d\u53d8\u4e3a\u201csnat\u201d\u6216\u8005\u201cself\u201d\u65f6\u4e0d\u5b58\u5728\u6b64\u95ee\u9898\u3002 \u95ee\u9898\u539f\u56e0\uff1a\u6b64\u95ee\u9898\u6e90\u81eaBIG-IP iControlRest\u7684bug\uff0c\u5c06\u5bf9\u5e94virtual\u7684\u5c5e\u6027 sourceAddressTranslation \u66f4\u65b0\u4e3a'automap'\u540e\uff0c\u5bf9\u539f\u6709snatpool\u7684\u5173\u8054\u5173\u7cfb\u6ca1\u6709\u53ca\u65f6\u6e05\u9664\uff0c\u5bfc\u81f4\u540e\u7eed\u5bf9snatpool\u7684\u6e05\u7406\u5931\u8d25\uff0c\u65e5\u5fd7\u62a5\u9519\uff1a -1-> PATCH xxxx/mgmt/tm/ltm/virtual/myvirtual {... \"sourceAddressTranslation\":{\"type\":\"automap\"} ...} -2-> DELETE xxxx/mgmt/tm/ltm/snatpool/mysnatpool {\"code\":400,\"message\":\"transaction failed:01070320:3: Snatpool mysnatpool is still referenced by a virtual server.\",\"errorStack\":[],\"apiError\":2} \u89e3\u51b3\u65b9\u6848\uff1a \u65b9\u6848\u4e00\uff1a\u767b\u9646BIG-IP\uff0c\u624b\u52a8\u4fee\u6539\u5bf9\u5e94virtual\u7684 sourceAddressTranslation \u5c5e\u6027\u4e3aautomap\uff0c\u7136\u540e\u6267\u884ckubectl apply \u64cd\u4f5c\uff0c\u5b8c\u6210\u4ece\u201csnat\u201d\u6216\u201cself\u201d\u5230\u201cauto\u201d\u7684\u5207\u6362\u3002 \u65b9\u6848\u4e8c\uff1a\u4f7f\u7528\u5220\u9664+\u521b\u5efa\u7684\u65b9\u5f0f\u4ee3\u66ff\u4fee\u6539\uff0c\u5373\u5148\u6267\u884ckubectl delete -f \u7136\u540e\u6267\u884c kubectl create -f, \u800c\u4e0d\u662f\u76f4\u63a5kubectl apply -f\u505a\u66f4\u65b0\u64cd\u4f5c\u3002 \u5173\u4e8e\u4e1a\u52a1\u8fde\u7eed\u6027\u7684\u8003\u8651\uff1a\u56e0\u4e3a\u4ecesnat\u53d8\u4e3aautomap\u64cd\u4f5c\u672c\u8eab\u4f1a\u9020\u6210\u4e1a\u52a1\u65ad\u8054\uff0c\u6240\u4ee5 delete->create \u65b9\u5f0f\u5c1a\u53ef\u63a5\u53d7\uff08\u662f\u5426\u771f\u7684\u53ef\u63a5\u53d7\uff0c\u5f85\u8bc4\u4f30\uff09\u3002 \u95ee\u98985\uff1aCIS-C\u4e0d\u80fd\u611f\u77e5\u5176\u9000\u51fa\u72b6\u6001\u4e0b\u7684\u5220\u9664\u4e8b\u4ef6\uff0c\u5373CIS-C\u542f\u52a8\u4e4b\u524d\u7684\u5220\u9664\u4e8b\u4ef6\u4e0d\u4f1a\u88ab\u76d1\u63a7 \u5f71\u54cd\u8303\u56f4\uff1a\u5728CIS-C\u542f\u52a8\u524d\u505a\u8fc7\u7684k8s\u8d44\u6e90\u5220\u9664\u52a8\u4f5c\u4e0d\u4f1a\u89e6\u53d1\u542f\u52a8\u540eCIS-C\u7684\u5220\u9664\u884c\u4e3a\u3002 \u95ee\u9898\u539f\u56e0\uff1ak8s\u7684list watch\u672c\u8d28\u5c31\u662f\u7ef4\u6301\u4e00\u4e2aetcd\u7684\u526f\u672c\uff0c\u800c\u4e0d\u662f\u5ba1\u8ba1\u4e8b\u52a1\u4e8b\u4ef6\u5217\u8868\u3002CIS-C\u4e0d\u80fd\u611f\u77e5\u5b83\u4e0d\u5728\u7684\u65f6\u5019\u7684\u5220\u9664\u4e8b\u4ef6\uff0c\u56e0\u4e3a\u5220\u9664\u4e8b\u4ef6\u4e0d\u80fd\u4f53\u73b0\u5728k8s list watch\u5217\u8868\u4e2d\u3002 \u89e3\u51b3\u65b9\u6848\uff1a\u4e0d\u8981\u5728CIS-C\u9000\u51fa\u72b6\u6001\u4e0b\u505a\u5220\u9664\u64cd\u4f5c\u3002 \u5982\u679c\u5df2\u7ecf\u8fdb\u884c\u8fc7\u5220\u9664\u64cd\u4f5c\uff0c\u53ea\u80fd\u901a\u8fc7\u624b\u52a8\u5220\u9664BIG-IP\u4e0a\u76f8\u5173\u914d\u7f6e\uff08\u4e0d\u63a8\u8350\uff09\uff0c\u6216\u8005\u5728\u542f\u52a8CIS-C\u540e\u91cd\u65b0\u4e0b\u53d1\u4e00\u6b21\u914d\u7f6e(\u4f8b\u5982kubectl apply ..)\u540e\uff0c\u518d\u6267\u884c\u5220\u9664\u64cd\u4f5c\uff08\u4f8b\u5982kubectl delete ..\uff09\uff0c\u4ee5\u89e6\u53d1CIS-C\u7684\u5220\u9664\u884c\u4e3a\uff08\u63a8\u8350\uff09\u3002","title":"\u5df2\u77e5\u95ee\u9898"},{"location":"Operation-and-troubleshooting/migration/","text":"\u8fc1\u79fb \u00b6 \u6240\u8c13\u201c\u8fc1\u79fb\u201d\u4e3a\u5c06K8S\u96c6\u7fa4\u8d44\u6e90\u4e0b\u53d1\u63a7\u5236\u5668\u4ece CIS \u5207\u6362\u4e3aCIS-C\u7684\u8fc7\u7a0b\u3002 \u5207\u6362\u7684\u76ee\u7684\u662f\u4f7f\u7528CIS-C\u53d6\u4ee3CIS\uff0c\u63a5\u7ba1K8S\u96c6\u7fa4\u8d44\u6e90\u5230BIG-IP\u7684\u4e0b\u53d1\u80fd\u529b\uff0c\u5373\uff0c\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5df2\u4e0b\u53d1\u4e1a\u52a1\u7684\u53d8\u66f4\u53ca\u65b0\u7684\u4e1a\u52a1\u4e0b\u53d1\u5747\u7531CIS-C\u63a5\u7ba1\uff0cCIS\u9000\u51fa\u3002 CIS-C\u8fc1\u79fb\u6b65\u9aa4 \u00b6 \u505c\u6b62CIS\u7a0b\u5e8f\uff0c\u786e\u4fddBIG-IP\u4e0a\u73b0\u6709\u4e1a\u52a1\u4e0d\u518d\u6709\u65b0\u7684\u53d8\u66f4\u3002 \u5907\u4efdBIG-IP\u73b0\u6709\u4e1a\u52a1\u914d\u7f6e\uff0c\u5b9e\u73b0\u65b9\u5f0f\u53ef\u4ee5\u901a\u8fc7ucs\u6216\u8005\u5176\u4ed6\u5907\u4efd\u65b9\u5f0f\uff0c\u4ee5\u5907\u5207\u6362\u5931\u8d25\u65f6\u6062\u590d\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\uff0c\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u53c2\u89c1 \u5de5\u5177\u4f7f\u7528\u65b9\u6cd5 \uff0c\u7279\u522b\u6ce8\u610f\u7684\u662f\u9700\u8981\u6dfb\u52a0\u53c2\u6570 --output bigip \uff0c\u5fc5\u8981\u65f6\u52a0\u53c2\u6570 --overwrite \uff0c\u8be6\u89c1\u201c\u5de5\u5177\u4f7f\u7528\u65b9\u6cd5\u201d\u3002 \u6b64\u6b65\u6267\u884c\u7684\u4f5c\u7528\u662f\u5c06BIG-IP\u4e0a\u73b0\u6709\u7684\u5df2\u7ecf\u4e0b\u53d1\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u6536\u96c6\u8d77\u6765\uff0c\u4ee5\u7279\u5b9a\u683c\u5f0f\uff08JSON\uff09\u5b58\u5165BIG-IP internal\u7c7b\u578b\u7684Data Group\u4e2d\u3002 \u6267\u884c\u5b8c\u672c\u6b65\u9aa4\u540e\uff0c\u5728 BIG-IP \"Local Traffic\" -> \"iRules\" -> \"Data Group List\"\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u201cf5-kic_\u201d\u5f00\u5934\u7684partition\u4fe1\u606f\uff0c\u4f8b\u5982\u201cf5-kic_namespaceA\u201d\u3002 \u6253\u5f00\u6b64\u6761\u76ee\u540e\u53ef\u4ee5\u770b\u5230\u201cString Records\u201d\uff0c\u201cString Records\u201d \u4e2d\u5305\u542b\u591a\u4e2a\u4ee5\u201crest.x\u201d\u6216\u8005\u201cas3.x\u201d\u547d\u540d\u7684\u6761\u76ee\uff0c\u4ed6\u4eec\u7684\u503c\u5747\u4ee5base64\u7f16\u7801\u3002x\u4e3a\u6570\u5b57\u7f16\u53f7\uff0c\u8fd9\u662f\u56e0\u4e3a\u5355\u4e2a\u201cString Record\u201d\u670965536\u5b57\u8282\u957f\u5ea6\u9650\u5236\uff0c\u6240\u4ee5\u5b8c\u6574\u7684\u4fe1\u606f\u88ab\u5207\u5206\u62101024\u5b57\u8282\u957f\u5ea6\uff0c\u5e76\u4ee5\u201c.x\u201d\u7f16\u53f7\u3002 rest.x \u8868\u793a\u5df2\u7ecf\u89e3\u6790\u5b8c\u6210\u7684CIS-C\u53ef\u4ee5\u8bc6\u522b\u7684\u4fe1\u606f\u3002 as3.x \u8868\u793aconfigmap\u4e2d\u539f\u59cb\u7684as3\u914d\u7f6e\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\u540e\uff0cData Group\u4e2d\u5e76\u4e0d\u4f1a\u51fa\u73b0as3.x\u7c7b\u578b\u7684\u6761\u76ee\uff0c\u56e0\u4e3a\u6b64\u65f6cis-c-tools\u4ec5\u80fd\u83b7\u53d6CIS\u4e0b\u53d1\u540e\u7684BIG-IP\u4e0a\u8d44\u6e90\u72b6\u6001\uff0c\u8fd8\u65e0\u6cd5\u62ff\u5230as3\u539f\u59cb\u914d\u7f6e\u4fe1\u606f\uff0c\u53ea\u80fd\u62ff\u5230rest.x \u8868\u793a\u7684\u5df2\u4e0b\u53d1\u72b6\u6001\u3002\u5f53\u542f\u52a8CIS-C\u540e\uff0cas3.x\u90e8\u5206\u7531CIS-C\u8865\u9f50\u3002 \u5c06rest.x \u5185\u5bb9\u62fc\u88c5\u8fd8\u539f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230cis-c-tool\u7a0b\u5e8f\u5f80BIG-IP\u4e0a\u4fdd\u5b58\u4e86\u4ec0\u4e48\u5185\u5bb9\uff0c\u4ee5\u4f55\u79cd\u683c\u5f0f\u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0c\u53c2\u89c1\u4ee5\u4e0b\u6ce8\u91ca\u90e8\u5206\u9610\u8ff0\u3002 { # partition folder\u4e0b\u7684\u8d44\u6e90\uff0c\u5e76\u975e\u6240\u6709\u8d44\u6e90\u90fd\u5728subPath\u4e0b \"\": { # virtual-address \u7c7b\u578b\u8d44\u6e90 # \u201cltm/virtual-address\u201d\u4e3aiControlRest\u7c7b\u578b # 192.0.2.11\u4e3a\u8d44\u6e90\u540d\u79f0 # \u540e\u8fb9{...}\u4e3a\u8d44\u6e90\u7684\u5c5e\u6027 \"ltm/virtual-address/192.0.2.11\": { \"address\": \"192.0.2.11\", \"arp\": \"enabled\", ... \"unit\": 1 } }, # cafe\u4e3afolder\u540d\u79f0\uff0cfolder\u672c\u8eab\u4e5f\u662f\u4e00\u79cd\u8d44\u6e90 # folder\u5185\u4e3a\u5404\u4e2a\u8d44\u6e90\u7684iControlRest\u7c7b\u578b\u53ca\u8d44\u6e90\u540d\u79f0\u3001\u5c5e\u6027 \"cafe\": { \"ltm/pool/coffee_pool\": { \"allowNat\": \"yes\", ... \"subPath\": \"cafe\" }, \"ltm/profile/client-ssl/cafetls\": { \"alertTimeout\": \"indefinite\", ... \"uncleanShutdown\": \"enabled\" }, \"ltm/virtual/https_vs\": { \"addressStatus\": \"yes\", ... \"vsIndex\": 12238 }, \"sys/file/ssl-cert/coffeecert.crt\": { ... \"version\": 3 }, \"sys/file/ssl-cert/teacert.crt\": { ... \"version\": 3 }, \"sys/file/ssl-key/coffeecert.key\": { ... \"updatedBy\": \"admin\" }, \"sys/file/ssl-key/teacert.key\": { ... \"updatedBy\": \"admin\" } } # \u4e00\u4e2apartition folder\u4e0b\u53ef\u4ee5\u6709\u591a\u4e2afolder\uff0c\u53d6\u51b3\u4e8eas3\u58f0\u660e\u65b9\u5f0f\u3002 } \u5c06as3\u89e3\u6790\u4e3a\u7b26\u5408\u4ee5\u4e0a\u683c\u5f0f\u7684\u7ed3\u6784\u4f53\u662fCIS-C\u5b9e\u73b0\u4e0b\u53d1\u7684\u5173\u952e\u3001\u57fa\u7840\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\u7684\u6839\u672c\u76ee\u7684\uff0c\u5c31\u662f\u5c06BIG-IP\u4e0a\u73b0\u6709\u7684\u8d44\u6e90\u4fe1\u606f\u7ec4\u7ec7\u8d77\u6765\uff08JSON\uff09\u4ee5internal Data Group\u7684\u5f62\u5f0f\u544a\u77e5CIS-C\u7a0b\u5e8f\u3002 \u53ea\u6709\u8fd9\u6837\uff0cCIS-C\u624d\u80fd\u7ee7\u7eed\u5bf9\u8d44\u6e90\u8fdb\u884cCreate Update Delete\u64cd\u4f5c\u3002 \u542f\u52a8CIS-C\u7a0b\u5e8f\uff0c\u5b8c\u6210\u8fc1\u79fb\u3002\u7ef4\u62a4\u4eba\u5458\u53ef\u81ea\u884c\u89c2\u6d4b\u65e5\u5fd7\uff0c\u5e76\u89c2\u5bdfBIG-IP\u4e0a\u5df2\u4e0b\u53d1\u8d44\u6e90\u60c5\u51b5\u3002 CIS-C\u542f\u52a8\u540e\u4f1a\u9996\u5148\u52a0\u8f7dinterval Data Group\u4e2d\u4ee5 f5-kic_ \u5f00\u5934\u7684\u6570\u636e\uff0c\u5c06\u5176\u4f5c\u4e3a\u5df2\u4e0b\u53d1\u8d44\u6e90\u72b6\u6001\u3002\u6709\u4e86\u8fd9\u4efd\u4fe1\u606f\uff0cCIS-C\u53ef\u4ee5\uff1a \u907f\u514dCIS-C\u91cd\u542f\u540e\u6240\u6709\u8d44\u6e90\u91cd\u65b0\u4e0b\u53d1\uff0c\u8fd9\u662f\u56e0\u4e3ainternal Data Group\u4fe1\u606f\u53ef\u4ee5\u4f5c\u4e3a\u4e0a\u6b21\u4e0b\u53d1\u7684fingerprint\uff0cCIS-C\u6bcf\u6b21\u4e0b\u53d1\u524d\u5747\u4f1a\u5bf9\u6bd4\u662f\u5426\u6709\u53d8\u5316\u3002 \u5728\u5176\u4ed6\u4e0b\u53d1\u7a0b\u5e8f\u4e0b\u53d1\u57fa\u7840\u4e0a\u7ee7\u7eed\u589e\u91cf\u66f4\u65b0\u3002\u867d\u7136CIS-C\u5e76\u4e0d\u80fd\u77e5\u9053\u4e4b\u524d\u4e0b\u53d1\u7a0b\u5e8f\uff08\u5982CIS\uff09\u662f\u5982\u4f55\u4e0b\u53d1\u7684\uff0c\u4f46\u901a\u8fc7cis-c-tool\u53ef\u4ee5\u77e5\u9053\u4e0b\u53d1\u7a0b\u5e8f\u64cd\u4f5c\u540eBIG-IP\u4e0a\u7684\u8d44\u6e90\u72b6\u6001\u3002\u5728\u6b64\u72b6\u6001\u4e0a\uff0cCIS-C\u4fbf\u53ef\u4ee5\u77e5\u9053\u5404\u79cd\u8d44\u6e90\u7684\u5173\u8054\u5173\u7cfb\uff08\u4f8b\u5982virtual-pool-member\u5173\u8054\u5173\u7cfb\uff09\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eedCRUD\u4e86\u3002","title":"\u8fc1\u79fb"},{"location":"Operation-and-troubleshooting/migration/#_1","text":"\u6240\u8c13\u201c\u8fc1\u79fb\u201d\u4e3a\u5c06K8S\u96c6\u7fa4\u8d44\u6e90\u4e0b\u53d1\u63a7\u5236\u5668\u4ece CIS \u5207\u6362\u4e3aCIS-C\u7684\u8fc7\u7a0b\u3002 \u5207\u6362\u7684\u76ee\u7684\u662f\u4f7f\u7528CIS-C\u53d6\u4ee3CIS\uff0c\u63a5\u7ba1K8S\u96c6\u7fa4\u8d44\u6e90\u5230BIG-IP\u7684\u4e0b\u53d1\u80fd\u529b\uff0c\u5373\uff0c\u5207\u6362\u5b8c\u6210\u540e\uff0c\u5df2\u4e0b\u53d1\u4e1a\u52a1\u7684\u53d8\u66f4\u53ca\u65b0\u7684\u4e1a\u52a1\u4e0b\u53d1\u5747\u7531CIS-C\u63a5\u7ba1\uff0cCIS\u9000\u51fa\u3002","title":"\u8fc1\u79fb"},{"location":"Operation-and-troubleshooting/migration/#cis-c","text":"\u505c\u6b62CIS\u7a0b\u5e8f\uff0c\u786e\u4fddBIG-IP\u4e0a\u73b0\u6709\u4e1a\u52a1\u4e0d\u518d\u6709\u65b0\u7684\u53d8\u66f4\u3002 \u5907\u4efdBIG-IP\u73b0\u6709\u4e1a\u52a1\u914d\u7f6e\uff0c\u5b9e\u73b0\u65b9\u5f0f\u53ef\u4ee5\u901a\u8fc7ucs\u6216\u8005\u5176\u4ed6\u5907\u4efd\u65b9\u5f0f\uff0c\u4ee5\u5907\u5207\u6362\u5931\u8d25\u65f6\u6062\u590d\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\uff0c\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u53c2\u89c1 \u5de5\u5177\u4f7f\u7528\u65b9\u6cd5 \uff0c\u7279\u522b\u6ce8\u610f\u7684\u662f\u9700\u8981\u6dfb\u52a0\u53c2\u6570 --output bigip \uff0c\u5fc5\u8981\u65f6\u52a0\u53c2\u6570 --overwrite \uff0c\u8be6\u89c1\u201c\u5de5\u5177\u4f7f\u7528\u65b9\u6cd5\u201d\u3002 \u6b64\u6b65\u6267\u884c\u7684\u4f5c\u7528\u662f\u5c06BIG-IP\u4e0a\u73b0\u6709\u7684\u5df2\u7ecf\u4e0b\u53d1\u7684\u8d44\u6e90\u914d\u7f6e\uff0c\u6536\u96c6\u8d77\u6765\uff0c\u4ee5\u7279\u5b9a\u683c\u5f0f\uff08JSON\uff09\u5b58\u5165BIG-IP internal\u7c7b\u578b\u7684Data Group\u4e2d\u3002 \u6267\u884c\u5b8c\u672c\u6b65\u9aa4\u540e\uff0c\u5728 BIG-IP \"Local Traffic\" -> \"iRules\" -> \"Data Group List\"\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u201cf5-kic_\u201d\u5f00\u5934\u7684partition\u4fe1\u606f\uff0c\u4f8b\u5982\u201cf5-kic_namespaceA\u201d\u3002 \u6253\u5f00\u6b64\u6761\u76ee\u540e\u53ef\u4ee5\u770b\u5230\u201cString Records\u201d\uff0c\u201cString Records\u201d \u4e2d\u5305\u542b\u591a\u4e2a\u4ee5\u201crest.x\u201d\u6216\u8005\u201cas3.x\u201d\u547d\u540d\u7684\u6761\u76ee\uff0c\u4ed6\u4eec\u7684\u503c\u5747\u4ee5base64\u7f16\u7801\u3002x\u4e3a\u6570\u5b57\u7f16\u53f7\uff0c\u8fd9\u662f\u56e0\u4e3a\u5355\u4e2a\u201cString Record\u201d\u670965536\u5b57\u8282\u957f\u5ea6\u9650\u5236\uff0c\u6240\u4ee5\u5b8c\u6574\u7684\u4fe1\u606f\u88ab\u5207\u5206\u62101024\u5b57\u8282\u957f\u5ea6\uff0c\u5e76\u4ee5\u201c.x\u201d\u7f16\u53f7\u3002 rest.x \u8868\u793a\u5df2\u7ecf\u89e3\u6790\u5b8c\u6210\u7684CIS-C\u53ef\u4ee5\u8bc6\u522b\u7684\u4fe1\u606f\u3002 as3.x \u8868\u793aconfigmap\u4e2d\u539f\u59cb\u7684as3\u914d\u7f6e\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\u540e\uff0cData Group\u4e2d\u5e76\u4e0d\u4f1a\u51fa\u73b0as3.x\u7c7b\u578b\u7684\u6761\u76ee\uff0c\u56e0\u4e3a\u6b64\u65f6cis-c-tools\u4ec5\u80fd\u83b7\u53d6CIS\u4e0b\u53d1\u540e\u7684BIG-IP\u4e0a\u8d44\u6e90\u72b6\u6001\uff0c\u8fd8\u65e0\u6cd5\u62ff\u5230as3\u539f\u59cb\u914d\u7f6e\u4fe1\u606f\uff0c\u53ea\u80fd\u62ff\u5230rest.x \u8868\u793a\u7684\u5df2\u4e0b\u53d1\u72b6\u6001\u3002\u5f53\u542f\u52a8CIS-C\u540e\uff0cas3.x\u90e8\u5206\u7531CIS-C\u8865\u9f50\u3002 \u5c06rest.x \u5185\u5bb9\u62fc\u88c5\u8fd8\u539f\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230cis-c-tool\u7a0b\u5e8f\u5f80BIG-IP\u4e0a\u4fdd\u5b58\u4e86\u4ec0\u4e48\u5185\u5bb9\uff0c\u4ee5\u4f55\u79cd\u683c\u5f0f\u3002 \u4e3e\u4f8b\u6765\u8bf4\uff0c\u53c2\u89c1\u4ee5\u4e0b\u6ce8\u91ca\u90e8\u5206\u9610\u8ff0\u3002 { # partition folder\u4e0b\u7684\u8d44\u6e90\uff0c\u5e76\u975e\u6240\u6709\u8d44\u6e90\u90fd\u5728subPath\u4e0b \"\": { # virtual-address \u7c7b\u578b\u8d44\u6e90 # \u201cltm/virtual-address\u201d\u4e3aiControlRest\u7c7b\u578b # 192.0.2.11\u4e3a\u8d44\u6e90\u540d\u79f0 # \u540e\u8fb9{...}\u4e3a\u8d44\u6e90\u7684\u5c5e\u6027 \"ltm/virtual-address/192.0.2.11\": { \"address\": \"192.0.2.11\", \"arp\": \"enabled\", ... \"unit\": 1 } }, # cafe\u4e3afolder\u540d\u79f0\uff0cfolder\u672c\u8eab\u4e5f\u662f\u4e00\u79cd\u8d44\u6e90 # folder\u5185\u4e3a\u5404\u4e2a\u8d44\u6e90\u7684iControlRest\u7c7b\u578b\u53ca\u8d44\u6e90\u540d\u79f0\u3001\u5c5e\u6027 \"cafe\": { \"ltm/pool/coffee_pool\": { \"allowNat\": \"yes\", ... \"subPath\": \"cafe\" }, \"ltm/profile/client-ssl/cafetls\": { \"alertTimeout\": \"indefinite\", ... \"uncleanShutdown\": \"enabled\" }, \"ltm/virtual/https_vs\": { \"addressStatus\": \"yes\", ... \"vsIndex\": 12238 }, \"sys/file/ssl-cert/coffeecert.crt\": { ... \"version\": 3 }, \"sys/file/ssl-cert/teacert.crt\": { ... \"version\": 3 }, \"sys/file/ssl-key/coffeecert.key\": { ... \"updatedBy\": \"admin\" }, \"sys/file/ssl-key/teacert.key\": { ... \"updatedBy\": \"admin\" } } # \u4e00\u4e2apartition folder\u4e0b\u53ef\u4ee5\u6709\u591a\u4e2afolder\uff0c\u53d6\u51b3\u4e8eas3\u58f0\u660e\u65b9\u5f0f\u3002 } \u5c06as3\u89e3\u6790\u4e3a\u7b26\u5408\u4ee5\u4e0a\u683c\u5f0f\u7684\u7ed3\u6784\u4f53\u662fCIS-C\u5b9e\u73b0\u4e0b\u53d1\u7684\u5173\u952e\u3001\u57fa\u7840\u3002 \u8fd0\u884ccis-c-tool\u7a0b\u5e8f\u7684\u6839\u672c\u76ee\u7684\uff0c\u5c31\u662f\u5c06BIG-IP\u4e0a\u73b0\u6709\u7684\u8d44\u6e90\u4fe1\u606f\u7ec4\u7ec7\u8d77\u6765\uff08JSON\uff09\u4ee5internal Data Group\u7684\u5f62\u5f0f\u544a\u77e5CIS-C\u7a0b\u5e8f\u3002 \u53ea\u6709\u8fd9\u6837\uff0cCIS-C\u624d\u80fd\u7ee7\u7eed\u5bf9\u8d44\u6e90\u8fdb\u884cCreate Update Delete\u64cd\u4f5c\u3002 \u542f\u52a8CIS-C\u7a0b\u5e8f\uff0c\u5b8c\u6210\u8fc1\u79fb\u3002\u7ef4\u62a4\u4eba\u5458\u53ef\u81ea\u884c\u89c2\u6d4b\u65e5\u5fd7\uff0c\u5e76\u89c2\u5bdfBIG-IP\u4e0a\u5df2\u4e0b\u53d1\u8d44\u6e90\u60c5\u51b5\u3002 CIS-C\u542f\u52a8\u540e\u4f1a\u9996\u5148\u52a0\u8f7dinterval Data Group\u4e2d\u4ee5 f5-kic_ \u5f00\u5934\u7684\u6570\u636e\uff0c\u5c06\u5176\u4f5c\u4e3a\u5df2\u4e0b\u53d1\u8d44\u6e90\u72b6\u6001\u3002\u6709\u4e86\u8fd9\u4efd\u4fe1\u606f\uff0cCIS-C\u53ef\u4ee5\uff1a \u907f\u514dCIS-C\u91cd\u542f\u540e\u6240\u6709\u8d44\u6e90\u91cd\u65b0\u4e0b\u53d1\uff0c\u8fd9\u662f\u56e0\u4e3ainternal Data Group\u4fe1\u606f\u53ef\u4ee5\u4f5c\u4e3a\u4e0a\u6b21\u4e0b\u53d1\u7684fingerprint\uff0cCIS-C\u6bcf\u6b21\u4e0b\u53d1\u524d\u5747\u4f1a\u5bf9\u6bd4\u662f\u5426\u6709\u53d8\u5316\u3002 \u5728\u5176\u4ed6\u4e0b\u53d1\u7a0b\u5e8f\u4e0b\u53d1\u57fa\u7840\u4e0a\u7ee7\u7eed\u589e\u91cf\u66f4\u65b0\u3002\u867d\u7136CIS-C\u5e76\u4e0d\u80fd\u77e5\u9053\u4e4b\u524d\u4e0b\u53d1\u7a0b\u5e8f\uff08\u5982CIS\uff09\u662f\u5982\u4f55\u4e0b\u53d1\u7684\uff0c\u4f46\u901a\u8fc7cis-c-tool\u53ef\u4ee5\u77e5\u9053\u4e0b\u53d1\u7a0b\u5e8f\u64cd\u4f5c\u540eBIG-IP\u4e0a\u7684\u8d44\u6e90\u72b6\u6001\u3002\u5728\u6b64\u72b6\u6001\u4e0a\uff0cCIS-C\u4fbf\u53ef\u4ee5\u77e5\u9053\u5404\u79cd\u8d44\u6e90\u7684\u5173\u8054\u5173\u7cfb\uff08\u4f8b\u5982virtual-pool-member\u5173\u8054\u5173\u7cfb\uff09\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eedCRUD\u4e86\u3002","title":"CIS-C\u8fc1\u79fb\u6b65\u9aa4"},{"location":"Release-notes/","text":"\u7248\u672c\u53d1\u5e03 \u00b6 Release: 2.12.2-20230621 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.12.2-20230621 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u589e\u52a0\u5bf9flannel CNI\u4e2dhost-gw\u6a21\u5f0f\u7684\u652f\u6301 ( PR internal-only ), ( issue )\u3002 Release: 2.12.1-20230608 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.12.1-20230608 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u5b8c\u5584NodePort\u652f\u6301\uff0cServiceType\u53ef\u4ee5\u5728NodePort\u548cClusterIP\u4e24\u79cd\u7c7b\u578b\u95f4\u81ea\u7531\u5207\u6362\u90e8\u7f72\u3002( issue and PR )\u3002 \u589e\u52a0cis.f5.com/as3-tenant as3-app as3-pool \u4e09\u4e2alabel\u7684\u4e0b\u53d1\u54cd\u5e94\uff08\u88ab\u79fb\u9664\u3001\u65b0\u52a0\u65f6\u90fd\u4f1a\u89e6\u53d1\u8d44\u6e90\u4e0b\u53d1\u8c03\u6574\uff09( issue )\u3002 \u4f18\u5316\u4ee5\u4e0b\u8d44\u6e90\u7684\u4e0b\u53d1\u903b\u8f91(rest\u8bf7\u6c42+\u4e8b\u52a1)\uff1anet/arp net/ndp ltm/node Release: 2.11.1-20230216 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.11.1-20230216 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u4fee\u590d\u670d\u52a1\u6807\u7b7e\u7ed1\u5b9a\u5f02\u5e38( issue and PR )\u3002 \u5b8c\u5584\u5177\u5907request id\u7684\u65e5\u5fd7\u8f93\u51fa( PR )\u3002 Release: 2.10.1-20221201 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.10.1-20221201 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u589e\u5f3a\u5e95\u5c42\u6a21\u5757\u7ba1\u7406\uff0c\u4e1a\u52a1\u4e0b\u53d1\u548cAS3\u89e3\u6790\u903b\u8f91\u72ec\u7acb\u4e3a f5-bigip-rest \u548c f5-as3-parsing \u589e\u5f3a\u5b89\u5168\u4ea4\u4ed8\u80fd\u529b\uff0c\u914d\u7f6e\u975eroot\u7528\u6237\u8fd0\u884cCIS-C \u4f18\u5316iControlRest\u751f\u6210\u903b\u8f91 \u589e\u5f3a\u5bf9\u51fd\u6570\u8017\u65f6\u76d1\u63a7\u80fd\u529b Release: 2.10.1-20221031 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.10.1-20221031 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u589e\u5f3a\u8d44\u6e90\u4e0b\u53d1\u7684\u79df\u6237\u7ba1\u7406 \u589e\u5f3aIPv6\u652f\u6301\uff0c\u5e76\u5b8c\u5584\u76f8\u5173\u6587\u6863 \u5176\u4ed6\u529f\u80fd\u4fee\u590d\u548c\u6027\u80fd\u68c0\u6d4b\u8c03\u4f18 Release: 2.9.1-20220930 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220930 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u589e\u52a0\u5bf9k8s IPv6\u73af\u5883\u53cav4-v6\u6df7\u5408\u90e8\u7f72\u73af\u5883 \u652f\u6301 \u589e\u52a0 \u4e0eCIS\u5171\u5b58 \u80fd\u529b\u652f\u6301\uff0c\u5f52\u7f6earp\u4e8e\u72ec\u7acbpartition \u589e\u52a0\u9488\u5bf9BIGIP\u8fde\u63a5\u5f02\u5e38\u598240x 50x\uff0cconn-refused\u7b49\u7684\u5bb9\u9519\u80fd\u529b \u589e\u52a0\u7528\u6237\u914d\u7f6e\u6301\u4e45\u5316\u652f\u6301 \u589e\u5f3aAS3\u6570\u636e\u6821\u9a8c\u80fd\u529b\uff08\u9488\u5bf9AS3\u62a5\u6587>100kB\u7684\u573a\u666f\uff09 \u4fee\u590d\u5b8c\u5584Prometheus\u76d1\u63a7 metrics \uff0c\u589e\u52a0\u51fd\u6570\u7ea7\u6027\u80fd\u76d1\u63a7 \u5176\u4ed6\u529f\u80fd\u4fee\u590d\u548c\u6027\u80fd\u68c0\u6d4b\u8c03\u4f18 Release: 2.9.1-20220831 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u589e\u52a0\u5e76\u5b8c\u5584hub mode\u652f\u6301 \u589e\u52a0TLS SNI\u3001CA_Bundle\u53caTLS_Client\u652f\u6301 \u589e\u52a0\u5e76\u5b8c\u5584AS3\u4e2dsnat:self\u53caService_HTTPS:redirect80\u652f\u6301 \u589e\u52a0ltm/snat-translation \u7c7b\u578b\u652f\u6301 \u589e\u52a0\u65e5\u5fd7\u7ea7\u522b \u201ctrace\u201d \u4f18\u5316\u7f51\u7edc\u521b\u5efa\u3001\u6301\u4e45\u5316\u3001node\u5220\u9664\uff0c\u4ee5\u5b9e\u73b0\u6027\u80fd\u8c03\u4f18 \u4fee\u590diRule\u4e0b\u53d1\u65f6\u7279\u6b8a\u5b57\u7b26 < > & \u5904\u7406\u5f02\u5e38 \u4fee\u590d\u53d1\u5e03\u955c\u50cf\u7684\u5b89\u5168\u95ee\u9898CVE-2022-2097 Virtual Server \u7684 Connection Mirroring \u6253\u5f00\u6216\u5173\u95ed \u5176\u4ed6\u5df2\u77e5\u95ee\u9898\u4fee\u590d Release: 2.9.1-20220804 \u00b6 Docker Image \u00b6 f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220804 f5devcentral/cis-c-as3-parser:latest Release Notes \u00b6 \u90e8\u7f72\u4e0e\u73af\u5883\u652f\u6301 \u00b6 \u652f\u6301\u96c6\u7fa4\u5185\u548c\u96c6\u7fa4\u5916\u8fd0\u884c\u4e24\u79cd\u6a21\u5f0f \u652f\u6301k8s\u96c6\u7fa4\u4e1a\u52a1\u914d\u7f6e\u65b9\u5f0f\uff1adeployment+service\uff0c\u5e94\u7528\u4ea4\u4ed8\uff08\u5e94\u7528\u5bf9\u5916\u53d1\u5e03\uff09\u914d\u7f6e\u65b9\u5f0f\uff1aconfigmap( F5 AS3 \u4f5c\u4e3a\u6570\u636e\u4e3b\u4f53) \u652f\u6301k8s CNI\u7c7b\u578b\uff1aFlannel vxlan\u6216\u5176\u5b83underlay\u6a21\u5f0fCNI\uff08\u5982Calico\u8def\u7531\u6a21\u5f0f\uff0cKube-ovn underlay\u6a21\u5f0f\u7b49\uff09\uff0c\u914d\u7f6e\u7ec6\u8282\u53ef\u53c2\u8003 \u8fd9\u91cc \u652f\u6301\u5e7f\u6cdb\u7684k8s\u7248\u672c\uff0c\u5982\u60a8\u53d1\u73b0k8s\u7684\u7248\u672c\u652f\u6301\u95ee\u9898\uff0c\u8bf7 \u8054\u7cfb\u6211\u4eec \u6682\u4e0d\u652f\u6301Openshift \u652f\u6301x86 CPU\u3002 \u56fd\u4ea7\u6216ARM CPU\u652f\u6301\u8bf7\u4e0e\u6211\u4eec \u8054\u7cfb \u529f\u80fd\u4e0e\u884c\u4e3a\u652f\u6301 \u00b6 \u652f\u6301\u901a\u8fc7 namespace \u542f\u52a8\u53c2\u6570\u6307\u5b9a\u4e1a\u52a1\u53d1\u5e03\u8303\u56f4 \u652f\u6301\u4f7f\u7528 namespace-label \u542f\u52a8\u53c2\u6570\u6807\u8bb0\u4e1a\u52a1\u53d1\u5e03\u8303\u56f4\uff0c\u5b9e\u73b0\u6307\u5b9a\u8303\u56f4\u7684\u52a8\u6001\u6027 \u652f\u6301hub-mode\u65b9\u5f0f\uff0c\u4ee5\u4fbf\u4e1a\u52a1\u548c\u5e94\u7528\u4ea4\u4ed8\u914d\u7f6e\u53ef\u4ee5\u5728\u4e0d\u540c\u7684namespace\u4e2d\u5206\u522b\u8fdb\u884c\uff0c\u5b9e\u73b0\u4e0d\u540c\u89d2\u8272\u56e2\u961f\u7684\u5de5\u4f5c\u89e3\u8026 \u652f\u6301\u670d\u52a1\u7ed1\u5b9a\u4fdd\u62a4\uff0c\u907f\u514d\u8bef\u64cd\u4f5c\u5e26\u6765\u7684\u670d\u52a1\u8986\u76d6\u5f02\u5e38 \u652f\u6301\u9ed8\u8ba4\u670d\u52a1\u7aef\u53e3\u7ed1\u5b9a\uff1a\u5f53configmap\u5e94\u7528\u914d\u7f6e\u4e2d\u65e0\u7aef\u53e3\u6307\u5b9a\u65f6\uff0c\u81ea\u52a8\u9009\u62e9\u670d\u52a1\u7aef\u53e3 \u652f\u6301\u589e\u91cf\u5904\u7406\uff0c\u5e94\u7528\u4ea4\u4ed8\u914d\u7f6e\u4e0b\u53d1\u901f\u5ea6\u5feb \u652f\u6301BIG-IP\u4e0a\u6269\u5c55\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u5305\u62ec\u4ee5\u4e0b\u914d\u7f6e\u5bf9\u8c61\uff08\u53ca\u5176\u5b50\u53c2\u6570\u914d\u7f6e\u9879\uff09\uff0c\u652f\u6301\u7528\u6237\u5145\u5206\u53d1\u6325BIG-IP\u80fd\u529b\u3002\u66f4\u591a\u573a\u666f\u53ef\u53c2\u8003 \u8fd9\u91cc \uff1a * virtual * virtual-address * snatpool * pool/member/node * monitor\uff1agateway_icmp tcp udp http * profile: tcp ftp udp http clientssl oneconnect * persist: cookie source_addr * iRules \u652f\u6301IPv64\u8f6c\u6362,\u5373\u5bf9\u5916\u53d1\u5e03IPv6\u8bbf\u95eeIP\uff0c\u96c6\u7fa4\u5185\u4f7f\u7528IPv4\u3002\u4ea6\u652f\u6301\u96c6\u7fa4\u5185IPv6 \u8fd0\u7ef4\u4e0e\u5347\u7ea7\u652f\u6301 \u00b6 \u517c\u5bb9\u7528\u6237\u5f53\u524d\u5728CIS\u4e2d\u5df2\u7ecf\u53d1\u5e03\u7684configmap yaml\u683c\u5f0f\uff0c\u7528\u6237\u5728CIS-C\u4e2d\u65e0\u9700\u4fee\u6539\u5e94\u7528\u53d1\u5e03yaml \u652f\u6301\u4eceCIS\u5347\u7ea7\u5230CIS-C\uff0c\u9700\u8981\u501f\u52a9kic-tool\u5de5\u5177\u5b8c\u6210\u5347\u7ea7\u8fc1\u79fb \u652f\u6301\u65e5\u5fd7\u7ea7\u522b\u8f93\u51fa\u3001\u548c\u4efb\u52a1\u8ddf\u8e2a\uff08request_id\uff09 \u652f\u6301\u4e0ePrometheus\u96c6\u6210\uff0c\u91c7\u96c6\u63a7\u5236\u5668\u6027\u80fd\u6570\u636e \u5728\u6709\u6548\u7ba1\u7406\u4e0b\uff0cF5 CIS-C\u53ef\u4ee5\u4e0eF5 CIS\u540c\u65f6\u8fd0\u884c\uff0c\u5b9e\u73b0\u66f4\u7075\u6d3b\u4e30\u5bcc\u7684\u573a\u666f\u5e94\u5bf9","title":"\u7248\u672c\u53d1\u5e03"},{"location":"Release-notes/#_1","text":"","title":"\u7248\u672c\u53d1\u5e03"},{"location":"Release-notes/#release-2122-20230621","text":"","title":"Release: 2.12.2-20230621"},{"location":"Release-notes/#docker-image","text":"f5devcentral/k8s-bigip-ctlr-c:2.12.2-20230621 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes","text":"\u589e\u52a0\u5bf9flannel CNI\u4e2dhost-gw\u6a21\u5f0f\u7684\u652f\u6301 ( PR internal-only ), ( issue )\u3002","title":"Release Notes"},{"location":"Release-notes/#release-2121-20230608","text":"","title":"Release: 2.12.1-20230608"},{"location":"Release-notes/#docker-image_1","text":"f5devcentral/k8s-bigip-ctlr-c:2.12.1-20230608 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_1","text":"\u5b8c\u5584NodePort\u652f\u6301\uff0cServiceType\u53ef\u4ee5\u5728NodePort\u548cClusterIP\u4e24\u79cd\u7c7b\u578b\u95f4\u81ea\u7531\u5207\u6362\u90e8\u7f72\u3002( issue and PR )\u3002 \u589e\u52a0cis.f5.com/as3-tenant as3-app as3-pool \u4e09\u4e2alabel\u7684\u4e0b\u53d1\u54cd\u5e94\uff08\u88ab\u79fb\u9664\u3001\u65b0\u52a0\u65f6\u90fd\u4f1a\u89e6\u53d1\u8d44\u6e90\u4e0b\u53d1\u8c03\u6574\uff09( issue )\u3002 \u4f18\u5316\u4ee5\u4e0b\u8d44\u6e90\u7684\u4e0b\u53d1\u903b\u8f91(rest\u8bf7\u6c42+\u4e8b\u52a1)\uff1anet/arp net/ndp ltm/node","title":"Release Notes"},{"location":"Release-notes/#release-2111-20230216","text":"","title":"Release: 2.11.1-20230216"},{"location":"Release-notes/#docker-image_2","text":"f5devcentral/k8s-bigip-ctlr-c:2.11.1-20230216 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_2","text":"\u4fee\u590d\u670d\u52a1\u6807\u7b7e\u7ed1\u5b9a\u5f02\u5e38( issue and PR )\u3002 \u5b8c\u5584\u5177\u5907request id\u7684\u65e5\u5fd7\u8f93\u51fa( PR )\u3002","title":"Release Notes"},{"location":"Release-notes/#release-2101-20221201","text":"","title":"Release: 2.10.1-20221201"},{"location":"Release-notes/#docker-image_3","text":"f5devcentral/k8s-bigip-ctlr-c:2.10.1-20221201 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_3","text":"\u589e\u5f3a\u5e95\u5c42\u6a21\u5757\u7ba1\u7406\uff0c\u4e1a\u52a1\u4e0b\u53d1\u548cAS3\u89e3\u6790\u903b\u8f91\u72ec\u7acb\u4e3a f5-bigip-rest \u548c f5-as3-parsing \u589e\u5f3a\u5b89\u5168\u4ea4\u4ed8\u80fd\u529b\uff0c\u914d\u7f6e\u975eroot\u7528\u6237\u8fd0\u884cCIS-C \u4f18\u5316iControlRest\u751f\u6210\u903b\u8f91 \u589e\u5f3a\u5bf9\u51fd\u6570\u8017\u65f6\u76d1\u63a7\u80fd\u529b","title":"Release Notes"},{"location":"Release-notes/#release-2101-20221031","text":"","title":"Release: 2.10.1-20221031"},{"location":"Release-notes/#docker-image_4","text":"f5devcentral/k8s-bigip-ctlr-c:2.10.1-20221031 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_4","text":"\u589e\u5f3a\u8d44\u6e90\u4e0b\u53d1\u7684\u79df\u6237\u7ba1\u7406 \u589e\u5f3aIPv6\u652f\u6301\uff0c\u5e76\u5b8c\u5584\u76f8\u5173\u6587\u6863 \u5176\u4ed6\u529f\u80fd\u4fee\u590d\u548c\u6027\u80fd\u68c0\u6d4b\u8c03\u4f18","title":"Release Notes"},{"location":"Release-notes/#release-291-20220930","text":"","title":"Release: 2.9.1-20220930"},{"location":"Release-notes/#docker-image_5","text":"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220930 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_5","text":"\u589e\u52a0\u5bf9k8s IPv6\u73af\u5883\u53cav4-v6\u6df7\u5408\u90e8\u7f72\u73af\u5883 \u652f\u6301 \u589e\u52a0 \u4e0eCIS\u5171\u5b58 \u80fd\u529b\u652f\u6301\uff0c\u5f52\u7f6earp\u4e8e\u72ec\u7acbpartition \u589e\u52a0\u9488\u5bf9BIGIP\u8fde\u63a5\u5f02\u5e38\u598240x 50x\uff0cconn-refused\u7b49\u7684\u5bb9\u9519\u80fd\u529b \u589e\u52a0\u7528\u6237\u914d\u7f6e\u6301\u4e45\u5316\u652f\u6301 \u589e\u5f3aAS3\u6570\u636e\u6821\u9a8c\u80fd\u529b\uff08\u9488\u5bf9AS3\u62a5\u6587>100kB\u7684\u573a\u666f\uff09 \u4fee\u590d\u5b8c\u5584Prometheus\u76d1\u63a7 metrics \uff0c\u589e\u52a0\u51fd\u6570\u7ea7\u6027\u80fd\u76d1\u63a7 \u5176\u4ed6\u529f\u80fd\u4fee\u590d\u548c\u6027\u80fd\u68c0\u6d4b\u8c03\u4f18","title":"Release Notes"},{"location":"Release-notes/#release-291-20220831","text":"","title":"Release: 2.9.1-20220831"},{"location":"Release-notes/#docker-image_6","text":"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_6","text":"\u589e\u52a0\u5e76\u5b8c\u5584hub mode\u652f\u6301 \u589e\u52a0TLS SNI\u3001CA_Bundle\u53caTLS_Client\u652f\u6301 \u589e\u52a0\u5e76\u5b8c\u5584AS3\u4e2dsnat:self\u53caService_HTTPS:redirect80\u652f\u6301 \u589e\u52a0ltm/snat-translation \u7c7b\u578b\u652f\u6301 \u589e\u52a0\u65e5\u5fd7\u7ea7\u522b \u201ctrace\u201d \u4f18\u5316\u7f51\u7edc\u521b\u5efa\u3001\u6301\u4e45\u5316\u3001node\u5220\u9664\uff0c\u4ee5\u5b9e\u73b0\u6027\u80fd\u8c03\u4f18 \u4fee\u590diRule\u4e0b\u53d1\u65f6\u7279\u6b8a\u5b57\u7b26 < > & \u5904\u7406\u5f02\u5e38 \u4fee\u590d\u53d1\u5e03\u955c\u50cf\u7684\u5b89\u5168\u95ee\u9898CVE-2022-2097 Virtual Server \u7684 Connection Mirroring \u6253\u5f00\u6216\u5173\u95ed \u5176\u4ed6\u5df2\u77e5\u95ee\u9898\u4fee\u590d","title":"Release Notes"},{"location":"Release-notes/#release-291-20220804","text":"","title":"Release: 2.9.1-20220804"},{"location":"Release-notes/#docker-image_7","text":"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220804 f5devcentral/cis-c-as3-parser:latest","title":"Docker Image"},{"location":"Release-notes/#release-notes_7","text":"","title":"Release Notes"},{"location":"Release-notes/#_2","text":"\u652f\u6301\u96c6\u7fa4\u5185\u548c\u96c6\u7fa4\u5916\u8fd0\u884c\u4e24\u79cd\u6a21\u5f0f \u652f\u6301k8s\u96c6\u7fa4\u4e1a\u52a1\u914d\u7f6e\u65b9\u5f0f\uff1adeployment+service\uff0c\u5e94\u7528\u4ea4\u4ed8\uff08\u5e94\u7528\u5bf9\u5916\u53d1\u5e03\uff09\u914d\u7f6e\u65b9\u5f0f\uff1aconfigmap( F5 AS3 \u4f5c\u4e3a\u6570\u636e\u4e3b\u4f53) \u652f\u6301k8s CNI\u7c7b\u578b\uff1aFlannel vxlan\u6216\u5176\u5b83underlay\u6a21\u5f0fCNI\uff08\u5982Calico\u8def\u7531\u6a21\u5f0f\uff0cKube-ovn underlay\u6a21\u5f0f\u7b49\uff09\uff0c\u914d\u7f6e\u7ec6\u8282\u53ef\u53c2\u8003 \u8fd9\u91cc \u652f\u6301\u5e7f\u6cdb\u7684k8s\u7248\u672c\uff0c\u5982\u60a8\u53d1\u73b0k8s\u7684\u7248\u672c\u652f\u6301\u95ee\u9898\uff0c\u8bf7 \u8054\u7cfb\u6211\u4eec \u6682\u4e0d\u652f\u6301Openshift \u652f\u6301x86 CPU\u3002 \u56fd\u4ea7\u6216ARM CPU\u652f\u6301\u8bf7\u4e0e\u6211\u4eec \u8054\u7cfb","title":"\u90e8\u7f72\u4e0e\u73af\u5883\u652f\u6301"},{"location":"Release-notes/#_3","text":"\u652f\u6301\u901a\u8fc7 namespace \u542f\u52a8\u53c2\u6570\u6307\u5b9a\u4e1a\u52a1\u53d1\u5e03\u8303\u56f4 \u652f\u6301\u4f7f\u7528 namespace-label \u542f\u52a8\u53c2\u6570\u6807\u8bb0\u4e1a\u52a1\u53d1\u5e03\u8303\u56f4\uff0c\u5b9e\u73b0\u6307\u5b9a\u8303\u56f4\u7684\u52a8\u6001\u6027 \u652f\u6301hub-mode\u65b9\u5f0f\uff0c\u4ee5\u4fbf\u4e1a\u52a1\u548c\u5e94\u7528\u4ea4\u4ed8\u914d\u7f6e\u53ef\u4ee5\u5728\u4e0d\u540c\u7684namespace\u4e2d\u5206\u522b\u8fdb\u884c\uff0c\u5b9e\u73b0\u4e0d\u540c\u89d2\u8272\u56e2\u961f\u7684\u5de5\u4f5c\u89e3\u8026 \u652f\u6301\u670d\u52a1\u7ed1\u5b9a\u4fdd\u62a4\uff0c\u907f\u514d\u8bef\u64cd\u4f5c\u5e26\u6765\u7684\u670d\u52a1\u8986\u76d6\u5f02\u5e38 \u652f\u6301\u9ed8\u8ba4\u670d\u52a1\u7aef\u53e3\u7ed1\u5b9a\uff1a\u5f53configmap\u5e94\u7528\u914d\u7f6e\u4e2d\u65e0\u7aef\u53e3\u6307\u5b9a\u65f6\uff0c\u81ea\u52a8\u9009\u62e9\u670d\u52a1\u7aef\u53e3 \u652f\u6301\u589e\u91cf\u5904\u7406\uff0c\u5e94\u7528\u4ea4\u4ed8\u914d\u7f6e\u4e0b\u53d1\u901f\u5ea6\u5feb \u652f\u6301BIG-IP\u4e0a\u6269\u5c55\u5e94\u7528\u4ea4\u4ed8\u80fd\u529b\u5305\u62ec\u4ee5\u4e0b\u914d\u7f6e\u5bf9\u8c61\uff08\u53ca\u5176\u5b50\u53c2\u6570\u914d\u7f6e\u9879\uff09\uff0c\u652f\u6301\u7528\u6237\u5145\u5206\u53d1\u6325BIG-IP\u80fd\u529b\u3002\u66f4\u591a\u573a\u666f\u53ef\u53c2\u8003 \u8fd9\u91cc \uff1a * virtual * virtual-address * snatpool * pool/member/node * monitor\uff1agateway_icmp tcp udp http * profile: tcp ftp udp http clientssl oneconnect * persist: cookie source_addr * iRules \u652f\u6301IPv64\u8f6c\u6362,\u5373\u5bf9\u5916\u53d1\u5e03IPv6\u8bbf\u95eeIP\uff0c\u96c6\u7fa4\u5185\u4f7f\u7528IPv4\u3002\u4ea6\u652f\u6301\u96c6\u7fa4\u5185IPv6","title":"\u529f\u80fd\u4e0e\u884c\u4e3a\u652f\u6301"},{"location":"Release-notes/#_4","text":"\u517c\u5bb9\u7528\u6237\u5f53\u524d\u5728CIS\u4e2d\u5df2\u7ecf\u53d1\u5e03\u7684configmap yaml\u683c\u5f0f\uff0c\u7528\u6237\u5728CIS-C\u4e2d\u65e0\u9700\u4fee\u6539\u5e94\u7528\u53d1\u5e03yaml \u652f\u6301\u4eceCIS\u5347\u7ea7\u5230CIS-C\uff0c\u9700\u8981\u501f\u52a9kic-tool\u5de5\u5177\u5b8c\u6210\u5347\u7ea7\u8fc1\u79fb \u652f\u6301\u65e5\u5fd7\u7ea7\u522b\u8f93\u51fa\u3001\u548c\u4efb\u52a1\u8ddf\u8e2a\uff08request_id\uff09 \u652f\u6301\u4e0ePrometheus\u96c6\u6210\uff0c\u91c7\u96c6\u63a7\u5236\u5668\u6027\u80fd\u6570\u636e \u5728\u6709\u6548\u7ba1\u7406\u4e0b\uff0cF5 CIS-C\u53ef\u4ee5\u4e0eF5 CIS\u540c\u65f6\u8fd0\u884c\uff0c\u5b9e\u73b0\u66f4\u7075\u6d3b\u4e30\u5bcc\u7684\u573a\u666f\u5e94\u5bf9","title":"\u8fd0\u7ef4\u4e0e\u5347\u7ea7\u652f\u6301"},{"location":"Support-and-contact/","text":"\u652f\u6301\u4e0e\u8054\u7cfb \u00b6 \u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u5f97\u6280\u672f\u652f\u6301\u4e0e\u670d\u52a1\uff1a \u4ee5Github Issues \u65b9\u5f0f\u5728\u793e\u533a\u5185\u63d0\u4ea4\uff0c\u8fd9\u662f\u4f18\u5148\u5efa\u8bae\u7684\u65b9\u5f0f\u3002 \u5728\u6807\u51c6\u5de5\u4f5c\u65f6\u95f4\u5185\uff089AM-18PM \u5317\u4eac\u65f6\u533a)\u62e8\u6253F5\u6280\u672f\u652f\u6301\u70ed\u7ebf\u3002\u5982\u60a8\u7684BIG-IP\u5177\u67097*24\u670d\u52a1\uff0c\u5728\u975e\u5de5\u4f5c\u65f6\u95f4\u5185\u60a8\u53ef\u4ee5\u7d27\u6025\u8054\u7cfb\u5bf9\u5e94\u6280\u672f\u652f\u6301\u5de5\u7a0b\u5e08\u3002","title":"\u6280\u672f\u652f\u6301"},{"location":"Support-and-contact/#_1","text":"\u60a8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u5f97\u6280\u672f\u652f\u6301\u4e0e\u670d\u52a1\uff1a \u4ee5Github Issues \u65b9\u5f0f\u5728\u793e\u533a\u5185\u63d0\u4ea4\uff0c\u8fd9\u662f\u4f18\u5148\u5efa\u8bae\u7684\u65b9\u5f0f\u3002 \u5728\u6807\u51c6\u5de5\u4f5c\u65f6\u95f4\u5185\uff089AM-18PM \u5317\u4eac\u65f6\u533a)\u62e8\u6253F5\u6280\u672f\u652f\u6301\u70ed\u7ebf\u3002\u5982\u60a8\u7684BIG-IP\u5177\u67097*24\u670d\u52a1\uff0c\u5728\u975e\u5de5\u4f5c\u65f6\u95f4\u5185\u60a8\u53ef\u4ee5\u7d27\u6025\u8054\u7cfb\u5bf9\u5e94\u6280\u672f\u652f\u6301\u5de5\u7a0b\u5e08\u3002","title":"\u652f\u6301\u4e0e\u8054\u7cfb"},{"location":"Support-and-contact/doc-revise/","text":"\u6b22\u8fce\u8d21\u732e\u6587\u6863 \u00b6 \u5982\u60a8\u53d1\u73b0\u6587\u6863\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u6b22\u8fce\u4ee5Github Issues \u65b9\u5f0f\u63d0\u51fa\u3002\u6216\u76f4\u63a5PR\u66f4\u65b0\u7ed9\u6211\u4eec\u3002 \u60a8\u7684\u8d21\u732e\u5c06\u88ab\u5c55\u793a\u5728\u8fd9\u91cc\u3002\u5f53\u524d\u6587\u6863\u8d21\u732e\u4eba\u5458\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff1a myf5 Jing Lin Niklaus-xie zongzw f5zong jinjia812 f5-will kylinsoong xingjia2022 \u5317\u94f6","title":"\u6587\u6863\u7ea0\u9519"},{"location":"Support-and-contact/doc-revise/#_1","text":"\u5982\u60a8\u53d1\u73b0\u6587\u6863\u6709\u4efb\u4f55\u9519\u8bef\uff0c\u6b22\u8fce\u4ee5Github Issues \u65b9\u5f0f\u63d0\u51fa\u3002\u6216\u76f4\u63a5PR\u66f4\u65b0\u7ed9\u6211\u4eec\u3002 \u60a8\u7684\u8d21\u732e\u5c06\u88ab\u5c55\u793a\u5728\u8fd9\u91cc\u3002\u5f53\u524d\u6587\u6863\u8d21\u732e\u4eba\u5458\uff08\u6392\u540d\u4e0d\u5206\u5148\u540e\uff09\uff1a myf5 Jing Lin Niklaus-xie zongzw f5zong jinjia812 f5-will kylinsoong xingjia2022 \u5317\u94f6","title":"\u6b22\u8fce\u8d21\u732e\u6587\u6863"},{"location":"Use-Cases/cis-and-cis-c/","text":"\u4ec0\u4e48\u60c5\u5f62\u4e0b\u4f1a\u8003\u8651CIS\u4e0eCIS-C\u7684\u6df7\u5408\u90e8\u7f72 \u00b6 \u4eceCIS\u5411CIS-C\u8fc1\u79fb\u7684\u8fc7\u6e21\u9636\u6bb5 \u9700\u8981\u7ee7\u7eed\u4f7f\u7528k8s Ingress\u8d44\u6e90\u3001CIS CRD\u8d44\u6e90\u3001\u4ee5\u53ca\u65e9\u671f\u7684cccl\u6a21\u578b\u4e0b\u7684Configmap\u8d44\u6e90\u6765\u8fdb\u884c\u4e1a\u52a1\u53d1\u5e03\uff0c\u4f46\u540c\u65f6\u53c8\u5e0c\u671b\u5bf9AS3 Configmap\u53d1\u5e03\u65b9\u5f0f\u5177\u6709\u66f4\u9ad8\u53d1\u5e03\u6027\u80fd\u3002\u53ef\u4f7f\u7528CIS\u7ee7\u7eed\u76d1\u542cIngress\u3001CRD\u7b49\u8d44\u6e90\uff0c\u5bf9\u4e8e\u4f7f\u7528AS3\u8bed\u6cd5\u7684Configmap\u8d44\u6e90\u5219\u91c7\u7528CIS-C\u6765\u53d1\u5e03 \u5728\u67b6\u6784\u8bbe\u8ba1\u4e0a\uff0c\u9700\u8981\u540c\u65f6\u652f\u6301Ingress\uff0cCRD\uff0cAS3 Configmap\u8fd9\u4e09\u79cd\u8d44\u6e90\u6a21\u5f0f\u7684 \u6df7\u5408\u90e8\u7f72\u9700\u8981\u8003\u8651\u7684\u95ee\u9898 \u00b6 \u4e0d\u540c\u7684\u63a7\u5236\u5668\u4e0d\u5e94\u540c\u65f6\u76d1\u63a7\u76f8\u540c\u7684k8s\u8d44\u6e90\uff0c\u5e94\u91c7\u7528 --namespace \u3001 --namespace-label \u542f\u52a8\u53c2\u6570 \u5bf9\u76d1\u63a7\u7684\u8d44\u6e90\u8fdb\u884c\u9694\u79bb \u4e0d\u540c\u7684\u63a7\u5236\u5668\u4e0b\u53d1\u7684\u914d\u7f6e\u5bf9\u8c61\u5e94\u5206\u522b\u5bf9\u5e94\u5728F5 BIG-IP\u7684\u4e0d\u540cpartition\u5206\u533a\u5185 \u5728Overlay CNI\u73af\u5883\u4e0b\uff0c\u9700\u8981\u8003\u8651\u4e0d\u540c\u63a7\u5236\u5668\u5199\u5165\u7684\u9759\u6001ARP\u3001FDB\u6761\u76ee\u662f\u5426\u5b58\u5728\u51b2\u7a81\uff1a FDB: CIS-C\u4f1a\u68c0\u6d4bBIG-IP\u4e0a\u7684\u5173\u4e8enodes FDB\u6761\u76ee\u662f\u5426\u5b58\u5728\uff0c\u56e0\u6b64\u4e0d\u4f1a\u53d1\u751f\u95ee\u9898 ARP: \u5bf9\u4e8epod\u76f8\u5173\u7684\u9759\u6001ARP\uff0cCIS\u91c7\u7528\u8986\u76d6\u6027\u5199\u5165\u7684\u65b9\u5f0f\uff0c\u5373CIS\u5468\u671f\u6027\u5237\u65b0\u6240\u6709ARP\u6761\u76ee\uff0c\u9700\u8981\u8ba9CIS\u548cCIS-C\u6240\u5199\u5165\u7684ARP\u6761\u76ee\u4f4d\u4e8e\u4e0d\u540c\u7684partition\u4e0b\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u9ad8\u4e8e 2.9.1-20220831 \u7684\u7248\u672cCIS-C\uff0c\u5219CIS-C\u4f1a\u5c06ARP\u5199\u5165\u5230 /cis-c-tenant partition\u4e0b\uff0c\u56e0\u6b64\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81 \u63d0\u793a1\uff1a\u5982\u679c\u60a8\u4ece\u4f4e\u4e8e 2.9.1-20220831 \uff08\u542b\uff09\u5347\u7ea7\u5230\u66f4\u65b0\u7248\u672cCIS-C\uff0cCIS-C\u4f1a\u81ea\u52a8\u5c06\u5df2\u5199\u5165 /Common partition\u4e0b\u7684ARP\u6761\u76ee\u4fee\u6539\u5230 cis-c-tenant \u4e0b\uff0c cis-c-tenant \u7531CIS-C\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa(\u5f53\u53d1\u73b0\u5176\u4e0d\u5b58\u5728\u65f6)\u3002\u76ee\u524d\uff0c\u8be5partition\u6ca1\u6709\u53c2\u6570\u5316\uff1b\u8be5partition\u4f9d\u65e7\u53ef\u7528\u4e8e\u4e0b\u53d1\u7528\u6237\u914d\u7f6e\uff0c\u4f46\u4e0d\u540c\u4e8e\u5176\u4ed6partition\uff0c\u5728\u5220\u9664\u914d\u7f6e\u65f6\uff0c\u5b83\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7**\u5c3d\u91cf**\u907f\u5f00\u6b64partition\u4e0b\u53d1\u7528\u6237\u914d\u7f6e\u3002 \u63d0\u793a2\uff1a\u5bf9\u4e8eCIS-C\u4f4e\u4e8e\u6216\u7b49\u4e8e 2.9.1-20220831 \u7684\u7248\u672c\uff0c\u60a8\u4e5f\u53ef\u4ee5\u9009\u62e9\u4fee\u6539CIS\u7684\u9ed8\u8ba4ARP\u5199\u5165partition\u6765\u907f\u514d\u51b2\u7a81\u95ee\u9898\uff0c\u4f8b\u5982\uff0c\u5c06\u542f\u52a8\u8bbe\u7f6e --flannel-name=/Common/flannel_vxlan \u4fee\u6539\u4e3a --flannel-name=/k8s/flannel_vxlan \uff0c\u5219\u76f8\u5e94ARP\u6761\u76ee\u4f1a\u5199\u5165\u5230k8s partition\u4e0b\uff08k8s\u662f\u4e00\u4e2a\u63d0\u524d\u624b\u5de5\u5efa\u7acb\u597d\u7684partition\uff09\u3002\u6b64\u64cd\u4f5c\u5728\u751f\u4ea7\u73af\u5883\u64cd\u4f5c\u9700\u8c28\u614e\u3002 \u5728\u672c\u6587\u4ee5\u4e0b\u7684\u6848\u4f8b\u4e2d\u4f7f\u7528\u7684\u662f\u5373\u662f\u4fee\u6539CIS\u7684\u53c2\u6570\u65b9\u5f0f\u3002 \u975eOverlay CNI\u73af\u5883\u6216CIS\u4e0eCIS-C\u5bf9\u63a5\u4e0d\u540cBIG-IP\u573a\u666f\u65f6\uff0c\u65e0\u8003\u8651\u4e0a\u8ff0\u9759\u6001ARP\u95ee\u9898\u4ee5\u53ca\u76ee\u6807partition\u95ee\u9898 \u6848\u4f8b1\uff1aHub\u6a21\u5f0f\u4e0b\u6df7\u5408\u90e8\u7f72 \u00b6 \u7ed3\u6784\u900f\u89c6\u56fe \u00b6 \u5728\u672c\u793a\u4f8b\u4e2d\uff0cCIS\u63a7\u5236\u5668\u76d1\u63a7 f5cis namespace\u5185\u7684AS3\u53d1\u5e03\u8d44\u6e90\uff0c\u8ba9CIS-C\u76d1\u63a7 cis-c-hub \u4e0b\u7684AS3\u53d1\u5e03\u8d44\u6e90\u3002\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a Configmap Yaml\u793a\u4f8b \u00b6 f5cis-hub-as3-cm yaml \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : f5cis-hub-as3-cm namespace : f5cis labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_as3_2\": { \"class\": \"Tenant\", \"nginxdemo_as3_2\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.145\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_2\" }, \"nginxdemo_pool_as3_2\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } } cis-c-hub-as3 Yaml \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-hub-as3-cm namespace : cis-c-hub labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_c_as3_1\": { \"class\": \"Tenant\", \"nginxdemo_as3_1\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.149\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_1\" }, \"nginxdemo_pool_as3_1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } } F5 BIGIP-IP\u914d\u7f6e\u6548\u679c \u00b6 \u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570\u793a\u4f8b \u00b6 CIS\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570 \u00b6 containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = 172 .16.20.205 - --bigip-partition = k8s - --verify-interval = 5 - --node-poll-interval = 5 - --pool-member-type = cluster - --default-ingress-ip = 172 .16.100.196 - --namespace = f5cis - --log-as3-response - --ingress-class = f5 - --hubmode = true - --disable-teems = true - --insecure = true - --log-level = INFO - --http-listen-address = 0 .0.0.0:9113 - --flannel-name = /k8s/flannel_vxlan CIS-C\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570 \u00b6 containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = https://172.16.20.205 - --log-level = debug - --flannel-name = flannel_vxlan - --namespace = cis-c-hub - --hub-mode = true - --ignore-service-port \u975eHub\u6a21\u5f0f\u6df7\u5408\u90e8\u7f72 \u00b6 \u7ed3\u6784\u900f\u89c6\u56fe \u00b6 \u5728\u672c\u793a\u4f8b\u4e2d\uff0cCIS\u63a7\u5236\u5668\u76d1\u63a7 as3-2 namespace\u5185\u7684AS3\u53d1\u5e03\u8d44\u6e90\uff0c\u8ba9CIS-C\u76d1\u63a7 as3-1 \u4e0b\u7684AS3\u53d1\u5e03\u8d44\u6e90\u3002\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a Confgimap Yaml\u793a\u4f8b \u00b6 cis-as3-2-as3-cm \u793a\u4f8b \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-as3-2-as3-cm namespace : as3-2 labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_as3_2\": { \"class\": \"Tenant\", \"nginxdemo_as3_2\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.145\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_2\" }, \"nginxdemo_pool_as3_2\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } } cis-c-as3-1-as3-cm\u793a\u4f8b \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-as3-1-as3-cm namespace : as3-1 labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-as3-1\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_c_as3_1\": { \"class\": \"Tenant\", \"nginxdemo_as3_1\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.149\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_1\" }, \"nginxdemo_pool_as3_1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } } F5 BIGIP-IP\u914d\u7f6e\u6548\u679c: \u00b6 \u76f8\u5bf9\u4e8e\u4ee5\u4e0aHub\u6a21\u5f0f\u4e0b\u7684\u914d\u7f6e\uff0cConfigmap\u91cc\u5bf9\u5e94\u7684F5 partiton\uff08tenant\uff09\u5e76\u672a\u53d1\u751f\u53d8\u5316\uff0c\u5bf9\u8c61\u547d\u540d\u4e5f\u5747\u672a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u5728BIG-IP\u7684\u6700\u7ec8\u6548\u679c\u4e0e\u4e0a\u56fe\u4e00\u81f4\u3002 \u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570\u793a\u4f8b \u00b6 CIS\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570 \u00b6 containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = 172 .16.20.205 - --bigip-partition = k8s - --verify-interval = 5 - --node-poll-interval = 5 - --pool-member-type = cluster - --default-ingress-ip = 172 .16.100.196 - --namespace = as3-2 <<< << as3-2 namespace - --hubmode=false <<<<<<\u975ehub\u6a21\u5f0f - --log-as3 -response - --ingress-class = f5 - --disable-teems = true - --insecure = true - --log-level = INFO - --http-listen-address = 0 .0.0.0:9113 - --flannel-name = /k8s/flannel_vxlan CIS-C\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570 \u00b6 containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = https://172.16.20.205 - --log-level = debug - --flannel-name = flannel_vxlan - --namespace = as3-1 <<< << as3-1 na mespace - --hub-mode = false <<< << \u975ehub\u6a21\u5f0f - --ignore-service-port","title":"CIS\u4e0eCIS-C\u6df7\u5408\u90e8\u7f72"},{"location":"Use-Cases/cis-and-cis-c/#ciscis-c","text":"\u4eceCIS\u5411CIS-C\u8fc1\u79fb\u7684\u8fc7\u6e21\u9636\u6bb5 \u9700\u8981\u7ee7\u7eed\u4f7f\u7528k8s Ingress\u8d44\u6e90\u3001CIS CRD\u8d44\u6e90\u3001\u4ee5\u53ca\u65e9\u671f\u7684cccl\u6a21\u578b\u4e0b\u7684Configmap\u8d44\u6e90\u6765\u8fdb\u884c\u4e1a\u52a1\u53d1\u5e03\uff0c\u4f46\u540c\u65f6\u53c8\u5e0c\u671b\u5bf9AS3 Configmap\u53d1\u5e03\u65b9\u5f0f\u5177\u6709\u66f4\u9ad8\u53d1\u5e03\u6027\u80fd\u3002\u53ef\u4f7f\u7528CIS\u7ee7\u7eed\u76d1\u542cIngress\u3001CRD\u7b49\u8d44\u6e90\uff0c\u5bf9\u4e8e\u4f7f\u7528AS3\u8bed\u6cd5\u7684Configmap\u8d44\u6e90\u5219\u91c7\u7528CIS-C\u6765\u53d1\u5e03 \u5728\u67b6\u6784\u8bbe\u8ba1\u4e0a\uff0c\u9700\u8981\u540c\u65f6\u652f\u6301Ingress\uff0cCRD\uff0cAS3 Configmap\u8fd9\u4e09\u79cd\u8d44\u6e90\u6a21\u5f0f\u7684","title":"\u4ec0\u4e48\u60c5\u5f62\u4e0b\u4f1a\u8003\u8651CIS\u4e0eCIS-C\u7684\u6df7\u5408\u90e8\u7f72"},{"location":"Use-Cases/cis-and-cis-c/#_1","text":"\u4e0d\u540c\u7684\u63a7\u5236\u5668\u4e0d\u5e94\u540c\u65f6\u76d1\u63a7\u76f8\u540c\u7684k8s\u8d44\u6e90\uff0c\u5e94\u91c7\u7528 --namespace \u3001 --namespace-label \u542f\u52a8\u53c2\u6570 \u5bf9\u76d1\u63a7\u7684\u8d44\u6e90\u8fdb\u884c\u9694\u79bb \u4e0d\u540c\u7684\u63a7\u5236\u5668\u4e0b\u53d1\u7684\u914d\u7f6e\u5bf9\u8c61\u5e94\u5206\u522b\u5bf9\u5e94\u5728F5 BIG-IP\u7684\u4e0d\u540cpartition\u5206\u533a\u5185 \u5728Overlay CNI\u73af\u5883\u4e0b\uff0c\u9700\u8981\u8003\u8651\u4e0d\u540c\u63a7\u5236\u5668\u5199\u5165\u7684\u9759\u6001ARP\u3001FDB\u6761\u76ee\u662f\u5426\u5b58\u5728\u51b2\u7a81\uff1a FDB: CIS-C\u4f1a\u68c0\u6d4bBIG-IP\u4e0a\u7684\u5173\u4e8enodes FDB\u6761\u76ee\u662f\u5426\u5b58\u5728\uff0c\u56e0\u6b64\u4e0d\u4f1a\u53d1\u751f\u95ee\u9898 ARP: \u5bf9\u4e8epod\u76f8\u5173\u7684\u9759\u6001ARP\uff0cCIS\u91c7\u7528\u8986\u76d6\u6027\u5199\u5165\u7684\u65b9\u5f0f\uff0c\u5373CIS\u5468\u671f\u6027\u5237\u65b0\u6240\u6709ARP\u6761\u76ee\uff0c\u9700\u8981\u8ba9CIS\u548cCIS-C\u6240\u5199\u5165\u7684ARP\u6761\u76ee\u4f4d\u4e8e\u4e0d\u540c\u7684partition\u4e0b\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u9ad8\u4e8e 2.9.1-20220831 \u7684\u7248\u672cCIS-C\uff0c\u5219CIS-C\u4f1a\u5c06ARP\u5199\u5165\u5230 /cis-c-tenant partition\u4e0b\uff0c\u56e0\u6b64\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81 \u63d0\u793a1\uff1a\u5982\u679c\u60a8\u4ece\u4f4e\u4e8e 2.9.1-20220831 \uff08\u542b\uff09\u5347\u7ea7\u5230\u66f4\u65b0\u7248\u672cCIS-C\uff0cCIS-C\u4f1a\u81ea\u52a8\u5c06\u5df2\u5199\u5165 /Common partition\u4e0b\u7684ARP\u6761\u76ee\u4fee\u6539\u5230 cis-c-tenant \u4e0b\uff0c cis-c-tenant \u7531CIS-C\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa(\u5f53\u53d1\u73b0\u5176\u4e0d\u5b58\u5728\u65f6)\u3002\u76ee\u524d\uff0c\u8be5partition\u6ca1\u6709\u53c2\u6570\u5316\uff1b\u8be5partition\u4f9d\u65e7\u53ef\u7528\u4e8e\u4e0b\u53d1\u7528\u6237\u914d\u7f6e\uff0c\u4f46\u4e0d\u540c\u4e8e\u5176\u4ed6partition\uff0c\u5728\u5220\u9664\u914d\u7f6e\u65f6\uff0c\u5b83\u4e0d\u4f1a\u88ab\u5220\u9664\uff0c\u8bf7**\u5c3d\u91cf**\u907f\u5f00\u6b64partition\u4e0b\u53d1\u7528\u6237\u914d\u7f6e\u3002 \u63d0\u793a2\uff1a\u5bf9\u4e8eCIS-C\u4f4e\u4e8e\u6216\u7b49\u4e8e 2.9.1-20220831 \u7684\u7248\u672c\uff0c\u60a8\u4e5f\u53ef\u4ee5\u9009\u62e9\u4fee\u6539CIS\u7684\u9ed8\u8ba4ARP\u5199\u5165partition\u6765\u907f\u514d\u51b2\u7a81\u95ee\u9898\uff0c\u4f8b\u5982\uff0c\u5c06\u542f\u52a8\u8bbe\u7f6e --flannel-name=/Common/flannel_vxlan \u4fee\u6539\u4e3a --flannel-name=/k8s/flannel_vxlan \uff0c\u5219\u76f8\u5e94ARP\u6761\u76ee\u4f1a\u5199\u5165\u5230k8s partition\u4e0b\uff08k8s\u662f\u4e00\u4e2a\u63d0\u524d\u624b\u5de5\u5efa\u7acb\u597d\u7684partition\uff09\u3002\u6b64\u64cd\u4f5c\u5728\u751f\u4ea7\u73af\u5883\u64cd\u4f5c\u9700\u8c28\u614e\u3002 \u5728\u672c\u6587\u4ee5\u4e0b\u7684\u6848\u4f8b\u4e2d\u4f7f\u7528\u7684\u662f\u5373\u662f\u4fee\u6539CIS\u7684\u53c2\u6570\u65b9\u5f0f\u3002 \u975eOverlay CNI\u73af\u5883\u6216CIS\u4e0eCIS-C\u5bf9\u63a5\u4e0d\u540cBIG-IP\u573a\u666f\u65f6\uff0c\u65e0\u8003\u8651\u4e0a\u8ff0\u9759\u6001ARP\u95ee\u9898\u4ee5\u53ca\u76ee\u6807partition\u95ee\u9898","title":"\u6df7\u5408\u90e8\u7f72\u9700\u8981\u8003\u8651\u7684\u95ee\u9898"},{"location":"Use-Cases/cis-and-cis-c/#1hub","text":"","title":"\u6848\u4f8b1\uff1aHub\u6a21\u5f0f\u4e0b\u6df7\u5408\u90e8\u7f72"},{"location":"Use-Cases/cis-and-cis-c/#_2","text":"\u5728\u672c\u793a\u4f8b\u4e2d\uff0cCIS\u63a7\u5236\u5668\u76d1\u63a7 f5cis namespace\u5185\u7684AS3\u53d1\u5e03\u8d44\u6e90\uff0c\u8ba9CIS-C\u76d1\u63a7 cis-c-hub \u4e0b\u7684AS3\u53d1\u5e03\u8d44\u6e90\u3002\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a","title":"\u7ed3\u6784\u900f\u89c6\u56fe"},{"location":"Use-Cases/cis-and-cis-c/#configmap-yaml","text":"","title":"Configmap Yaml\u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#f5cis-hub-as3-cm-yaml","text":"kind : ConfigMap apiVersion : v1 metadata : name : f5cis-hub-as3-cm namespace : f5cis labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_as3_2\": { \"class\": \"Tenant\", \"nginxdemo_as3_2\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.145\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_2\" }, \"nginxdemo_pool_as3_2\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } }","title":"f5cis-hub-as3-cm yaml"},{"location":"Use-Cases/cis-and-cis-c/#cis-c-hub-as3-yaml","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-hub-as3-cm namespace : cis-c-hub labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_c_as3_1\": { \"class\": \"Tenant\", \"nginxdemo_as3_1\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.149\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_1\" }, \"nginxdemo_pool_as3_1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } }","title":"cis-c-hub-as3  Yaml"},{"location":"Use-Cases/cis-and-cis-c/#f5-bigip-ip","text":"","title":"F5 BIGIP-IP\u914d\u7f6e\u6548\u679c"},{"location":"Use-Cases/cis-and-cis-c/#_3","text":"","title":"\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570\u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#cis","text":"containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = 172 .16.20.205 - --bigip-partition = k8s - --verify-interval = 5 - --node-poll-interval = 5 - --pool-member-type = cluster - --default-ingress-ip = 172 .16.100.196 - --namespace = f5cis - --log-as3-response - --ingress-class = f5 - --hubmode = true - --disable-teems = true - --insecure = true - --log-level = INFO - --http-listen-address = 0 .0.0.0:9113 - --flannel-name = /k8s/flannel_vxlan","title":"CIS\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570"},{"location":"Use-Cases/cis-and-cis-c/#cis-c","text":"containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = https://172.16.20.205 - --log-level = debug - --flannel-name = flannel_vxlan - --namespace = cis-c-hub - --hub-mode = true - --ignore-service-port","title":"CIS-C\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570"},{"location":"Use-Cases/cis-and-cis-c/#hub","text":"","title":"\u975eHub\u6a21\u5f0f\u6df7\u5408\u90e8\u7f72"},{"location":"Use-Cases/cis-and-cis-c/#_4","text":"\u5728\u672c\u793a\u4f8b\u4e2d\uff0cCIS\u63a7\u5236\u5668\u76d1\u63a7 as3-2 namespace\u5185\u7684AS3\u53d1\u5e03\u8d44\u6e90\uff0c\u8ba9CIS-C\u76d1\u63a7 as3-1 \u4e0b\u7684AS3\u53d1\u5e03\u8d44\u6e90\u3002\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a","title":"\u7ed3\u6784\u900f\u89c6\u56fe"},{"location":"Use-Cases/cis-and-cis-c/#confgimap-yaml","text":"","title":"Confgimap Yaml\u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#cis-as3-2-as3-cm","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-as3-2-as3-cm namespace : as3-2 labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-dfdsf\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_as3_2\": { \"class\": \"Tenant\", \"nginxdemo_as3_2\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.145\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_2\" }, \"nginxdemo_pool_as3_2\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } }","title":"cis-as3-2-as3-cm \u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#cis-c-as3-1-as3-cm","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-as3-1-as3-cm namespace : as3-1 labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"f5cis-as3-nginxdemo-as3-1\", \"label\": \"Sample 1\", \"updateMode\": \"selective\", \"remark\": \"Simple HTTP application with RR pool\", \"f5cis_c_as3_1\": { \"class\": \"Tenant\", \"nginxdemo_as3_1\": { \"class\": \"Application\", \"template\": \"generic\", \"ingress_nginxdemo1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.100.149\" ], \"remark\":\"ingress: nginxdemo1\", \"virtualPort\": 80, \"pool\": \"nginxdemo_pool_as3_1\" }, \"nginxdemo_pool_as3_1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [ ] } ] } } } } }","title":"cis-c-as3-1-as3-cm\u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#f5-bigip-ip_1","text":"\u76f8\u5bf9\u4e8e\u4ee5\u4e0aHub\u6a21\u5f0f\u4e0b\u7684\u914d\u7f6e\uff0cConfigmap\u91cc\u5bf9\u5e94\u7684F5 partiton\uff08tenant\uff09\u5e76\u672a\u53d1\u751f\u53d8\u5316\uff0c\u5bf9\u8c61\u547d\u540d\u4e5f\u5747\u672a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u5728BIG-IP\u7684\u6700\u7ec8\u6548\u679c\u4e0e\u4e0a\u56fe\u4e00\u81f4\u3002","title":"F5 BIGIP-IP\u914d\u7f6e\u6548\u679c:"},{"location":"Use-Cases/cis-and-cis-c/#_5","text":"","title":"\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570\u793a\u4f8b"},{"location":"Use-Cases/cis-and-cis-c/#cis_1","text":"containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = 172 .16.20.205 - --bigip-partition = k8s - --verify-interval = 5 - --node-poll-interval = 5 - --pool-member-type = cluster - --default-ingress-ip = 172 .16.100.196 - --namespace = as3-2 <<< << as3-2 namespace - --hubmode=false <<<<<<\u975ehub\u6a21\u5f0f - --log-as3 -response - --ingress-class = f5 - --disable-teems = true - --insecure = true - --log-level = INFO - --http-listen-address = 0 .0.0.0:9113 - --flannel-name = /k8s/flannel_vxlan","title":"CIS\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570"},{"location":"Use-Cases/cis-and-cis-c/#cis-c_1","text":"containers: - args: - --bigip-username = $( BIGIP_USERNAME ) - --bigip-password = $( BIGIP_PASSWORD ) - --bigip-url = https://172.16.20.205 - --log-level = debug - --flannel-name = flannel_vxlan - --namespace = as3-1 <<< << as3-1 na mespace - --hub-mode = false <<< << \u975ehub\u6a21\u5f0f - --ignore-service-port","title":"CIS-C\u63a7\u5236\u5668\u542f\u52a8\u53c2\u6570"},{"location":"Use-Cases/ftp/","text":"1.FTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 FTP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684FTP profile\uff1aservice_name_ftpprofile . \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 apiVersion: v1 kind: ConfigMap metadata: name: f5-ftp-test namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"veconfig-nsgroup1\", \"ftptest\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_service_ftp\": { \"class\": \"Service_TCP\", \"virtualAddresses\": [ \"10.42.20.118\" ], \"virtualPort\": 21, \"profileFTP\": { \"use\": \"service_name_ftpprofile\" }, \"snat\": \"self\", \"pool\": \"service_name_ftp_pool\" }, \"service_name_ftp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"service_name_ftpprofile\": { \"class\": \"FTP_Profile\", \"remark\": \"description\", \"port\": 300, \"ftpsMode\": \"allow\", \"enforceTlsSessionReuseEnabled\": true, \"activeModeEnabled\": false, \"securityEnabled\": true, \"translateExtendedEnabled\": false, \"inheritParentProfileEnabled\": true } } } } }","title":"FTP\u4e1a\u52a1\u53d1\u5e03"},{"location":"Use-Cases/ftp/#1ftp","text":"","title":"1.FTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/ftp/#_1","text":"FTP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684FTP profile\uff1aservice_name_ftpprofile . \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/ftp/#yaml","text":"apiVersion: v1 kind: ConfigMap metadata: name: f5-ftp-test namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"veconfig-nsgroup1\", \"ftptest\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_service_ftp\": { \"class\": \"Service_TCP\", \"virtualAddresses\": [ \"10.42.20.118\" ], \"virtualPort\": 21, \"profileFTP\": { \"use\": \"service_name_ftpprofile\" }, \"snat\": \"self\", \"pool\": \"service_name_ftp_pool\" }, \"service_name_ftp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"service_name_ftpprofile\": { \"class\": \"FTP_Profile\", \"remark\": \"description\", \"port\": 300, \"ftpsMode\": \"allow\", \"enforceTlsSessionReuseEnabled\": true, \"activeModeEnabled\": false, \"securityEnabled\": true, \"translateExtendedEnabled\": false, \"inheritParentProfileEnabled\": true } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/","text":"1.\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03 HTTP\u4e1a\u52a1\u9ed8\u8ba4\u53c2\u6570\u8bf4\u660e\uff1a Snat\u4e3aauto\uff0c\u610f\u601d\u662fautomap persistenceMethods\u4e3acookie\uff0c\u610f\u601d\u9ed8\u8ba4\u4f1a\u8bdd\u4fdd\u6301\u662fcookie VS\u7c7b\u578b\u4e3astandard \u9ed8\u8ba4\u4f1a\u4f7f\u7528http profile \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-11 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vs1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.142.181\" ], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs1 ltm virtual test005/app_svc_vs1 { creation-time 2022-08-02:16:28:32 description test005 destination 172.16.142.181:xfer ip-protocol tcp last-modified-time 2022-08-02:16:28:32 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 933 } 2.\u914d\u7f6evirtual address\u5c5e\u6027\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6evirtual address\u5bf9\u8c61, arp enable no\uff0c virtual server \u5f15\u7528\u8be5\u5bf9\u8c61 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-2 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:16:43:17 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:16:43:17 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 934 } list ltm virtual-address 172.16.142.178 ltm virtual-address 172.16.142.178 { address 172.16.142.178 arp disabled inherited-traffic-group true mask 255.255.255.255 partition test005 traffic-group /Common/traffic-group-1 } 3.\u914d\u7f6eTCP profile\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eTCP profile\uff0c\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-3 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:17:04:31 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:17:04:31 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/http { } test005/customTCPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 935 } list ltm profile tcp test005/customTCPProfile | grep idle-timeout idle-timeout 600 4.\u914d\u7f6eHTTP profile\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eHTTP profile\uff0c\u5f00\u542fXFF \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-4 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"customHTTPProfile\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip4\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.188\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip4\" }], \"virtualPort\": 82, \"profileHTTP\": { \"use\": \"customHTTPProfile\" }, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs2 ltm virtual test006/app_svc_vs2 { creation-time 2022-08-02:17:57:57 description test006 destination 172.16.142.188:xfer ip-protocol tcp last-modified-time 2022-08-02:17:57:57 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } test006/customHTTPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 946 } list ltm profile http test006/customHTTPProfile | grep \"insert-xforwarded-for\" insert-xforwarded-for enabled 5.\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0ccookie\u52a0\u5bc6\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0c\u5bf9F5 insert\u7684cookie\u8fdb\u884c\u52a0\u5bc6 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"persistenceMethods\": [{ \"use\": \"cookie_encryption\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:31:30 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:31:30 mask 255.255.255.255 partition test006 persist { test006/cookie_encryption { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 939 } list ltm persistence cookie test006/cookie_encryption ltm persistence cookie test006/cookie_encryption { always-send disabled app-service none cookie-encryption required cookie-encryption-passphrase $M$t7$uQ0K+M40jOAbMER6IY+BSA== cookie-name none expiration 0 httponly enabled match-across-pools disabled match-across-services disabled match-across-virtuals disabled method insert mirror disabled override-connection-limit disabled secure enabled timeout indefinite } 6.\u914d\u7f6esnat pool\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6esnat pool\u8303\u4f8b \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"snatpool-3\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"172.16.142.21\", \"172.16.142.22\" ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"snat\": { \"use\": \"snatpool-3\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:36:04 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:36:04 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool test006/snatpool-3 type snat } translate-address enabled translate-port enabled vs-index 940 } list ltm snatpool test006/snatpool-3 ltm snatpool test006/snatpool-3 { members { 172.16.142.21 172.16.142.22 } partition test006 } 7.\u914d\u7f6eone connect\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eone connect\u8303\u4f8b \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"customOne\": { \"class\": \"Multiplex_Profile\", \"sourceMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"profileMultiplex\": { \"use\": \"customOne\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:40:20 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:40:20 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } test006/customOne { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 941 } list ltm profile one-connect test006/customOne ltm profile one-connect test006/customOne { app-service none idle-timeout-override disabled limit-type none max-age 86400 max-reuse 1000 max-size 10000 share-pools disabled source-mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff } 8.\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { connection-limit 123 creation-time 2022-08-03:09:51:12 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:51:12 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 943 } 9.\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"iRulesTest1\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"iRulesTest2\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"iRules\": [{ \"use\": \"iRulesTest1\" },{ \"use\": \"iRulesTest2\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:46:05 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:46:05 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { test006/iRulesTest1 test006/iRulesTest2 } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 942 } list ltm rule test006/iRulesTest1 ltm rule test006/iRulesTest1 { partition test006 when CLIENT_ACCEPTED { } } list ltm rule test006/iRulesTest2 ltm rule test006/iRulesTest2 { partition test006 when CLIENT_ACCEPTED { } } 10.\u914d\u7f6e\u591a\u4e2amonitor\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 pool\u4e2d\u914d\u7f6e\u591a\u4e2amonitor \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"monitorTcp1\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 10, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"monitorTcp2\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 7, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"monitorTcp1\" }, { \"use\": \"monitorTcp2\" } ], \"minimumMonitors\": \"all\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm pool test006/pool3 ltm pool test006/pool3 { min-active-members 1 monitor test006/monitorTcp1 and test006/monitorTcp2 partition test006 } 11.\u5e38\u7528irules\u8303\u4f8b \u00b6 \u6839\u636eURI\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else { \\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n \\n}\" }, \u5176\u4e2d if { [HTTP::uri] starts_with \\\"/coffee\\\" } \u8868\u793a\u65b0\u7684\u7248\u672c\u4e2d\u4ee5/coffee\u76ee\u5f55\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65b0\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a\uff0c {\\n pool k8s-cib001-svc-1-pool-8080 \\n } \u5176\u4e2d\u7684pool\u662f\u65b0\u7248\u672c\u670d\u52a1\u5668\u7684\u5730\u5740\u6c60 \u5982\u679c\u4e0d\u662f\u4ee5/coffee\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65e7\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a \u6839\u636e\u5ba2\u6237\u7aefip\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[IP::addr [IP::client_addr] equals 192.168.5.30] or [IP::addr [IP::client_addr] equals 192.168.5.0/24]} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5f53\u7ec8\u7aef\u5730\u5740\u4e3a192.168.5.30\u6216\u8005\u5c5e\u4e8e192.168.5.0/24\u7684\u7f51\u6bb5\uff0c\u8be5\u8bf7\u6c42\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u60c5\u51b5\u6d41\u91cf\u5747\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636ecookie\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::cookie exists \\\"Canary\\\"] and [HTTP::cookie value \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5982\u679c\u53ef\u4ee5\u5b58\u5728cookie\u4e3aCanary\uff0c\u800c\u4e14\u5bf9\u5e94\u8be5cookie\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u6240\u6709\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636ehttp header\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::header exists \\\"Canary\\\"] and [HTTP::header values \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2dhttp header\u4e2d\u5982\u679c\u5b58\u5728\\\"Canary\\\"\uff0c\u4e14\u5bf9\u5e94\u7684value\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u60c5\u51b5\u6d41\u91cf\u5206\u7ed9 k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636e\u6bd4\u4f8b\u8fdb\u884c\u7070\u5ea6 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[expr {[expr {0xffffffff & [crc32 [IP::client_addr]]}] % 100}] < 25} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d< 25 \u662f 25%\u7684\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 75%\u7684\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"HTTP\u4e1a\u52a1\u53d1\u5e03"},{"location":"Use-Cases/http/#1http","text":"","title":"1.\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/http/#_1","text":"\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03 HTTP\u4e1a\u52a1\u9ed8\u8ba4\u53c2\u6570\u8bf4\u660e\uff1a Snat\u4e3aauto\uff0c\u610f\u601d\u662fautomap persistenceMethods\u4e3acookie\uff0c\u610f\u601d\u9ed8\u8ba4\u4f1a\u8bdd\u4fdd\u6301\u662fcookie VS\u7c7b\u578b\u4e3astandard \u9ed8\u8ba4\u4f1a\u4f7f\u7528http profile","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-11 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vs1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.142.181\" ], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_2","text":"list ltm virtual test005/app_svc_vs1 ltm virtual test005/app_svc_vs1 { creation-time 2022-08-02:16:28:32 description test005 destination 172.16.142.181:xfer ip-protocol tcp last-modified-time 2022-08-02:16:28:32 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 933 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#2virtual-address","text":"","title":"2.\u914d\u7f6evirtual address\u5c5e\u6027\u8303\u4f8b"},{"location":"Use-Cases/http/#_3","text":"\u914d\u7f6evirtual address\u5bf9\u8c61, arp enable no\uff0c virtual server \u5f15\u7528\u8be5\u5bf9\u8c61","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_1","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-2 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_4","text":"list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:16:43:17 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:16:43:17 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 934 } list ltm virtual-address 172.16.142.178 ltm virtual-address 172.16.142.178 { address 172.16.142.178 arp disabled inherited-traffic-group true mask 255.255.255.255 partition test005 traffic-group /Common/traffic-group-1 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#3tcp-profile","text":"","title":"3.\u914d\u7f6eTCP profile\u8303\u4f8b"},{"location":"Use-Cases/http/#_5","text":"\u914d\u7f6eTCP profile\uff0c\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_2","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-3 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_6","text":"list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:17:04:31 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:17:04:31 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/http { } test005/customTCPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 935 } list ltm profile tcp test005/customTCPProfile | grep idle-timeout idle-timeout 600","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#4http-profile","text":"","title":"4.\u914d\u7f6eHTTP profile\u8303\u4f8b"},{"location":"Use-Cases/http/#_7","text":"\u914d\u7f6eHTTP profile\uff0c\u5f00\u542fXFF","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_3","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-4 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"customHTTPProfile\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip4\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.188\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip4\" }], \"virtualPort\": 82, \"profileHTTP\": { \"use\": \"customHTTPProfile\" }, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_8","text":"list ltm virtual test006/app_svc_vs2 ltm virtual test006/app_svc_vs2 { creation-time 2022-08-02:17:57:57 description test006 destination 172.16.142.188:xfer ip-protocol tcp last-modified-time 2022-08-02:17:57:57 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } test006/customHTTPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 946 } list ltm profile http test006/customHTTPProfile | grep \"insert-xforwarded-for\" insert-xforwarded-for enabled","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#5cookiecookie","text":"","title":"5.\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0ccookie\u52a0\u5bc6\u8303\u4f8b"},{"location":"Use-Cases/http/#_9","text":"\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0c\u5bf9F5 insert\u7684cookie\u8fdb\u884c\u52a0\u5bc6","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_4","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"persistenceMethods\": [{ \"use\": \"cookie_encryption\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_10","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:31:30 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:31:30 mask 255.255.255.255 partition test006 persist { test006/cookie_encryption { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 939 } list ltm persistence cookie test006/cookie_encryption ltm persistence cookie test006/cookie_encryption { always-send disabled app-service none cookie-encryption required cookie-encryption-passphrase $M$t7$uQ0K+M40jOAbMER6IY+BSA== cookie-name none expiration 0 httponly enabled match-across-pools disabled match-across-services disabled match-across-virtuals disabled method insert mirror disabled override-connection-limit disabled secure enabled timeout indefinite }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#6snat-pool","text":"","title":"6.\u914d\u7f6esnat pool\u8303\u4f8b"},{"location":"Use-Cases/http/#_11","text":"\u914d\u7f6esnat pool\u8303\u4f8b","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_5","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"snatpool-3\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"172.16.142.21\", \"172.16.142.22\" ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"snat\": { \"use\": \"snatpool-3\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_12","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:36:04 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:36:04 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool test006/snatpool-3 type snat } translate-address enabled translate-port enabled vs-index 940 } list ltm snatpool test006/snatpool-3 ltm snatpool test006/snatpool-3 { members { 172.16.142.21 172.16.142.22 } partition test006 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#7one-connect","text":"","title":"7.\u914d\u7f6eone connect\u8303\u4f8b"},{"location":"Use-Cases/http/#_13","text":"\u914d\u7f6eone connect\u8303\u4f8b","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_6","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"customOne\": { \"class\": \"Multiplex_Profile\", \"sourceMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"profileMultiplex\": { \"use\": \"customOne\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_14","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:40:20 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:40:20 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } test006/customOne { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 941 } list ltm profile one-connect test006/customOne ltm profile one-connect test006/customOne { app-service none idle-timeout-override disabled limit-type none max-age 86400 max-reuse 1000 max-size 10000 share-pools disabled source-mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#8vs-immediate-action-on-svc-down","text":"","title":"8.\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down\u8303\u4f8b"},{"location":"Use-Cases/http/#_15","text":"\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_7","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_16","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { connection-limit 123 creation-time 2022-08-03:09:51:12 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:51:12 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 943 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#9vsirules","text":"","title":"9.\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules\u8303\u4f8b"},{"location":"Use-Cases/http/#_17","text":"\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_8","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"iRulesTest1\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"iRulesTest2\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"iRules\": [{ \"use\": \"iRulesTest1\" },{ \"use\": \"iRulesTest2\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_18","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:46:05 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:46:05 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { test006/iRulesTest1 test006/iRulesTest2 } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 942 } list ltm rule test006/iRulesTest1 ltm rule test006/iRulesTest1 { partition test006 when CLIENT_ACCEPTED { } } list ltm rule test006/iRulesTest2 ltm rule test006/iRulesTest2 { partition test006 when CLIENT_ACCEPTED { } }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#10monitor","text":"","title":"10.\u914d\u7f6e\u591a\u4e2amonitor\u8303\u4f8b"},{"location":"Use-Cases/http/#_19","text":"pool\u4e2d\u914d\u7f6e\u591a\u4e2amonitor","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/http/#yaml_9","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"monitorTcp1\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 10, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"monitorTcp2\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 7, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"monitorTcp1\" }, { \"use\": \"monitorTcp2\" } ], \"minimumMonitors\": \"all\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/http/#_20","text":"list ltm pool test006/pool3 ltm pool test006/pool3 { min-active-members 1 monitor test006/monitorTcp1 and test006/monitorTcp2 partition test006 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/http/#11irules","text":"","title":"11.\u5e38\u7528irules\u8303\u4f8b"},{"location":"Use-Cases/http/#uri","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else { \\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n \\n}\" }, \u5176\u4e2d if { [HTTP::uri] starts_with \\\"/coffee\\\" } \u8868\u793a\u65b0\u7684\u7248\u672c\u4e2d\u4ee5/coffee\u76ee\u5f55\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65b0\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a\uff0c {\\n pool k8s-cib001-svc-1-pool-8080 \\n } \u5176\u4e2d\u7684pool\u662f\u65b0\u7248\u672c\u670d\u52a1\u5668\u7684\u5730\u5740\u6c60 \u5982\u679c\u4e0d\u662f\u4ee5/coffee\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65e7\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a","title":"\u6839\u636eURI\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/http/#ip","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[IP::addr [IP::client_addr] equals 192.168.5.30] or [IP::addr [IP::client_addr] equals 192.168.5.0/24]} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5f53\u7ec8\u7aef\u5730\u5740\u4e3a192.168.5.30\u6216\u8005\u5c5e\u4e8e192.168.5.0/24\u7684\u7f51\u6bb5\uff0c\u8be5\u8bf7\u6c42\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u60c5\u51b5\u6d41\u91cf\u5747\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636e\u5ba2\u6237\u7aefip\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/http/#cookie","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::cookie exists \\\"Canary\\\"] and [HTTP::cookie value \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5982\u679c\u53ef\u4ee5\u5b58\u5728cookie\u4e3aCanary\uff0c\u800c\u4e14\u5bf9\u5e94\u8be5cookie\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u6240\u6709\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636ecookie\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/http/#http-header","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::header exists \\\"Canary\\\"] and [HTTP::header values \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2dhttp header\u4e2d\u5982\u679c\u5b58\u5728\\\"Canary\\\"\uff0c\u4e14\u5bf9\u5e94\u7684value\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u60c5\u51b5\u6d41\u91cf\u5206\u7ed9 k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636ehttp header\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/http/#_21","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[expr {[expr {0xffffffff & [crc32 [IP::client_addr]]}] % 100}] < 25} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d< 25 \u662f 25%\u7684\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 75%\u7684\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636e\u6bd4\u4f8b\u8fdb\u884c\u7070\u5ea6"},{"location":"Use-Cases/https/","text":"1.\u6807\u51c6HTTPS\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u6700\u5e38\u7528\u7684HTTPS\u4e1a\u52a1\u53d1\u5e03\uff0c\u524d\u7aef\u4f7f\u7528HTTPS\uff0c\u5bfc\u5165\u5e76\u914d\u7f6e\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u5bc6\u94a5\uff0c\u540e\u7aef\u4f7f\u7528HTTP\uff0c\u5b9e\u73b0SSL Offloading\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\" }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:https ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 41 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } sys crypto cert cafe/coffeecert.crt { cert-validation-options none cert-validators { { } } certificate-key-size 2048 city HZ common-name coffee.example.com country CN email-address expiration Jul 31 07:23:41 2032 GMT fingerprint SHA256/D6:7A:CB:DA:2D:48:A1:21:27:15:39:5A:24:58:56:00:4E:53:A2:55:F8:AF:F1:DB:DF:07:AB:85:68:76:AD:AF issuer CN=coffee.example.com,OU=Test,O=F5,L=HZ,ST=ZJ,C=CN issuer-certificate organization F5 ou Test public-key-type RSA state ZJ subject-alternative-name } sys crypto key cafe/coffeecert.key { key-size 2048 key-type rsa-private security-type normal } ltm virtual cafe/https_vs-Redirect- { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:http ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { /Common/_sys_https_redirect } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 42 } \u8bf7\u6ce8\u610f\u6700\u540e\u4e00\u4e2aHTTP\u7684VS\uff0c cafe/https_vs-Redirect- \uff0c\u8fd9\u662fAS3\u81ea\u52a8\u751f\u6210\u7684\uff0c\u7528\u4e8eHTTP\u7684\u8df3\u8f6c\uff0c\u5982\u679c\u4e0d\u9700\u8981\u81ea\u52a8\u751f\u6210\u8fd9\u4e2aVS\uff0c\u8bf7\u5728AS3\u4e2d\u52a0\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a \"redirect80\": false \u5b8c\u6574\u7684YAML\u5982\u4e0b\uff1a kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } } 2.\u7aef\u5230\u7aef\u52a0\u5bc6 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 F5\u5e76\u4e0d\u505aSSL\u5378\u8f7d\uff0c\u5728SSL\u89e3\u5bc6\u540e\uff0c\u8fde\u63a5\u540e\u7aef\u771f\u5b9e\u670d\u52a1\u5668\u65f6\u518d\u91cd\u65b0\u52a0\u5bc6\u3002\u8fd9\u4e2a\u529f\u80fd\u9002\u7528\u4e8e\u5e94\u7528\u9700\u8981\u7aef\u5230\u7aef\u52a0\u5bc6\uff0c\u4f46\u53c8\u9700\u8981F5\u505a\u4e00\u4e9b\u53cd\u4ee3\u6216\u80057\u5c42\u5b89\u5168\u7684\u573a\u666f\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"End to end encryption\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.12\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"clientTLS\": \"coffeetls-server\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"coffeetls-server\" :{ \"class\": \"TLS_Client\" } } } } } \u5728F5\u7684\u914d\u7f6e\u4e2d\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u901a\u8fc7vs\u6302\u8f7dserver-ssl profile\u6765\u5b9e\u73b0\u7684\uff0c \u4f46\u8bf7\u6ce8\u610f \uff0c\u5728AS3\u58f0\u660e\u4e2d\uff0c\u5bf9\u4e8eClient\u548cServer\u7684\u5b9a\u4e49\u548cF5\u914d\u7f6e\u4e2d\u7684client-ssl\u548cserver-ssl\u662f\u76f8\u53cd\u7684\u3002 \u5728\u4e0a\u8ff0AS3\u58f0\u660e\u4e2d\uff0c \"serverTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684client-ssl profile\uff0c \"clientTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684server-ssl profile\u3002 \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:26:14 description cafe destination 192.0.2.12:https ip-protocol tcp last-modified-time 2022-08-19:16:26:14 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } cafe/coffeetls-server { context serverside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 54 } ltm profile server-ssl cafe/coffeetls-server { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once authenticate-name none c3d-cert-extension-includes { basic-constraints extended-key-usage key-usage subject-alternative-name } c3d-cert-lifespan 24 ca-file /Common/ca-bundle.crt cache-timeout 3600 cipher-group none ciphers DEFAULT expire-cert-response-control drop peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none session-ticket disabled ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled untrusted-cert-response-control drop } 3.\u8c03\u7528\u5df2\u6709\u8bc1\u4e66 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u4e0a\u9762\u7684\u8303\u4f8b\u4e2d\u6211\u4eec\u90fd\u662f\u901a\u8fc7AS3\u521b\u5efa\u8bc1\u4e66\u7684\u548c\u5bc6\u94a5\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u5f53\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u591a\u4e2a\u5e94\u7528\u5171\u7528\u4e00\u5f20\u8bc1\u4e66\uff0c\u4f8b\u5982\u6cdb\u57df\u540d\u8bc1\u4e66\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u8bc1\u4e66\u548c\u5bc6\u94a5\u4e00\u6b21\u5373\u53ef\u3002\u4e0b\u9762\u7684\u8303\u4f8b\u6211\u4eec\u4f1a\u4f7f\u7528/Common\u5206\u533a\u4e0b\u5df2\u6709\u7684\u8bc1\u4e66\u548c\u5bc6\u94a5\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Use existing cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.13\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"cafecert\" }] }, \"cafecert\": { \"class\": \"Certificate\", \"remark\": \"cafe.example.com\", \"certificate\": { \"bigip\": \"/Common/cafe.example.com\" }, \"privateKey\": { \"bigip\": \"/Common/cafe.example.com\" } } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:32:53 description cafe destination 192.0.2.13:https ip-protocol tcp last-modified-time 2022-08-19:16:32:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 55 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert /Common/cafe.example.com cert-key-chain { cafe.example { cert /Common/cafe.example.com key /Common/cafe.example.com } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/cafe.example.com ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } 4.\u6839\u636eSNI\u5339\u914d\u8bc1\u4e66 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u5728\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u4e0a\u7ed1\u5b9a\u591a\u5f20\u8bc1\u4e66\uff0cF5\u6839\u636eSNI\u6765\u81ea\u52a8\u5339\u914d\u8bc1\u4e66\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"One https vs with multiple SSL cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.14\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ],kube \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [ { \"matchToSNI\": \"coffee.example.com\", \"certificate\": \"coffeecert\" }, { \"matchToSNI\": \"tea.example.com\", \"certificate\": \"teacert\" } ] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"teacert\": { \"class\": \"Certificate\", \"remark\": \"tea.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDNjCCAh6gAwIBAgIEF6yK6DANBgkqhkiG9w0BAQsFADBdMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEYMBYGA1UEAxMPdGVhLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA4NDg0\\nMFoXDTMyMDczMTA4NDg0MFowXTELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpKMQsw\\nCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGDAWBgNVBAMT\\nD3RlYS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\\nAOxIFhA7yv1p4gzcbWR4x07f0zhKH8VfyWTRnw7QjZFUjNLbEa7bOhQt53V9oCSR\\nol/8tY22CmBSAtlmTt5FX5H6W6naU8EAZUmwHO3eXjp/a1HUk0fj4D++dJ8KEF0b\\nT2fxq4H+jYoTDE/Nr4u9TExuZfU/tcMsF3PrgIfkjydjW7peyJoxhvLt4tyk8z3a\\nkfSgs6mjlBuc5/2Y1tIStRpJ7gl+eKueDHp4ogPnx5qcg+GAM1pYiv17wKVJzcHW\\nDor0B4xVi3CQWlUlTwW1TX+pwL0JkoOOPfbNYo67G43DmG8m3WNG+FH+aIGXhyyp\\ncy4zbum4d1HZI/zp+k7qd6ECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAlfg7nBJL\\nDQWDGjczOjZjOcHrM7jbfuadmZQAgmASGRLMaHNuj8RIG+Ro+znM6QYNB7S8E4ZF\\ntjfvamSoFSB5+YoOwFZlyWyiHhW1L22HB7G2JabtBhexWURNfsjrwkROGpRBqjGz\\neuq4x/kkRYkOGhWGyXmJQmPo2FjO2g4R1zIRGEMeij0xpPuYIZsA6BOuyYiJPvi0\\nFBSsc+udZqOz9/MzcrU2mmIX0N42XudhWbiXNe6izPvBsrztJoZA8gaHn99JgZcZ\\ngKLYKl6FW4aN5mh2XGwuS+smbD37vr4J3faZg+18KN+H6g8mbF/ArPxKP9fiM9u9\\npKTWOTrCU0hJkw==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDsSBYQO8r9aeIM\\n3G1keMdO39M4Sh/FX8lk0Z8O0I2RVIzS2xGu2zoULed1faAkkaJf/LWNtgpgUgLZ\\nZk7eRV+R+lup2lPBAGVJsBzt3l46f2tR1JNH4+A/vnSfChBdG09n8auB/o2KEwxP\\nza+LvUxMbmX1P7XDLBdz64CH5I8nY1u6XsiaMYby7eLcpPM92pH0oLOpo5QbnOf9\\nmNbSErUaSe4Jfnirngx6eKID58eanIPhgDNaWIr9e8ClSc3B1g6K9AeMVYtwkFpV\\nJU8FtU1/qcC9CZKDjj32zWKOuxuNw5hvJt1jRvhR/miBl4csqXMuM27puHdR2SP8\\n6fpO6nehAgMBAAECggEAYScGw2gCgA5AXy9nX2917A2GKNf5lktbYLP8ZbgE7aPJ\\nP43KCI6lo9R4HkwoQ8EJ9dPPxtP6Ej7GYyN4/FWkBT7e38kgtPP3scPTMU9EiWMI\\n+p2gbWfaNfuWsioOLmpjTQcGkS3cftB0OIAHVTrhm2+tRpkKoJSJlCVaNQYagoPC\\nzhns8KJceDnyRikRfH0RbPPGsLLohnRYPDEs6J0yCXvUhKxsFKXq/mL0licu9KZN\\nqUwX2/TmT8iDnoC+TBkYJk055llBv16l5Hx7egYD9uNEFk76SInC2MCHpl1nlp43\\nEp5uRUsaCjS+5tpqugQPelhFQC9v7l4t4x+3xH/XPQKBgQD7riYMLVCNnSH3zRH8\\nYOwwFqGVSngTZw1hlTd06HEzUpntlHaoO3Z9pH2XWgaPF+2e2Hngm7EMNe5qjZau\\nlyOqb85UCxuAs0wLlLD/Q4sWOGmEPrkIHmKXHMZjQMjtqCkKr//zvE0W9ADo2MLm\\nawTxj45gTZxGXvuTEnMMkaflKwKBgQDwVkcXIJImgK+JXEjM1rGeypONVCnAqo7p\\nFJq2/QAraGvlNLv1QBzE6s4uqwWfzCecICQOoNrLG0dE3mHIlYgVqOK5Li9CJcsB\\n6dfEzgQyT4hotghCC/udjkAvKskXd4ShXbRSvF3p3elZDgXfAbQ5bxIL4QIOJF6f\\nd5os2LqIYwKBgQC3thDzxogMNuy6kyhTzvPYzkw4S1mG4Cw2VNNcNOecjOjrMPnE\\nJ1OAtvct6XrsLI04689bEoqT3TIg+SVKX+ya1m4HjuwOb9JMiccBLW5zU85Bx/8M\\nXBGfOFPf00RXpe3/bSUp5wNmg8m+LatmwiujoCRPS5eNDnwYiNkODaw+bQKBgG5Z\\nfvysdM5+6ZotKDP9I8LgCo2qph0TctisIDmCwvArWtb7to1t6Ye0tASTe9qaN1ml\\nHEknLC5zkO6bGNSra7deOvOBtCswBR0UzIBNg3nCMMS7R+FjdR0rcmb1wy0mMFyT\\nFLekS46U2I6ONL3nH2P7jpKrtnDd3CBmHwEWZdc3AoGBAM6ssZsvW47BGBbYNu7x\\nwEE0ehL/lesNQK9qEvBbtQ3w8ta5M9QHNu0vg05A6Pv+fLhSA+RuutAnF+bqBMpA\\nRM3JjvSRiMO51nISmVNl9Hga3vVvlUc7FDomv+KHc/RE6FqRdDRRvflErKb4sWDa\\nV4BS1wQmnyROovJMDN0A/mVi\\n-----END PRIVATE KEY-----\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:38:34 description cafe destination 192.0.2.14:https ip-protocol tcp last-modified-time 2022-08-19:16:38:34 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } cafe/cafetls-1- { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 56 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name coffee.example.com sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } ltm profile client-ssl cafe/cafetls-1- { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/teacert.crt cert-key-chain { teacert { cert cafe/teacert.crt key cafe/teacert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/teacert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name tea.example.com sni-default false sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } 5.\u53cc\u5411\u8ba4\u8bc1 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u9664\u4e86\u51fa\u793a\u670d\u52a1\u5668\u8bc1\u4e66\u5916\uff0c\u5e94\u7528\u8fd8\u9700\u8981\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u8bc1\u4e66\u8ba4\u8bc1\uff0c\u9700\u8981\u5728F5\u4e0a\u914d\u7f6eCA\u8bc1\u4e66\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"HTTPS with bidirection auth\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.15\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }], \"authenticationMode\": \"require\", \"authenticationFrequency\": \"every-time\", \"authenticationTrustCA\": \"coffeeca\" }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": { \"bigip\": \"/Common/default.crt\" }, \"privateKey\": { \"bigip\": \"/Common/default.key\" } }, \"coffeeca\": { \"class\": \"CA_Bundle\", \"bundle\": { \"bigip\": \"/Common/ca-bundle.crt\" } } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:47:53 description cafe destination 192.0.2.15:https ip-protocol tcp last-modified-time 2022-08-19:16:47:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 57 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate always c3d-drop-unknown-ocsp-status drop ca-file /Common/ca-bundle.crt cache-timeout 3600 cert /Common/default.crt cert-key-chain { default { cert /Common/default.crt key /Common/default.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/default.key ocsp-stapling disabled peer-cert-mode require renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"HTTPS\u4e1a\u52a1\u53d1\u5e03"},{"location":"Use-Cases/https/#1https","text":"","title":"1.\u6807\u51c6HTTPS\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/https/#_1","text":"\u6700\u5e38\u7528\u7684HTTPS\u4e1a\u52a1\u53d1\u5e03\uff0c\u524d\u7aef\u4f7f\u7528HTTPS\uff0c\u5bfc\u5165\u5e76\u914d\u7f6e\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u5bc6\u94a5\uff0c\u540e\u7aef\u4f7f\u7528HTTP\uff0c\u5b9e\u73b0SSL Offloading\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/https/#yaml","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\" }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/https/#_2","text":"ltm virtual cafe/https_vs { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:https ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 41 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } sys crypto cert cafe/coffeecert.crt { cert-validation-options none cert-validators { { } } certificate-key-size 2048 city HZ common-name coffee.example.com country CN email-address expiration Jul 31 07:23:41 2032 GMT fingerprint SHA256/D6:7A:CB:DA:2D:48:A1:21:27:15:39:5A:24:58:56:00:4E:53:A2:55:F8:AF:F1:DB:DF:07:AB:85:68:76:AD:AF issuer CN=coffee.example.com,OU=Test,O=F5,L=HZ,ST=ZJ,C=CN issuer-certificate organization F5 ou Test public-key-type RSA state ZJ subject-alternative-name } sys crypto key cafe/coffeecert.key { key-size 2048 key-type rsa-private security-type normal } ltm virtual cafe/https_vs-Redirect- { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:http ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { /Common/_sys_https_redirect } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 42 } \u8bf7\u6ce8\u610f\u6700\u540e\u4e00\u4e2aHTTP\u7684VS\uff0c cafe/https_vs-Redirect- \uff0c\u8fd9\u662fAS3\u81ea\u52a8\u751f\u6210\u7684\uff0c\u7528\u4e8eHTTP\u7684\u8df3\u8f6c\uff0c\u5982\u679c\u4e0d\u9700\u8981\u81ea\u52a8\u751f\u6210\u8fd9\u4e2aVS\uff0c\u8bf7\u5728AS3\u4e2d\u52a0\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a \"redirect80\": false \u5b8c\u6574\u7684YAML\u5982\u4e0b\uff1a kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/https/#2","text":"","title":"2.\u7aef\u5230\u7aef\u52a0\u5bc6"},{"location":"Use-Cases/https/#_3","text":"F5\u5e76\u4e0d\u505aSSL\u5378\u8f7d\uff0c\u5728SSL\u89e3\u5bc6\u540e\uff0c\u8fde\u63a5\u540e\u7aef\u771f\u5b9e\u670d\u52a1\u5668\u65f6\u518d\u91cd\u65b0\u52a0\u5bc6\u3002\u8fd9\u4e2a\u529f\u80fd\u9002\u7528\u4e8e\u5e94\u7528\u9700\u8981\u7aef\u5230\u7aef\u52a0\u5bc6\uff0c\u4f46\u53c8\u9700\u8981F5\u505a\u4e00\u4e9b\u53cd\u4ee3\u6216\u80057\u5c42\u5b89\u5168\u7684\u573a\u666f\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/https/#yaml_1","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"End to end encryption\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.12\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"clientTLS\": \"coffeetls-server\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"coffeetls-server\" :{ \"class\": \"TLS_Client\" } } } } } \u5728F5\u7684\u914d\u7f6e\u4e2d\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u901a\u8fc7vs\u6302\u8f7dserver-ssl profile\u6765\u5b9e\u73b0\u7684\uff0c \u4f46\u8bf7\u6ce8\u610f \uff0c\u5728AS3\u58f0\u660e\u4e2d\uff0c\u5bf9\u4e8eClient\u548cServer\u7684\u5b9a\u4e49\u548cF5\u914d\u7f6e\u4e2d\u7684client-ssl\u548cserver-ssl\u662f\u76f8\u53cd\u7684\u3002 \u5728\u4e0a\u8ff0AS3\u58f0\u660e\u4e2d\uff0c \"serverTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684client-ssl profile\uff0c \"clientTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684server-ssl profile\u3002","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/https/#_4","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:26:14 description cafe destination 192.0.2.12:https ip-protocol tcp last-modified-time 2022-08-19:16:26:14 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } cafe/coffeetls-server { context serverside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 54 } ltm profile server-ssl cafe/coffeetls-server { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once authenticate-name none c3d-cert-extension-includes { basic-constraints extended-key-usage key-usage subject-alternative-name } c3d-cert-lifespan 24 ca-file /Common/ca-bundle.crt cache-timeout 3600 cipher-group none ciphers DEFAULT expire-cert-response-control drop peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none session-ticket disabled ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled untrusted-cert-response-control drop }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/https/#3","text":"","title":"3.\u8c03\u7528\u5df2\u6709\u8bc1\u4e66"},{"location":"Use-Cases/https/#_5","text":"\u4e0a\u9762\u7684\u8303\u4f8b\u4e2d\u6211\u4eec\u90fd\u662f\u901a\u8fc7AS3\u521b\u5efa\u8bc1\u4e66\u7684\u548c\u5bc6\u94a5\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u5f53\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u591a\u4e2a\u5e94\u7528\u5171\u7528\u4e00\u5f20\u8bc1\u4e66\uff0c\u4f8b\u5982\u6cdb\u57df\u540d\u8bc1\u4e66\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u8bc1\u4e66\u548c\u5bc6\u94a5\u4e00\u6b21\u5373\u53ef\u3002\u4e0b\u9762\u7684\u8303\u4f8b\u6211\u4eec\u4f1a\u4f7f\u7528/Common\u5206\u533a\u4e0b\u5df2\u6709\u7684\u8bc1\u4e66\u548c\u5bc6\u94a5\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/https/#yaml_2","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Use existing cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.13\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"cafecert\" }] }, \"cafecert\": { \"class\": \"Certificate\", \"remark\": \"cafe.example.com\", \"certificate\": { \"bigip\": \"/Common/cafe.example.com\" }, \"privateKey\": { \"bigip\": \"/Common/cafe.example.com\" } } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/https/#_6","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:32:53 description cafe destination 192.0.2.13:https ip-protocol tcp last-modified-time 2022-08-19:16:32:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 55 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert /Common/cafe.example.com cert-key-chain { cafe.example { cert /Common/cafe.example.com key /Common/cafe.example.com } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/cafe.example.com ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/https/#4sni","text":"","title":"4.\u6839\u636eSNI\u5339\u914d\u8bc1\u4e66"},{"location":"Use-Cases/https/#_7","text":"\u5728\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u4e0a\u7ed1\u5b9a\u591a\u5f20\u8bc1\u4e66\uff0cF5\u6839\u636eSNI\u6765\u81ea\u52a8\u5339\u914d\u8bc1\u4e66\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/https/#yaml_3","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"One https vs with multiple SSL cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.14\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ],kube \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [ { \"matchToSNI\": \"coffee.example.com\", \"certificate\": \"coffeecert\" }, { \"matchToSNI\": \"tea.example.com\", \"certificate\": \"teacert\" } ] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"teacert\": { \"class\": \"Certificate\", \"remark\": \"tea.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDNjCCAh6gAwIBAgIEF6yK6DANBgkqhkiG9w0BAQsFADBdMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEYMBYGA1UEAxMPdGVhLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA4NDg0\\nMFoXDTMyMDczMTA4NDg0MFowXTELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpKMQsw\\nCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGDAWBgNVBAMT\\nD3RlYS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\\nAOxIFhA7yv1p4gzcbWR4x07f0zhKH8VfyWTRnw7QjZFUjNLbEa7bOhQt53V9oCSR\\nol/8tY22CmBSAtlmTt5FX5H6W6naU8EAZUmwHO3eXjp/a1HUk0fj4D++dJ8KEF0b\\nT2fxq4H+jYoTDE/Nr4u9TExuZfU/tcMsF3PrgIfkjydjW7peyJoxhvLt4tyk8z3a\\nkfSgs6mjlBuc5/2Y1tIStRpJ7gl+eKueDHp4ogPnx5qcg+GAM1pYiv17wKVJzcHW\\nDor0B4xVi3CQWlUlTwW1TX+pwL0JkoOOPfbNYo67G43DmG8m3WNG+FH+aIGXhyyp\\ncy4zbum4d1HZI/zp+k7qd6ECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAlfg7nBJL\\nDQWDGjczOjZjOcHrM7jbfuadmZQAgmASGRLMaHNuj8RIG+Ro+znM6QYNB7S8E4ZF\\ntjfvamSoFSB5+YoOwFZlyWyiHhW1L22HB7G2JabtBhexWURNfsjrwkROGpRBqjGz\\neuq4x/kkRYkOGhWGyXmJQmPo2FjO2g4R1zIRGEMeij0xpPuYIZsA6BOuyYiJPvi0\\nFBSsc+udZqOz9/MzcrU2mmIX0N42XudhWbiXNe6izPvBsrztJoZA8gaHn99JgZcZ\\ngKLYKl6FW4aN5mh2XGwuS+smbD37vr4J3faZg+18KN+H6g8mbF/ArPxKP9fiM9u9\\npKTWOTrCU0hJkw==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDsSBYQO8r9aeIM\\n3G1keMdO39M4Sh/FX8lk0Z8O0I2RVIzS2xGu2zoULed1faAkkaJf/LWNtgpgUgLZ\\nZk7eRV+R+lup2lPBAGVJsBzt3l46f2tR1JNH4+A/vnSfChBdG09n8auB/o2KEwxP\\nza+LvUxMbmX1P7XDLBdz64CH5I8nY1u6XsiaMYby7eLcpPM92pH0oLOpo5QbnOf9\\nmNbSErUaSe4Jfnirngx6eKID58eanIPhgDNaWIr9e8ClSc3B1g6K9AeMVYtwkFpV\\nJU8FtU1/qcC9CZKDjj32zWKOuxuNw5hvJt1jRvhR/miBl4csqXMuM27puHdR2SP8\\n6fpO6nehAgMBAAECggEAYScGw2gCgA5AXy9nX2917A2GKNf5lktbYLP8ZbgE7aPJ\\nP43KCI6lo9R4HkwoQ8EJ9dPPxtP6Ej7GYyN4/FWkBT7e38kgtPP3scPTMU9EiWMI\\n+p2gbWfaNfuWsioOLmpjTQcGkS3cftB0OIAHVTrhm2+tRpkKoJSJlCVaNQYagoPC\\nzhns8KJceDnyRikRfH0RbPPGsLLohnRYPDEs6J0yCXvUhKxsFKXq/mL0licu9KZN\\nqUwX2/TmT8iDnoC+TBkYJk055llBv16l5Hx7egYD9uNEFk76SInC2MCHpl1nlp43\\nEp5uRUsaCjS+5tpqugQPelhFQC9v7l4t4x+3xH/XPQKBgQD7riYMLVCNnSH3zRH8\\nYOwwFqGVSngTZw1hlTd06HEzUpntlHaoO3Z9pH2XWgaPF+2e2Hngm7EMNe5qjZau\\nlyOqb85UCxuAs0wLlLD/Q4sWOGmEPrkIHmKXHMZjQMjtqCkKr//zvE0W9ADo2MLm\\nawTxj45gTZxGXvuTEnMMkaflKwKBgQDwVkcXIJImgK+JXEjM1rGeypONVCnAqo7p\\nFJq2/QAraGvlNLv1QBzE6s4uqwWfzCecICQOoNrLG0dE3mHIlYgVqOK5Li9CJcsB\\n6dfEzgQyT4hotghCC/udjkAvKskXd4ShXbRSvF3p3elZDgXfAbQ5bxIL4QIOJF6f\\nd5os2LqIYwKBgQC3thDzxogMNuy6kyhTzvPYzkw4S1mG4Cw2VNNcNOecjOjrMPnE\\nJ1OAtvct6XrsLI04689bEoqT3TIg+SVKX+ya1m4HjuwOb9JMiccBLW5zU85Bx/8M\\nXBGfOFPf00RXpe3/bSUp5wNmg8m+LatmwiujoCRPS5eNDnwYiNkODaw+bQKBgG5Z\\nfvysdM5+6ZotKDP9I8LgCo2qph0TctisIDmCwvArWtb7to1t6Ye0tASTe9qaN1ml\\nHEknLC5zkO6bGNSra7deOvOBtCswBR0UzIBNg3nCMMS7R+FjdR0rcmb1wy0mMFyT\\nFLekS46U2I6ONL3nH2P7jpKrtnDd3CBmHwEWZdc3AoGBAM6ssZsvW47BGBbYNu7x\\nwEE0ehL/lesNQK9qEvBbtQ3w8ta5M9QHNu0vg05A6Pv+fLhSA+RuutAnF+bqBMpA\\nRM3JjvSRiMO51nISmVNl9Hga3vVvlUc7FDomv+KHc/RE6FqRdDRRvflErKb4sWDa\\nV4BS1wQmnyROovJMDN0A/mVi\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/https/#_8","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:38:34 description cafe destination 192.0.2.14:https ip-protocol tcp last-modified-time 2022-08-19:16:38:34 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } cafe/cafetls-1- { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 56 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name coffee.example.com sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } ltm profile client-ssl cafe/cafetls-1- { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/teacert.crt cert-key-chain { teacert { cert cafe/teacert.crt key cafe/teacert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/teacert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name tea.example.com sni-default false sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/https/#5","text":"","title":"5.\u53cc\u5411\u8ba4\u8bc1"},{"location":"Use-Cases/https/#_9","text":"\u9664\u4e86\u51fa\u793a\u670d\u52a1\u5668\u8bc1\u4e66\u5916\uff0c\u5e94\u7528\u8fd8\u9700\u8981\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u8bc1\u4e66\u8ba4\u8bc1\uff0c\u9700\u8981\u5728F5\u4e0a\u914d\u7f6eCA\u8bc1\u4e66\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/https/#yaml_4","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"HTTPS with bidirection auth\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.15\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }], \"authenticationMode\": \"require\", \"authenticationFrequency\": \"every-time\", \"authenticationTrustCA\": \"coffeeca\" }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": { \"bigip\": \"/Common/default.crt\" }, \"privateKey\": { \"bigip\": \"/Common/default.key\" } }, \"coffeeca\": { \"class\": \"CA_Bundle\", \"bundle\": { \"bigip\": \"/Common/ca-bundle.crt\" } } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/https/#_10","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:47:53 description cafe destination 192.0.2.15:https ip-protocol tcp last-modified-time 2022-08-19:16:47:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 57 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate always c3d-drop-unknown-ocsp-status drop ca-file /Common/ca-bundle.crt cache-timeout 3600 cert /Common/default.crt cert-key-chain { default { cert /Common/default.crt key /Common/default.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/default.key ocsp-stapling disabled peer-cert-mode require renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/hub/","text":"\u573a\u666f\u63cf\u8ff0 \u00b6 \u4ec0\u4e48\u662f hub \u6a21\u5f0f \u00b6 hub \u6a21\u5f0f\u5373\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\uff0chub \u6a21\u5f0f\u662f\u4e00\u79cd\u5f88\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u914d\u7f6e\u7ba1\u7406\u4e0e\u670d\u52a1\u7ba1\u7406\u53ef\u4ee5\u76f8\u4e92\u72ec\u7acb\uff0c\u7531\u4e0d\u540c\u8fd0\u7ef4\u4eba\u5458\u5728\u4e0d\u540c\u7684namespace\u4e2d\u5904\u7406\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0cDevOps \u56e2\u961f\u8d1f\u8d23\u5728\u7eff\u8272\u80cc\u666f\u7684 Namspace \u4e2d\u5f00\u53d1\u90e8\u7f72\u5e94\u7528\uff0cNetOps \u56e2\u961f\u8d1f\u8d23\u5728\u7ea2\u8272\u80cc\u666f\u7684 Namspace \u4e2d\u5c06 DevOps \u5f00\u53d1\u7684\u5e94\u7528\u53d1\u5e03\u51fa\u53bb\u3002 hub \u6a21\u5f0f\u9002\u7528\u4e8e\u5bf9\u5bb9\u5668\u5e94\u7528\u53d1\u5e03\u6709\u96c6\u4e2d\u7ba1\u63a7\u8bc9\u6c42\u7684\u573a\u666f\uff0c\u96c6\u5408 Kubernetes \u7684 RBAC \u7b49\u529f\u80fd\u53ef\u4ee5\u6307\u5b9a\u6e05\u6670\u7684\u5b89\u5168\u8fb9\u754c\uff0c\u4f7f\u5f97\u5bb9\u5668\u5e94\u7528\u5f00\u53d1\u8005\u548c\u5bb9\u5668\u5e94\u7528\u7684\u53d1\u5e03\u8005\u5404\u53f8\u5176\u804c\u3002hub \u6a21\u5f0f\u9002\u5408\u5927\u4e2d\u578b\u4f01\u4e1a\u6216\u7ec4\u7ec7\uff0c\u591a\u90e8\u95e8\u53c2\u4e0e\u7684\u5bb9\u5668\u4e1a\u52a1\u5efa\u8bbe\uff0c\u5728\u8fd9\u79cd\u573a\u666f\u4e0b hub \u6a21\u5f0f\u53ef\u4f18\u5316\u4e0d\u540c\u7ec4\u7ec7\u90e8\u95e8\u534f\u4f5c\uff0c\u5e26\u6765\u73b0\u4ee3\u5316\u6d41\u7a0b\u548c\u89c4\u8303\u7684\u597d\u5904\u3002 CIS-C \u90e8\u7f72\u4e2d\u542f\u7528 hub \u6a21\u5f0f \u00b6 hub \u6a21\u5f0f\u5728 CIS-C \u7684\u90e8\u7f72\u4e2d\u901a\u8fc7 --hub-mode \u53c2\u6570\u542f\u52a8\uff0chub \u6a21\u5f0f\u9700\u8981\u901a\u8fc7 --namespace \u6216 --namespace-label \u53c2\u6570\u914d\u7f6e\u4f7f\u7528\uff0c --namespace \u6216 --namespace-label \u901a\u8fc7\u660e\u7ec6\u58f0\u660e\u6216\u6807\u7b7e\u6307\u5b9a\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\u7684 Namspace\u3002 args: [ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--log-level=info\", \"--bigip-url=https://192.168.200.204\", \"--hub-mode=true\", \"--namespace=f5-hub-1\", \"--namespace=f5-hub-2\" ] --hub-mode - \u6307\u5b9a\u662f\u5426\u5f00\u542f hub \u6a21\u5f0f\uff0c\u53c2\u6570\u503c\u4e3a true \u8868\u793a\u5f00\u542f hub \u6a21\u5f0f --namespace - hub \u6a21\u5f0f\u4e0b --namespace \u5b9a\u4e49\u4e86\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\u7684 Namspace \u7684\u540d\u79f0\u3002\u96c6\u4e2d\u7ba1\u7406namespace\u91cc\u90e8\u7f72configmap\uff0c\u8be5configmap\u5185\u53ef\u4ee5\u5f15\u7528\u4e1a\u52a1ns\u91cc\u7684\u8d44\u6e90 NOTE: hub-mode \u542f\u7528\u540e\uff0c\u8868\u793a\u53ef\u4ee5\u8de8ns\u505acm\u4e0esvc\u7684\u5173\u8054\u3002 namespace namespace-label \u7528\u4e8e\u6307\u5b9a\u63a7\u5236\u5668\u76d1\u542c\u7684\u96c6\u4e2d\u5f0f\u7ba1\u7406namespace\uff0c\u4e5f\u5c31\u662f\u8bf4 hub-mode\u4e3atrue\u65f6\u8868\u793a namespace namespace-label \u6307\u5b9a\u7684ns\u5185\u7684 configmap\u8d44\u6e90\u53ef\u88ab\u76d1\u63a7\uff0c\u800c\u4efb\u4f55\u5176\u4ed6ns\u91cc\u7684 svc ep\u8d44\u6e90\u88ab\u76d1\u63a7\u3002\u5982\u679cnamespace namespace-label\u53c2\u6570\u672a\u6307\u5b9a\uff0c\u5219hub-mode \u4e3atrue\u65f6\u6240\u6709\u8d44\u6e90\u90fd\u88ab\u76d1\u63a7\uff0c\u8d44\u6e90\u8de8ns\u53ef\u5173\u8054\u3002\u5982\u679cnamespace namespace-label\u53c2\u6570\u672a\u6307\u5b9a\uff0c\u4e14hub-mode\u4e3afalse\u65f6\uff0c\u6240\u6709\u8d44\u6e90\u90fd\u88ab\u76d1\u63a7\uff0c\u4f46\u8d44\u6e90\u8de8ns\u4e0d\u53ef\u5173\u8054\u3002 Hub \u6a21\u5f0f\u90e8\u7f72\u793a\u4f8b \u00b6 \u5e94\u7528\u90e8\u7f72: 5 \u4e2a\u5bb9\u5668\u5e94\u7528\u5206\u522b\u4f4d\u4e8e 5 \u4e2a Namespace: \u00b6 apiVersion: v1 kind: Namespace metadata: name: cistest1 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest1 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest1 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest1 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest2 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest2 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest2 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest2 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest3 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest3 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest3 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest3 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest4 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest4 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest4 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest4 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest5 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest5 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest5 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest5 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- \u5e94\u7528\u53d1\u5e03: \u4e24\u4e2a configmap \u53d1\u5e03 5 \u4e2a\u670d\u52a1 \u00b6 configmap cm-hub-1 \u4f4d\u4e8e f5-hub-1 \uff0c\u53d1\u5e03 cistest1 \u3001 cistest2 \u548c cistest5 \u4e2d\u7684\u5e94\u7528\u670d\u52a1 kind: ConfigMap apiVersion: v1 metadata: name: cm-hub-1 namespace: f5-hub-1 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.36.0\", \"id\": \"f5-hub01\", \"cistest1\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.1\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8088, \"serverAddresses\": [] } ] } } }, \"cistest2\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.2\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [] } ] } } }, \"cistest5\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.5\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [] } ] } } } } } configmap cm-hub-2 \u4f4d\u4e8e f5-hub-2 \uff0c\u53d1\u5e03 cistest3 \u548c cistest4 \u4e2d\u7684\u5e94\u7528\u670d\u52a1\uff1a kind: ConfigMap apiVersion: v1 metadata: name: cm-hub-2 namespace: f5-hub-2 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.36.0\", \"id\": \"f5-hub02\", \"cistest3\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.3\" ], \"snat\": \"self\", \"virtualPort\": 80, \"serviceDownImmediateAction\": \"reset\", \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } }, \"cistest4\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.4\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } } \u53d1\u5e03\u9a8c\u8bc1\uff1a\u5728 BIG-IP \u4e0a\u547d\u4ee4\u884c\u67e5\u770b 5 \u4e2a\u670d\u52a1\u53d1\u5e03\u60c5\u51b5 \u00b6 $ for i in {1..5}; do tmsh list ltm virtual /cistest$i/app-1/app_svc_vs one-line ; done ltm virtual /cistest1/app-1/app_svc_vs { creation-time 2022-07-24:22:21:38 description app-1 destination /cistest1/10.1.10.1:http ip-protocol tcp last-modified-time 2022-07-24:22:21:38 mask 255.255.255.255 partition cistest1 persist { cookie { default yes } } pool /cistest1/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest1/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2935 } ltm virtual /cistest2/app-1/app_svc_vs { creation-time 2022-07-24:22:21:04 description app-1 destination /cistest2/10.1.10.2:http ip-protocol tcp last-modified-time 2022-07-24:22:21:04 mask 255.255.255.255 partition cistest2 persist { cookie { default yes } } pool /cistest2/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest2/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2933 } ltm virtual /cistest3/app-1/app_svc_vs { creation-time 2022-07-24:22:22:22 description app-1 destination /cistest3/10.1.10.3:http ip-protocol tcp last-modified-time 2022-07-24:22:22:22 mask 255.255.255.255 partition cistest3 persist { cookie { default yes } } pool /cistest3/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { pool /cistest3/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2937 } ltm virtual /cistest4/app-1/app_svc_vs { creation-time 2022-07-24:22:22:04 description app-1 destination /cistest4/10.1.10.4:http ip-protocol tcp last-modified-time 2022-07-24:22:22:04 mask 255.255.255.255 partition cistest4 persist { cookie { default yes } } pool /cistest4/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest4/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2936 } ltm virtual /cistest5/app-1/app_svc_vs { creation-time 2022-07-24:22:21:20 description app-1 destination /cistest5/10.1.10.5:http ip-protocol tcp last-modified-time 2022-07-24:22:21:20 mask 255.255.255.255 partition cistest5 persist { cookie { default yes } } pool /cistest5/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest5/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2934 }","title":"Hub\u6a21\u5f0f\u53d1\u5e03"},{"location":"Use-Cases/hub/#_1","text":"","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/hub/#hub","text":"hub \u6a21\u5f0f\u5373\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\uff0chub \u6a21\u5f0f\u662f\u4e00\u79cd\u5f88\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u914d\u7f6e\u7ba1\u7406\u4e0e\u670d\u52a1\u7ba1\u7406\u53ef\u4ee5\u76f8\u4e92\u72ec\u7acb\uff0c\u7531\u4e0d\u540c\u8fd0\u7ef4\u4eba\u5458\u5728\u4e0d\u540c\u7684namespace\u4e2d\u5904\u7406\u3002 \u5982\u4e0a\u56fe\u6240\u793a\uff0cDevOps \u56e2\u961f\u8d1f\u8d23\u5728\u7eff\u8272\u80cc\u666f\u7684 Namspace \u4e2d\u5f00\u53d1\u90e8\u7f72\u5e94\u7528\uff0cNetOps \u56e2\u961f\u8d1f\u8d23\u5728\u7ea2\u8272\u80cc\u666f\u7684 Namspace \u4e2d\u5c06 DevOps \u5f00\u53d1\u7684\u5e94\u7528\u53d1\u5e03\u51fa\u53bb\u3002 hub \u6a21\u5f0f\u9002\u7528\u4e8e\u5bf9\u5bb9\u5668\u5e94\u7528\u53d1\u5e03\u6709\u96c6\u4e2d\u7ba1\u63a7\u8bc9\u6c42\u7684\u573a\u666f\uff0c\u96c6\u5408 Kubernetes \u7684 RBAC \u7b49\u529f\u80fd\u53ef\u4ee5\u6307\u5b9a\u6e05\u6670\u7684\u5b89\u5168\u8fb9\u754c\uff0c\u4f7f\u5f97\u5bb9\u5668\u5e94\u7528\u5f00\u53d1\u8005\u548c\u5bb9\u5668\u5e94\u7528\u7684\u53d1\u5e03\u8005\u5404\u53f8\u5176\u804c\u3002hub \u6a21\u5f0f\u9002\u5408\u5927\u4e2d\u578b\u4f01\u4e1a\u6216\u7ec4\u7ec7\uff0c\u591a\u90e8\u95e8\u53c2\u4e0e\u7684\u5bb9\u5668\u4e1a\u52a1\u5efa\u8bbe\uff0c\u5728\u8fd9\u79cd\u573a\u666f\u4e0b hub \u6a21\u5f0f\u53ef\u4f18\u5316\u4e0d\u540c\u7ec4\u7ec7\u90e8\u95e8\u534f\u4f5c\uff0c\u5e26\u6765\u73b0\u4ee3\u5316\u6d41\u7a0b\u548c\u89c4\u8303\u7684\u597d\u5904\u3002","title":"\u4ec0\u4e48\u662f hub \u6a21\u5f0f"},{"location":"Use-Cases/hub/#cis-c-hub","text":"hub \u6a21\u5f0f\u5728 CIS-C \u7684\u90e8\u7f72\u4e2d\u901a\u8fc7 --hub-mode \u53c2\u6570\u542f\u52a8\uff0chub \u6a21\u5f0f\u9700\u8981\u901a\u8fc7 --namespace \u6216 --namespace-label \u53c2\u6570\u914d\u7f6e\u4f7f\u7528\uff0c --namespace \u6216 --namespace-label \u901a\u8fc7\u660e\u7ec6\u58f0\u660e\u6216\u6807\u7b7e\u6307\u5b9a\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\u7684 Namspace\u3002 args: [ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--log-level=info\", \"--bigip-url=https://192.168.200.204\", \"--hub-mode=true\", \"--namespace=f5-hub-1\", \"--namespace=f5-hub-2\" ] --hub-mode - \u6307\u5b9a\u662f\u5426\u5f00\u542f hub \u6a21\u5f0f\uff0c\u53c2\u6570\u503c\u4e3a true \u8868\u793a\u5f00\u542f hub \u6a21\u5f0f --namespace - hub \u6a21\u5f0f\u4e0b --namespace \u5b9a\u4e49\u4e86\u63a7\u5236\u5e73\u9762\u96c6\u4e2d\u5f0f\u7ba1\u7406\u7684 Namspace \u7684\u540d\u79f0\u3002\u96c6\u4e2d\u7ba1\u7406namespace\u91cc\u90e8\u7f72configmap\uff0c\u8be5configmap\u5185\u53ef\u4ee5\u5f15\u7528\u4e1a\u52a1ns\u91cc\u7684\u8d44\u6e90 NOTE: hub-mode \u542f\u7528\u540e\uff0c\u8868\u793a\u53ef\u4ee5\u8de8ns\u505acm\u4e0esvc\u7684\u5173\u8054\u3002 namespace namespace-label \u7528\u4e8e\u6307\u5b9a\u63a7\u5236\u5668\u76d1\u542c\u7684\u96c6\u4e2d\u5f0f\u7ba1\u7406namespace\uff0c\u4e5f\u5c31\u662f\u8bf4 hub-mode\u4e3atrue\u65f6\u8868\u793a namespace namespace-label \u6307\u5b9a\u7684ns\u5185\u7684 configmap\u8d44\u6e90\u53ef\u88ab\u76d1\u63a7\uff0c\u800c\u4efb\u4f55\u5176\u4ed6ns\u91cc\u7684 svc ep\u8d44\u6e90\u88ab\u76d1\u63a7\u3002\u5982\u679cnamespace namespace-label\u53c2\u6570\u672a\u6307\u5b9a\uff0c\u5219hub-mode \u4e3atrue\u65f6\u6240\u6709\u8d44\u6e90\u90fd\u88ab\u76d1\u63a7\uff0c\u8d44\u6e90\u8de8ns\u53ef\u5173\u8054\u3002\u5982\u679cnamespace namespace-label\u53c2\u6570\u672a\u6307\u5b9a\uff0c\u4e14hub-mode\u4e3afalse\u65f6\uff0c\u6240\u6709\u8d44\u6e90\u90fd\u88ab\u76d1\u63a7\uff0c\u4f46\u8d44\u6e90\u8de8ns\u4e0d\u53ef\u5173\u8054\u3002","title":"CIS-C \u90e8\u7f72\u4e2d\u542f\u7528 hub \u6a21\u5f0f"},{"location":"Use-Cases/hub/#hub_1","text":"","title":"Hub \u6a21\u5f0f\u90e8\u7f72\u793a\u4f8b"},{"location":"Use-Cases/hub/#5-5-namespace","text":"apiVersion: v1 kind: Namespace metadata: name: cistest1 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest1 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest1 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest1 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest2 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest2 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest2 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest2 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest3 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest3 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest3 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest3 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest4 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest4 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest4 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest4 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: Namespace metadata: name: cistest5 labels: cis_scanner: cistest --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: app-1 name: app-1 namespace: cistest5 spec: replicas: 1 selector: matchLabels: app: app-1 template: metadata: labels: app: app-1 spec: containers: - image: cloudadc/cafe:1.0 name: backend ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: labels: app: app-1 cis.f5.com/as3-tenant: cistest5 cis.f5.com/as3-app: app-1 cis.f5.com/as3-pool: app-1_app_svc_pool name: app-svc-1 namespace: cistest5 spec: ports: - port: 80 protocol: TCP targetPort: 8080 selector: app: app-1 sessionAffinity: None type: ClusterIP ---","title":"\u5e94\u7528\u90e8\u7f72: 5 \u4e2a\u5bb9\u5668\u5e94\u7528\u5206\u522b\u4f4d\u4e8e 5 \u4e2a Namespace:"},{"location":"Use-Cases/hub/#configmap-5","text":"configmap cm-hub-1 \u4f4d\u4e8e f5-hub-1 \uff0c\u53d1\u5e03 cistest1 \u3001 cistest2 \u548c cistest5 \u4e2d\u7684\u5e94\u7528\u670d\u52a1 kind: ConfigMap apiVersion: v1 metadata: name: cm-hub-1 namespace: f5-hub-1 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.36.0\", \"id\": \"f5-hub01\", \"cistest1\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.1\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8088, \"serverAddresses\": [] } ] } } }, \"cistest2\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.2\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [] } ] } } }, \"cistest5\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.5\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [] } ] } } } } } configmap cm-hub-2 \u4f4d\u4e8e f5-hub-2 \uff0c\u53d1\u5e03 cistest3 \u548c cistest4 \u4e2d\u7684\u5e94\u7528\u670d\u52a1\uff1a kind: ConfigMap apiVersion: v1 metadata: name: cm-hub-2 namespace: f5-hub-2 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.36.0\", \"id\": \"f5-hub02\", \"cistest3\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.3\" ], \"snat\": \"self\", \"virtualPort\": 80, \"serviceDownImmediateAction\": \"reset\", \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } }, \"cistest4\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_HTTP\", \"persistenceMethods\": [ \"cookie\" ], \"virtualAddresses\": [ \"10.1.10.4\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app-1_app_svc_pool\" }, \"app-1_app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } }","title":"\u5e94\u7528\u53d1\u5e03: \u4e24\u4e2a configmap \u53d1\u5e03 5 \u4e2a\u670d\u52a1"},{"location":"Use-Cases/hub/#big-ip-5","text":"$ for i in {1..5}; do tmsh list ltm virtual /cistest$i/app-1/app_svc_vs one-line ; done ltm virtual /cistest1/app-1/app_svc_vs { creation-time 2022-07-24:22:21:38 description app-1 destination /cistest1/10.1.10.1:http ip-protocol tcp last-modified-time 2022-07-24:22:21:38 mask 255.255.255.255 partition cistest1 persist { cookie { default yes } } pool /cistest1/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest1/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2935 } ltm virtual /cistest2/app-1/app_svc_vs { creation-time 2022-07-24:22:21:04 description app-1 destination /cistest2/10.1.10.2:http ip-protocol tcp last-modified-time 2022-07-24:22:21:04 mask 255.255.255.255 partition cistest2 persist { cookie { default yes } } pool /cistest2/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest2/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2933 } ltm virtual /cistest3/app-1/app_svc_vs { creation-time 2022-07-24:22:22:22 description app-1 destination /cistest3/10.1.10.3:http ip-protocol tcp last-modified-time 2022-07-24:22:22:22 mask 255.255.255.255 partition cistest3 persist { cookie { default yes } } pool /cistest3/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { pool /cistest3/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2937 } ltm virtual /cistest4/app-1/app_svc_vs { creation-time 2022-07-24:22:22:04 description app-1 destination /cistest4/10.1.10.4:http ip-protocol tcp last-modified-time 2022-07-24:22:22:04 mask 255.255.255.255 partition cistest4 persist { cookie { default yes } } pool /cistest4/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest4/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2936 } ltm virtual /cistest5/app-1/app_svc_vs { creation-time 2022-07-24:22:21:20 description app-1 destination /cistest5/10.1.10.5:http ip-protocol tcp last-modified-time 2022-07-24:22:21:20 mask 255.255.255.255 partition cistest5 persist { cookie { default yes } } pool /cistest5/app-1/app-1_app_svc_pool profiles { f5-tcp-progressive { } http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool /cistest5/app-1/app_svc_vs-self type snat } translate-address enabled translate-port enabled vs-index 2934 }","title":"\u53d1\u5e03\u9a8c\u8bc1\uff1a\u5728 BIG-IP \u4e0a\u547d\u4ee4\u884c\u67e5\u770b 5 \u4e2a\u670d\u52a1\u53d1\u5e03\u60c5\u51b5"},{"location":"Use-Cases/ipv6/","text":"1.IPv6\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 IPv6\u4e1a\u52a1\u53d1\u5e03 \u672c\u793a\u4f8b\u4e2d\u6307\u5b9a\u4e86virtualAddresses\u4e3a\u4e00\u4e2aIPv6\u5730\u5740\uff08Configmap\u4e2d\u7684\u5176\u4f59\u90e8\u5206\u53ef\u53c2\u8003\u5bf9\u5e94\u7c7b\u578b\u7684configmap\u793a\u4f8b\uff09. \u6700\u7ec8 CIS-C \u4f1a\u5c06\u8be5IPv6\u5730\u5740\u4f5c\u4e3avirtual server \u7684\u5730\u5740\u4e0b\u53d1\u5230BIGIP\u4e0a\u3002 \u82e5configmap\u76f8\u5173\u7684pool member\u7684\u5730\u5740\u4e5f\u662fIPv6\u7c7b\u578b\uff0c\u5219CIS-C\u4e5f\u4f1a\u5c06\u5176IPv6\u5730\u5740\u4f5c\u4e3amember\u7684\u5730\u5740\u8fdb\u884c\u4e0b\u53d1\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 apiVersion: v1 kind: ConfigMap metadata: name: f5-vxlan-test-c1000 namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"veconfig-nsgroup1\", \"namespace1000\": { \"class\": \"Tenant\", \"service_name_app1000\": { \"class\": \"Application\", \"template\": \"generic\", \"service_name_vs8\": { \"class\": \"Service_TCP\", \"virtualAddresses\": [ \"2001:db8:42:1::33\" ], \"virtualPort\": 8008, \"profileFTP\": { \"use\": \"service_name_ftpprofile8\" }, \"snat\": \"self\", \"pool\": \"service_name_pool1000\" }, \"service_name_pool1000\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"service_name_ftpprofile8\": { \"class\": \"FTP_Profile\", \"remark\": \"description\", \"port\": 300, \"ftpsMode\": \"allow\", \"enforceTlsSessionReuseEnabled\": true, \"activeModeEnabled\": false, \"securityEnabled\": true, \"translateExtendedEnabled\": false, \"inheritParentProfileEnabled\": true } } } } } \u90e8\u7f72\u7ed3\u679c\u793a\u4f8b \u00b6 list ltm virtual ltm virtual service_name_vs8 { creation-time 2022-08-10:02:10:29 description service_name_app1000 destination /namespace1000/2001:db8:42:1::33.8008 ip-protocol tcp last-modified-time 2022-08-10:02:10:29 partition namespace1000 persist { /Common/source_addr { default yes } } pool service_name_pool1000 profiles { /Common/f5-tcp-progressive { } service_name_ftpprofile8 { } } source-address-translation { pool service_name_vs8_self type snat } translate-address enabled translate-port enabled vs-index 4 }","title":"IPV6\u53d1\u5e03"},{"location":"Use-Cases/ipv6/#1ipv6","text":"","title":"1.IPv6\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/ipv6/#_1","text":"IPv6\u4e1a\u52a1\u53d1\u5e03 \u672c\u793a\u4f8b\u4e2d\u6307\u5b9a\u4e86virtualAddresses\u4e3a\u4e00\u4e2aIPv6\u5730\u5740\uff08Configmap\u4e2d\u7684\u5176\u4f59\u90e8\u5206\u53ef\u53c2\u8003\u5bf9\u5e94\u7c7b\u578b\u7684configmap\u793a\u4f8b\uff09. \u6700\u7ec8 CIS-C \u4f1a\u5c06\u8be5IPv6\u5730\u5740\u4f5c\u4e3avirtual server \u7684\u5730\u5740\u4e0b\u53d1\u5230BIGIP\u4e0a\u3002 \u82e5configmap\u76f8\u5173\u7684pool member\u7684\u5730\u5740\u4e5f\u662fIPv6\u7c7b\u578b\uff0c\u5219CIS-C\u4e5f\u4f1a\u5c06\u5176IPv6\u5730\u5740\u4f5c\u4e3amember\u7684\u5730\u5740\u8fdb\u884c\u4e0b\u53d1\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/ipv6/#yaml","text":"apiVersion: v1 kind: ConfigMap metadata: name: f5-vxlan-test-c1000 namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"veconfig-nsgroup1\", \"namespace1000\": { \"class\": \"Tenant\", \"service_name_app1000\": { \"class\": \"Application\", \"template\": \"generic\", \"service_name_vs8\": { \"class\": \"Service_TCP\", \"virtualAddresses\": [ \"2001:db8:42:1::33\" ], \"virtualPort\": 8008, \"profileFTP\": { \"use\": \"service_name_ftpprofile8\" }, \"snat\": \"self\", \"pool\": \"service_name_pool1000\" }, \"service_name_pool1000\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"service_name_ftpprofile8\": { \"class\": \"FTP_Profile\", \"remark\": \"description\", \"port\": 300, \"ftpsMode\": \"allow\", \"enforceTlsSessionReuseEnabled\": true, \"activeModeEnabled\": false, \"securityEnabled\": true, \"translateExtendedEnabled\": false, \"inheritParentProfileEnabled\": true } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/ipv6/#_2","text":"list ltm virtual ltm virtual service_name_vs8 { creation-time 2022-08-10:02:10:29 description service_name_app1000 destination /namespace1000/2001:db8:42:1::33.8008 ip-protocol tcp last-modified-time 2022-08-10:02:10:29 partition namespace1000 persist { /Common/source_addr { default yes } } pool service_name_pool1000 profiles { /Common/f5-tcp-progressive { } service_name_ftpprofile8 { } } source-address-translation { pool service_name_vs8_self type snat } translate-address enabled translate-port enabled vs-index 4 }","title":"\u90e8\u7f72\u7ed3\u679c\u793a\u4f8b"},{"location":"Use-Cases/l4/","text":"1.L4\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 L4\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u6307\u5b9a\u4e86class\u4e3aService_L4\u3002\u6700\u540e\u4e0b\u53d1\u7684virtual server\u7684\u7c7b\u578b\u4e3aPerformance\uff08Layer 4\uff09\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: vs-performace-l4 namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"vs-performace-l4\", \"cistest15\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_L4\", \"layer4\": \"any\", \"virtualAddresses\": [ \"10.42.20.117\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app_svc_pool\" }, \"app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"icmp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual app-1/app_svc_vs ltm virtual app-1/app_svc_vs { creation-time 2022-08-11:01:06:10 description app-1 destination 10.42.20.117:http last-modified-time 2022-08-11:01:06:10 mask 255.255.255.255 partition cistest15 persist { /Common/source_addr { default yes } } pool app-1/app_svc_pool profiles { /Common/fastL4 { } } source 0.0.0.0/0 source-address-translation { pool app-1/app_svc_vs_self type snat } translate-address enabled translate-port enabled vs-index 14 }","title":"L4\u6a21\u5f0f\u53d1\u5e03"},{"location":"Use-Cases/l4/#1l4","text":"","title":"1.L4\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/l4/#_1","text":"L4\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u6307\u5b9a\u4e86class\u4e3aService_L4\u3002\u6700\u540e\u4e0b\u53d1\u7684virtual server\u7684\u7c7b\u578b\u4e3aPerformance\uff08Layer 4\uff09\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/l4/#yaml","text":"kind: ConfigMap apiVersion: v1 metadata: name: vs-performace-l4 namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"id\": \"vs-performace-l4\", \"cistest15\": { \"class\": \"Tenant\", \"app-1\": { \"class\": \"Application\", \"template\": \"generic\", \"app_svc_vs\": { \"class\": \"Service_L4\", \"layer4\": \"any\", \"virtualAddresses\": [ \"10.42.20.117\" ], \"snat\": \"self\", \"virtualPort\": 80, \"pool\": \"app_svc_pool\" }, \"app_svc_pool\": { \"class\": \"Pool\", \"monitors\": [ \"icmp\" ], \"loadBalancingMode\": \"least-connections-member\", \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/l4/#_2","text":"list ltm virtual app-1/app_svc_vs ltm virtual app-1/app_svc_vs { creation-time 2022-08-11:01:06:10 description app-1 destination 10.42.20.117:http last-modified-time 2022-08-11:01:06:10 mask 255.255.255.255 partition cistest15 persist { /Common/source_addr { default yes } } pool app-1/app_svc_pool profiles { /Common/fastL4 { } } source 0.0.0.0/0 source-address-translation { pool app-1/app_svc_vs_self type snat } translate-address enabled translate-port enabled vs-index 14 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/tcp/","text":"1.TCP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 TCP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684TCP profile\uff1acustomTCPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-tcp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"snat_pool_existing\", \"remark\": \"reference_snat_pool\", \"Sample_TCP_Pool\": { \"class\": \"Tenant\", \"TCP_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_TCP\", \"virtualPort\": 8181, \"virtualAddresses\": [ \"10.42.20.120\" ], \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"tcp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"tcp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.192\", \"10.42.20.193\" ] } } } } }","title":"TCP(proxy)\u4e1a\u52a1\u53d1\u5e03"},{"location":"Use-Cases/tcp/#1tcp","text":"","title":"1.TCP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/tcp/#_1","text":"TCP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684TCP profile\uff1acustomTCPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/tcp/#yaml","text":"apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-tcp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"snat_pool_existing\", \"remark\": \"reference_snat_pool\", \"Sample_TCP_Pool\": { \"class\": \"Tenant\", \"TCP_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_TCP\", \"virtualPort\": 8181, \"virtualAddresses\": [ \"10.42.20.120\" ], \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"tcp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"tcp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.192\", \"10.42.20.193\" ] } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/udp/","text":"1.UDP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 UDP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684UDP profile\uff1acustomUDPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-udp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"udp-std-vs\", \"remark\": \"reference_snat_pool\", \"Sample_SNAT_Pool\": { \"class\": \"Tenant\", \"SNAT_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_UDP\", \"virtualPort\": 53, \"virtualAddresses\": [ \"10.42.20.119\" ], \"profileUDP\": { \"use\": \"customUDPProfile\" }, \"pool\": \"udp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customUDPProfile\": { \"class\": \"UDP_Profile\", \"idleTimeout\": 10 }, \"udp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"icmp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [\"1.1.1.1\"] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.190\", \"10.42.20.191\" ] } } } } }","title":"UDP(proxy)\u4e1a\u52a1\u53d1\u5e03"},{"location":"Use-Cases/udp/#1udp","text":"","title":"1.UDP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/udp/#_1","text":"UDP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684UDP profile\uff1acustomUDPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/udp/#yaml","text":"apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-udp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"udp-std-vs\", \"remark\": \"reference_snat_pool\", \"Sample_SNAT_Pool\": { \"class\": \"Tenant\", \"SNAT_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_UDP\", \"virtualPort\": 53, \"virtualAddresses\": [ \"10.42.20.119\" ], \"profileUDP\": { \"use\": \"customUDPProfile\" }, \"pool\": \"udp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customUDPProfile\": { \"class\": \"UDP_Profile\", \"idleTimeout\": 10 }, \"udp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"icmp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [\"1.1.1.1\"] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.190\", \"10.42.20.191\" ] } } } } }","title":"\u53c2\u8003yaml"},{"location":"quick-start/","text":"\u51c6\u5907\u5de5\u4f5c \u00b6 1. BIG-IP \u8bbe\u5907 \u00b6 \u4ee5\u4e0bvxlan\u76f8\u5173\u6b65\u9aa4\u4ec5\u9488\u5bf9flannel\u6a21\u5f0f\u3002\u5982\u679c\u4e3acalico\u7b49underlay\u6a21\u5f0f\uff0c\u5219\u4e0d\u9700\u8981\u8be5\u6b65\u9aa4 \u521b\u5efaVXLAN profile create net tunnels vxlan /Common/fl-vxlan { app-service none flooding-type none port 8472 } \u521b\u5efaVXLAN Tunnel \u53caVTEP IP create net tunnels tunnel /Common/fl-tunnel { key 1 local-address 10.250.16.127 profile /Common/fl-vxlan } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645traffic \u63a5\u53e3IP\u66ff\u6362 10.250.16.127 (\u53ef\u9009) \u521b\u5efaVXLAN V6 Tunnel \u53caVTEP IP. \u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net tunnels tunnel /Common/fl-tunnel6 { key 1 local-address 2021:15:0:0:0:0:0:125 profile /Common/fl-vxlan } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645\u7684IP\u66ff\u6362 2021:15:0:0:0:0:0:125 \u521b\u5efaVXLAN Tunnel SelfIP create net self /Common/fl-vxlan-selfip { address 10.42.20.1/16 allow-service all traffic-group /Common/traffic-group-local-only vlan /Common/fl-tunnel } \u6ce8\u610f\u8fd9\u91cc\u768410.42.20.1/16\u7684\u524d\u4e24\u4f4d\u901a\u8fc7\u6307\u4ee4 kubectl get node -o yaml | grep podCIDR \u83b7\u53d6\uff0c\u7b2c3\u4f4d\u4efb\u9009\u6570\u503c\u4e0d\u4e0e\u5df2\u6709node\u91cd\u590d\u5373\u53ef\u3002 (\u53ef\u9009) \u521b\u5efaVXLAN Tunnel IPV6 SelfIP . \u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net self /Common/fl-vxlan-selfip-6 { address 2021:118:2:2::/60 allow-service all traffic-group /Common/traffic-group-local-only vlan /Common/fl-tunnel6 } \u521b\u5efa\u672c\u5730VLAN\u53caSelfIP. \u5176\u4e2d vlan-traffic-6 \u8fd9\u4e2aIPV6 \u5730\u5740\u53ef\u9009\uff0c\u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net vlan /Common/vlan-traffic { interfaces { # interfaces add { # \u4e0d\u540cTMOS\u7248\u672c\u7684\u547d\u4ee4\u53c2\u6570\u7a0d\u6709\u4e0d\u540c 1.1 { } } sflow { poll-interval-global no sampling-rate-global no } tag 4094 } create net self /Common/vlan-traffic { address 10.250.16.127/24 traffic-group /Common/traffic-group-local-only vlan /Common/vlan-traffic } create net self /Common/vlan-traffic-6 { address 2021:15::125/32 traffic-group /Common/traffic-group-local-only vlan /Common/vlan-traffic } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645 traffic \u63a5\u53e3IP\u5206\u522b\u66ff\u6362 V4 \u548c V6 \u5730\u5740\u3002 2. Kubernetes \u00b6 \u521b\u5efaserviceaccount kubectl create serviceaccount k8s-bigip-ctlr -n kube-system \u6216\u8005\u4f7f\u7528\u4ee5\u4e0byaml\u521b\u5efa\uff1a apiVersion: v1 kind: ServiceAccount metadata: name: k8s-bigip-ctlr namespace: kube-system \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165service-account.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f service-account.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efaBIG-IP\u767b\u9646\u5bc6\u7801 (\u89c6\u9700\u8981\u4fee\u6539\u7528\u6237\u540d,\u5bc6\u7801\u4ee5\u53caURL\u7b49) kubectl create secret generic bigip-login -n kube-system --from-literal=username=admin --from-literal=password=mypassword --from-literal=url=https://10.10.10.10:443 \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645url\u53ca\u5bc6\u7801\u66ff\u6362\u793a\u4f8b\u4e2d\u7684https://10.10.10.10:443\u53camypassword \u6216\u8005\u4f7f\u7528\u4ee5\u4e0byaml\u521b\u5efa\uff1a --- apiVersion: v1 kind: Secret metadata: name: bigip-login namespace: kube-system data: url: aHR0cHM6Ly8xMC4xMC4xMC4xMDo0NDM= # base64 encoded 'https://10.10.10.10:443' username: YWRtaW4= # base64 encoded 'admin' password: bXlwYXNzd29yZA== # base64 encoded 'mypassword' type: Opaque base64 \u7f16\u7801\u6307\u4ee4\u4e3a echo -n xxxxx | base64 \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165secret.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f secret.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efa Cluster Role \u548c Cluster Role Binding \u53c2\u8003\u4ee5\u4e0byaml\u4f8b\u5b50\u521b\u5efa\u3002\u53ef\u6839\u636e\u5b9e\u9645\u9700\u8981\u4fee\u6539rbac\u6743\u9650\u8303\u56f4\u3002 kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole rules: - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"nodes\", \"services\", \"endpoints\", \"namespaces\", \"ingresses\", \"pods\", \"ingressclasses\"] verbs: [\"get\", \"list\", \"watch\"] - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"configmaps\", \"events\", \"ingresses/status\", \"services/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"\", \"extensions\"] resources: [\"secrets\"] verbs: [\"get\", \"list\", \"watch\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole-binding namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: bigip-ctlr-clusterrole subjects: - apiGroup: \"\" kind: ServiceAccount name: k8s-bigip-ctlr namespace: kube-system \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165rbac.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f rbac.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efaBIG-IP\u865a\u62df\u8282\u70b9(\u4ec5\u5728flannel\u6a21\u5f0f\u4e0b\u9700\u8981\u672c\u6b65\u9aa4) \u521b\u5efabigip1 \u865a\u62df\u8282\u70b9\uff0c\u6253\u901aBIG-IP\u8282\u70b9\u5230k8s\u7684vxlan\u7f51\u7edc\u3002 \u4f7f\u7528\u4ee5\u4e0byaml\u914d\u7f6e\u6587\u4ef6bigip1.yaml\uff1a apiVersion: v1 kind: Node metadata: name: bigip1 annotations: # Replace IP with Self-IP for your deployment flannel.alpha.coreos.com/public-ip: \"10.250.18.105\" # uncomment the following line if using v6 tunnel and modify bigip v6 address # flannel.alpha.coreos.com/public-ipv6: \"2021:15::125\" # Replace MAC with your BIGIP Flannel VXLAN Tunnel MAC flannel.alpha.coreos.com/backend-data: '{\"VtepMAC\":\"fa:16:3e:d5:28:07\"}' # uncomment the following line if using v6 tunnel and modify mac accordingly # flannel.alpha.coreos.com/backend-v6-data: '{\"VtepMAC\":\"fa:16:3e:d5:28:07\"}' flannel.alpha.coreos.com/backend-type: \"vxlan\" flannel.alpha.coreos.com/kube-subnet-manager: \"true\" spec: # Replace Subnet with your BIGIP Flannel Subnet podCIDR: \"10.42.20.0/24\" # uncomment the following 3 lines if using v6 tunnel and modify CIDRs using real data #podCIDRs: #- \"10.42.20.0/24\" #- \"2021:118:2:2::/64\" \u5176\u4e2d mac \u5730\u5740\u53ef\u4ee5\u5728BIG-IP\u4e0a\u4f7f\u7528tmsh\u547d\u4ee4\u83b7\u53d6\uff1a show net tunnels tunnel fl-tunnel all-properties show net tunnels tunnel fl-tunnel6 all-properties \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165bigip1.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f bigip1.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 3. Prometheus \u76d1\u63a7\uff08\u53ef\u9009\uff09 \u00b6 F5 CIS-C \u7a0b\u5e8f\u5f00\u542f\u4e868080\u7aef\u53e3\u7528\u4e8ePrometheus\u6536\u96c6metrics # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 \u6240\u4ee5\uff0c\u5728Prometheus\u670d\u52a1\u5668\u7aef\uff0c\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u6dfb\u52a0\u914d\u7f6e\u9879\uff1a - job_name: \"f5-cis-c\" static_configs: - targets: [\"10.250.18.102:30080\"] \u5176\u4e2d 10.250.18.102 \u4e3aF5 CIS-C\u7a0b\u5e8f\u6240\u5728Node\u7684IP\u3002 4. calico \u914d\u7f6e\u53c2\u8003\uff08\u53ef\u9009\uff09\u4ec5\u5f53calico\u6a21\u5f0f\u65f6\u9700\u8981\u3002 \u00b6 \u6ce8\u610f\uff1a \u68c0\u67e5\u76f8\u5e94\u7684self IP \u5730\u5740\u4e2d\uff0cPort Lockdown \u8bbe\u7f6e\u4e3a \u201cAllow All\u201d \u6216\u8005\u6dfb\u52a0\u4e0aTCP custom port \u7aef\u53e3179\u3002 BIGIP\u4e0a\u64cd\u4f5c\uff1a\u8fdb\u5165Network -> Route domain. \u8fdb\u5165 Route Domain 0\u914d\u7f6e\u9875\u9762\u4e2d\uff0c\u9009\u4e2dBGP\u5c06\u5176\u79fb\u5165\u5230enabled\u5217\u8868\u4e2d\u3002 \u7136\u540essh \u767b\u5f55\u5230BIGIP\u4e0a\uff0c\u6267\u884c\uff1a imish enable config terminal router bgp 64512 neighbor calico-k8s peer-group neighbor calico-k8s remote-as 64512 neighbor <OTHER BIG-IP IP ADDRESS> peer-group calico-k8s neighbor <each k8s NODE IP ADDRESS> peer-group calico-k8s write end K8S master\u8282\u70b9\u4e0a\u64cd\u4f5c\uff1a curl -O -L https://github.com/projectcalico/calicoctl/releases/download/v3.10.0/calicoctl chmod +x calicoctl sudo mv calicoctl /usr/local/bin sudo mkdir /etc/calico vim /etc/calico/calicoctl.cfg calicoctl.cfg \u6587\u4ef6\u5185\u5bb9\u53c2\u8003\u5982\u4e0b\u3002\u4fee\u6539\u6210\u73af\u5883\u91cc\u6b63\u786e\u7684kubeconfig \u7684\u8def\u5f84\u3002 apiVersion: projectcalico.org/v3 kind: CalicoAPIConfig metadata: spec: datastoreType: \"kubernetes\" kubeconfig: \"/root/.kube/config\" ## \u8bf7\u4fee\u6539\u4e3a\u5b9e\u9645\u8def\u5f84 \u8fd0\u884c calicoctl get nodes \u4ee5\u68c0\u67e5 calicoctl \u5b89\u88c5\u5b8c\u6210\u3002 \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPConfiguration metadata: name: default spec: logSeverityScreen: Info nodeToNodeMeshEnabled: true asNumber: 64512 EOF \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4. \u6ce8\u610f\u4fee\u6539\u6210\u771f\u5b9e\u7684BIGIP\u5730\u5740\u3002 cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-bigip1 spec: peerIP: 192.2.3.4 asNumber: 64512 EOF \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u5728 BIG-IP imish\u547d\u4ee4\u884c\u4e2d\uff0c\u901a\u8fc7 show bgp neighbors \u67e5\u770bneighbor\u72b6\u6001\uff0c\u786e\u8ba4neighbor\u72b6\u6001\u4e3a BGP state = Established ``` #show bgp neighbors BGP neighbor is 10.250.17.159, remote AS 64512, local AS 64512, internal link Member of peer-group calico-k8s for session parameters BGP version 4, remote router ID 10.250.17.159 BGP state = Established, up for 00:00:43 Last read 00:00:43, hold time is 90, keepalive interval is 30 seconds Neighbor capabilities: Route refresh: advertised and received (new) Address family IPv4 Unicast: advertised and received Received 5 messages, 0 notifications, 0 in queue Sent 4 messages, 0 notifications, 0 in queue Route refresh request: received 0, sent 0 Minimum time between advertisement runs is 5 seconds For address family: IPv4 Unicast BGP table version 3, neighbor version 3 Index 1, Offset 0, Mask 0x2 calico-k8s peer-group member AF-dependant capabilities: Graceful restart: advertised, received Community attribute sent to this neighbor (both) 1 accepted prefixes 0 announced prefixes Connections established 1; dropped 0 Graceful-restart Status: Remote restart-time is 120 sec Local host: 10.250.17.111, Local port: 55058 Foreign host: 10.250.17.159, Foreign port: 179 Nexthop: 10.250.17.111 Nexthop global: fe80::f816:3eff:feee:83d2 Nexthop local: :: BGP connection: non shared network BGP neighbor is 10.250.17.182, remote AS 64512, local AS 64512, internal link Member of peer-group calico-k8s for session parameters BGP version 4, remote router ID 10.250.17.182 BGP state = Established, up for 00:00:29 Last read 00:00:29, hold time is 90, keepalive interval is 30 seconds Neighbor capabilities: Route refresh: advertised and received (new) Address family IPv4 Unicast: advertised and received Received 5 messages, 0 notifications, 0 in queue Sent 4 messages, 0 notifications, 0 in queue Route refresh request: received 0, sent 0 Minimum time between advertisement runs is 5 seconds For address family: IPv4 Unicast BGP table version 3, neighbor version 3 Index 2, Offset 0, Mask 0x4 calico-k8s peer-group member AF-dependant capabilities: Graceful restart: advertised, received Community attribute sent to this neighbor (both) 1 accepted prefixes 0 announced prefixes Connections established 1; dropped 0 Graceful-restart Status: Remote restart-time is 120 sec Local host: 10.250.17.111, Local port: 42664 Foreign host: 10.250.17.182, Foreign port: 179 Nexthop: 10.250.17.111 Nexthop global: fe80::f816:3eff:feee:83d2 Nexthop local: :: BGP connection: non shared network ``` \u4ea6\u6216\u901a\u8fc7calicoctl calicoctl node status \u547d\u4ee4\u67e5\u770b: ``` # calicoctl node status Calico process is running. IPv4 BGP status +---------------+-------------------+-------+----------+-------------+ | PEER ADDRESS | PEER TYPE | STATE | SINCE | INFO | +---------------+-------------------+-------+----------+-------------+ | 10.250.17.182 | node-to-node mesh | up | 03:07:33 | Established | | 10.250.17.111 | global | up | 06:18:28 | Established | +---------------+-------------------+-------+----------+-------------+ ``` \u66f4\u591a\u914d\u7f6e\u8bf7\u53c2\u8003\uff1a https://f5-k8s-istio-lab.readthedocs.io/en/latest/BGP/introduction.html","title":"\u51c6\u5907\u5de5\u4f5c"},{"location":"quick-start/#_1","text":"","title":"\u51c6\u5907\u5de5\u4f5c"},{"location":"quick-start/#1-big-ip","text":"\u4ee5\u4e0bvxlan\u76f8\u5173\u6b65\u9aa4\u4ec5\u9488\u5bf9flannel\u6a21\u5f0f\u3002\u5982\u679c\u4e3acalico\u7b49underlay\u6a21\u5f0f\uff0c\u5219\u4e0d\u9700\u8981\u8be5\u6b65\u9aa4 \u521b\u5efaVXLAN profile create net tunnels vxlan /Common/fl-vxlan { app-service none flooding-type none port 8472 } \u521b\u5efaVXLAN Tunnel \u53caVTEP IP create net tunnels tunnel /Common/fl-tunnel { key 1 local-address 10.250.16.127 profile /Common/fl-vxlan } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645traffic \u63a5\u53e3IP\u66ff\u6362 10.250.16.127 (\u53ef\u9009) \u521b\u5efaVXLAN V6 Tunnel \u53caVTEP IP. \u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net tunnels tunnel /Common/fl-tunnel6 { key 1 local-address 2021:15:0:0:0:0:0:125 profile /Common/fl-vxlan } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645\u7684IP\u66ff\u6362 2021:15:0:0:0:0:0:125 \u521b\u5efaVXLAN Tunnel SelfIP create net self /Common/fl-vxlan-selfip { address 10.42.20.1/16 allow-service all traffic-group /Common/traffic-group-local-only vlan /Common/fl-tunnel } \u6ce8\u610f\u8fd9\u91cc\u768410.42.20.1/16\u7684\u524d\u4e24\u4f4d\u901a\u8fc7\u6307\u4ee4 kubectl get node -o yaml | grep podCIDR \u83b7\u53d6\uff0c\u7b2c3\u4f4d\u4efb\u9009\u6570\u503c\u4e0d\u4e0e\u5df2\u6709node\u91cd\u590d\u5373\u53ef\u3002 (\u53ef\u9009) \u521b\u5efaVXLAN Tunnel IPV6 SelfIP . \u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net self /Common/fl-vxlan-selfip-6 { address 2021:118:2:2::/60 allow-service all traffic-group /Common/traffic-group-local-only vlan /Common/fl-tunnel6 } \u521b\u5efa\u672c\u5730VLAN\u53caSelfIP. \u5176\u4e2d vlan-traffic-6 \u8fd9\u4e2aIPV6 \u5730\u5740\u53ef\u9009\uff0c\u4ec5\u5f53\u4f7f\u7528 IPV6 tunnel \u573a\u666f\u65f6\u624d\u9700\u8981\u3002 create net vlan /Common/vlan-traffic { interfaces { # interfaces add { # \u4e0d\u540cTMOS\u7248\u672c\u7684\u547d\u4ee4\u53c2\u6570\u7a0d\u6709\u4e0d\u540c 1.1 { } } sflow { poll-interval-global no sampling-rate-global no } tag 4094 } create net self /Common/vlan-traffic { address 10.250.16.127/24 traffic-group /Common/traffic-group-local-only vlan /Common/vlan-traffic } create net self /Common/vlan-traffic-6 { address 2021:15::125/32 traffic-group /Common/traffic-group-local-only vlan /Common/vlan-traffic } \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645 traffic \u63a5\u53e3IP\u5206\u522b\u66ff\u6362 V4 \u548c V6 \u5730\u5740\u3002","title":"1. BIG-IP \u8bbe\u5907"},{"location":"quick-start/#2-kubernetes","text":"\u521b\u5efaserviceaccount kubectl create serviceaccount k8s-bigip-ctlr -n kube-system \u6216\u8005\u4f7f\u7528\u4ee5\u4e0byaml\u521b\u5efa\uff1a apiVersion: v1 kind: ServiceAccount metadata: name: k8s-bigip-ctlr namespace: kube-system \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165service-account.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f service-account.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efaBIG-IP\u767b\u9646\u5bc6\u7801 (\u89c6\u9700\u8981\u4fee\u6539\u7528\u6237\u540d,\u5bc6\u7801\u4ee5\u53caURL\u7b49) kubectl create secret generic bigip-login -n kube-system --from-literal=username=admin --from-literal=password=mypassword --from-literal=url=https://10.10.10.10:443 \u6ce8\u610f\uff1a \u4f7f\u7528BIG-IP\u5b9e\u9645url\u53ca\u5bc6\u7801\u66ff\u6362\u793a\u4f8b\u4e2d\u7684https://10.10.10.10:443\u53camypassword \u6216\u8005\u4f7f\u7528\u4ee5\u4e0byaml\u521b\u5efa\uff1a --- apiVersion: v1 kind: Secret metadata: name: bigip-login namespace: kube-system data: url: aHR0cHM6Ly8xMC4xMC4xMC4xMDo0NDM= # base64 encoded 'https://10.10.10.10:443' username: YWRtaW4= # base64 encoded 'admin' password: bXlwYXNzd29yZA== # base64 encoded 'mypassword' type: Opaque base64 \u7f16\u7801\u6307\u4ee4\u4e3a echo -n xxxxx | base64 \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165secret.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f secret.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efa Cluster Role \u548c Cluster Role Binding \u53c2\u8003\u4ee5\u4e0byaml\u4f8b\u5b50\u521b\u5efa\u3002\u53ef\u6839\u636e\u5b9e\u9645\u9700\u8981\u4fee\u6539rbac\u6743\u9650\u8303\u56f4\u3002 kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole rules: - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"nodes\", \"services\", \"endpoints\", \"namespaces\", \"ingresses\", \"pods\", \"ingressclasses\"] verbs: [\"get\", \"list\", \"watch\"] - apiGroups: [\"\", \"extensions\", \"networking.k8s.io\"] resources: [\"configmaps\", \"events\", \"ingresses/status\", \"services/status\"] verbs: [\"get\", \"list\", \"watch\", \"update\", \"create\", \"patch\"] - apiGroups: [\"\", \"extensions\"] resources: [\"secrets\"] verbs: [\"get\", \"list\", \"watch\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: bigip-ctlr-clusterrole-binding namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: bigip-ctlr-clusterrole subjects: - apiGroup: \"\" kind: ServiceAccount name: k8s-bigip-ctlr namespace: kube-system \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165rbac.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f rbac.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002 \u521b\u5efaBIG-IP\u865a\u62df\u8282\u70b9(\u4ec5\u5728flannel\u6a21\u5f0f\u4e0b\u9700\u8981\u672c\u6b65\u9aa4) \u521b\u5efabigip1 \u865a\u62df\u8282\u70b9\uff0c\u6253\u901aBIG-IP\u8282\u70b9\u5230k8s\u7684vxlan\u7f51\u7edc\u3002 \u4f7f\u7528\u4ee5\u4e0byaml\u914d\u7f6e\u6587\u4ef6bigip1.yaml\uff1a apiVersion: v1 kind: Node metadata: name: bigip1 annotations: # Replace IP with Self-IP for your deployment flannel.alpha.coreos.com/public-ip: \"10.250.18.105\" # uncomment the following line if using v6 tunnel and modify bigip v6 address # flannel.alpha.coreos.com/public-ipv6: \"2021:15::125\" # Replace MAC with your BIGIP Flannel VXLAN Tunnel MAC flannel.alpha.coreos.com/backend-data: '{\"VtepMAC\":\"fa:16:3e:d5:28:07\"}' # uncomment the following line if using v6 tunnel and modify mac accordingly # flannel.alpha.coreos.com/backend-v6-data: '{\"VtepMAC\":\"fa:16:3e:d5:28:07\"}' flannel.alpha.coreos.com/backend-type: \"vxlan\" flannel.alpha.coreos.com/kube-subnet-manager: \"true\" spec: # Replace Subnet with your BIGIP Flannel Subnet podCIDR: \"10.42.20.0/24\" # uncomment the following 3 lines if using v6 tunnel and modify CIDRs using real data #podCIDRs: #- \"10.42.20.0/24\" #- \"2021:118:2:2::/64\" \u5176\u4e2d mac \u5730\u5740\u53ef\u4ee5\u5728BIG-IP\u4e0a\u4f7f\u7528tmsh\u547d\u4ee4\u83b7\u53d6\uff1a show net tunnels tunnel fl-tunnel all-properties show net tunnels tunnel fl-tunnel6 all-properties \u5c06\u4ee5\u4e0a\u5185\u5bb9\u653e\u5165bigip1.yaml\u6587\u4ef6\u4e2d, \u4f7f\u7528 kubectl apply -f bigip1.yaml \u547d\u4ee4\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u3002","title":"2. Kubernetes"},{"location":"quick-start/#3-prometheus","text":"F5 CIS-C \u7a0b\u5e8f\u5f00\u542f\u4e868080\u7aef\u53e3\u7528\u4e8ePrometheus\u6536\u96c6metrics # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 \u6240\u4ee5\uff0c\u5728Prometheus\u670d\u52a1\u5668\u7aef\uff0c\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u6dfb\u52a0\u914d\u7f6e\u9879\uff1a - job_name: \"f5-cis-c\" static_configs: - targets: [\"10.250.18.102:30080\"] \u5176\u4e2d 10.250.18.102 \u4e3aF5 CIS-C\u7a0b\u5e8f\u6240\u5728Node\u7684IP\u3002","title":"3. Prometheus \u76d1\u63a7\uff08\u53ef\u9009\uff09"},{"location":"quick-start/#4-calico-calico","text":"\u6ce8\u610f\uff1a \u68c0\u67e5\u76f8\u5e94\u7684self IP \u5730\u5740\u4e2d\uff0cPort Lockdown \u8bbe\u7f6e\u4e3a \u201cAllow All\u201d \u6216\u8005\u6dfb\u52a0\u4e0aTCP custom port \u7aef\u53e3179\u3002 BIGIP\u4e0a\u64cd\u4f5c\uff1a\u8fdb\u5165Network -> Route domain. \u8fdb\u5165 Route Domain 0\u914d\u7f6e\u9875\u9762\u4e2d\uff0c\u9009\u4e2dBGP\u5c06\u5176\u79fb\u5165\u5230enabled\u5217\u8868\u4e2d\u3002 \u7136\u540essh \u767b\u5f55\u5230BIGIP\u4e0a\uff0c\u6267\u884c\uff1a imish enable config terminal router bgp 64512 neighbor calico-k8s peer-group neighbor calico-k8s remote-as 64512 neighbor <OTHER BIG-IP IP ADDRESS> peer-group calico-k8s neighbor <each k8s NODE IP ADDRESS> peer-group calico-k8s write end K8S master\u8282\u70b9\u4e0a\u64cd\u4f5c\uff1a curl -O -L https://github.com/projectcalico/calicoctl/releases/download/v3.10.0/calicoctl chmod +x calicoctl sudo mv calicoctl /usr/local/bin sudo mkdir /etc/calico vim /etc/calico/calicoctl.cfg calicoctl.cfg \u6587\u4ef6\u5185\u5bb9\u53c2\u8003\u5982\u4e0b\u3002\u4fee\u6539\u6210\u73af\u5883\u91cc\u6b63\u786e\u7684kubeconfig \u7684\u8def\u5f84\u3002 apiVersion: projectcalico.org/v3 kind: CalicoAPIConfig metadata: spec: datastoreType: \"kubernetes\" kubeconfig: \"/root/.kube/config\" ## \u8bf7\u4fee\u6539\u4e3a\u5b9e\u9645\u8def\u5f84 \u8fd0\u884c calicoctl get nodes \u4ee5\u68c0\u67e5 calicoctl \u5b89\u88c5\u5b8c\u6210\u3002 \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPConfiguration metadata: name: default spec: logSeverityScreen: Info nodeToNodeMeshEnabled: true asNumber: 64512 EOF \u6267\u884c\u4ee5\u4e0b\u547d\u4ee4. \u6ce8\u610f\u4fee\u6539\u6210\u771f\u5b9e\u7684BIGIP\u5730\u5740\u3002 cat << EOF | calicoctl create -f - apiVersion: projectcalico.org/v3 kind: BGPPeer metadata: name: bgppeer-bigip1 spec: peerIP: 192.2.3.4 asNumber: 64512 EOF \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u5728 BIG-IP imish\u547d\u4ee4\u884c\u4e2d\uff0c\u901a\u8fc7 show bgp neighbors \u67e5\u770bneighbor\u72b6\u6001\uff0c\u786e\u8ba4neighbor\u72b6\u6001\u4e3a BGP state = Established ``` #show bgp neighbors BGP neighbor is 10.250.17.159, remote AS 64512, local AS 64512, internal link Member of peer-group calico-k8s for session parameters BGP version 4, remote router ID 10.250.17.159 BGP state = Established, up for 00:00:43 Last read 00:00:43, hold time is 90, keepalive interval is 30 seconds Neighbor capabilities: Route refresh: advertised and received (new) Address family IPv4 Unicast: advertised and received Received 5 messages, 0 notifications, 0 in queue Sent 4 messages, 0 notifications, 0 in queue Route refresh request: received 0, sent 0 Minimum time between advertisement runs is 5 seconds For address family: IPv4 Unicast BGP table version 3, neighbor version 3 Index 1, Offset 0, Mask 0x2 calico-k8s peer-group member AF-dependant capabilities: Graceful restart: advertised, received Community attribute sent to this neighbor (both) 1 accepted prefixes 0 announced prefixes Connections established 1; dropped 0 Graceful-restart Status: Remote restart-time is 120 sec Local host: 10.250.17.111, Local port: 55058 Foreign host: 10.250.17.159, Foreign port: 179 Nexthop: 10.250.17.111 Nexthop global: fe80::f816:3eff:feee:83d2 Nexthop local: :: BGP connection: non shared network BGP neighbor is 10.250.17.182, remote AS 64512, local AS 64512, internal link Member of peer-group calico-k8s for session parameters BGP version 4, remote router ID 10.250.17.182 BGP state = Established, up for 00:00:29 Last read 00:00:29, hold time is 90, keepalive interval is 30 seconds Neighbor capabilities: Route refresh: advertised and received (new) Address family IPv4 Unicast: advertised and received Received 5 messages, 0 notifications, 0 in queue Sent 4 messages, 0 notifications, 0 in queue Route refresh request: received 0, sent 0 Minimum time between advertisement runs is 5 seconds For address family: IPv4 Unicast BGP table version 3, neighbor version 3 Index 2, Offset 0, Mask 0x4 calico-k8s peer-group member AF-dependant capabilities: Graceful restart: advertised, received Community attribute sent to this neighbor (both) 1 accepted prefixes 0 announced prefixes Connections established 1; dropped 0 Graceful-restart Status: Remote restart-time is 120 sec Local host: 10.250.17.111, Local port: 42664 Foreign host: 10.250.17.182, Foreign port: 179 Nexthop: 10.250.17.111 Nexthop global: fe80::f816:3eff:feee:83d2 Nexthop local: :: BGP connection: non shared network ``` \u4ea6\u6216\u901a\u8fc7calicoctl calicoctl node status \u547d\u4ee4\u67e5\u770b: ``` # calicoctl node status Calico process is running. IPv4 BGP status +---------------+-------------------+-------+----------+-------------+ | PEER ADDRESS | PEER TYPE | STATE | SINCE | INFO | +---------------+-------------------+-------+----------+-------------+ | 10.250.17.182 | node-to-node mesh | up | 03:07:33 | Established | | 10.250.17.111 | global | up | 06:18:28 | Established | +---------------+-------------------+-------+----------+-------------+ ``` \u66f4\u591a\u914d\u7f6e\u8bf7\u53c2\u8003\uff1a https://f5-k8s-istio-lab.readthedocs.io/en/latest/BGP/introduction.html","title":"4. calico \u914d\u7f6e\u53c2\u8003\uff08\u53ef\u9009\uff09\u4ec5\u5f53calico\u6a21\u5f0f\u65f6\u9700\u8981\u3002"},{"location":"quick-start/installation/","text":"\u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u00b6 1. \u65b9\u5f0f1\uff08Installation Option 1\uff09 \u00b6 \u53c2\u8003\u4e0b\u8ff0yaml\u6587\u4ef6\u3002\u6309\u9700\u6c42\u8c03\u6574image\u7248\u672c\u7b49\u53c2\u6570\u4fe1\u606f\uff08\u8be6\u60c5\u53c2\u8003 \u542f\u52a8\u53c2\u6570\u5217\u8868 \uff09. Please update the related arguments in the yaml file and then install CIS-C by: kubectl create -f my-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-c namespace: kube-system spec: replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-c-pod template: metadata: name: k8s-bigip-ctlr-c-pod labels: app: k8s-bigip-ctlr-c-pod spec: serviceAccountName: k8s-bigip-ctlr containers: - name: k8s-bigip-ctlr-c-pod image: \"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831\" imagePullPolicy: IfNotPresent env: - name: BIGIP_USERNAME valueFrom: secretKeyRef: name: bigip-login key: username - name: BIGIP_PASSWORD valueFrom: secretKeyRef: name: bigip-login key: password - name: BIGIP_URL valueFrom: secretKeyRef: name: bigip-login key: url command: [\"/f5-kic-linux\"] args: [ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--bigip-url=$(BIGIP_URL)\", \"--log-level=debug\", # if flannel-name is set, meanning trying to use flannel mode # and customer needs to create related tunnel on BIGIP first. # \"--flannel-name=fl-tunnel\", # \"--namespace=default\", # \"--namespace=namespace-1\", # \"--namespace-label=resource.zone=deployment\", \"--hub-mode\", \"--ignore-service-port\" ] - name: as3-parser image: \"f5devcentral/cis-c-as3-parser:latest\" imagePullPolicy: IfNotPresent ports: - containerPort: 8081 protocol: TCP --- # the following service is optional. # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 - name: k8s-bigip-ctlr-c-debug-dumps protocol: TCP port: 8082 targetPort: 8082 nodePort: 30082 type: NodePort 2. \u65b9\u5f0f2\uff08Installation Option 2\uff09 \u00b6 \u5728 args \u53c2\u6570\u5217\u8868\u4e2d\uff0c\u5efa\u8bae\u5e94\u4f7f\u7528 --credentials-directory \u53c2\u6570\u6765\u66ff\u4ee3\u4e0a\u8ff0\u7684 --bigip-username, --bigip-bigip-url \u548c --bigip-password\uff0c\u4ee5\u4fbf\u66f4\u5b89\u5168\u7684\u4fdd\u7ba1BIGIP\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\u7b49\u3002 Another way to pass the BIGIP credentials. You can use \"--credentials-directory\" option instead of passing --bigip-username, --bigip-bigip-url and --bigip-password in the args of the yaml file above. When you use this argument, the controller looks for these three files in the specified directory: \"username\", \"password\" and \"url\". If any of these files do not exist, the controller falls back to using the CLI arguments(--bigip-username, etc) as parameters. Each file should contain only the username, password, and url, respectively. This is the more secure and thus prefered way because it can prevent the password from being exposed via commands like 'ps -ef' in the k8s node. kubectl create secret generic bigip-credentials -n kube-system --from-literal=username=admin --from-literal=password=CHANGEME --from-literal=url=https://10.10.10.10:443 Then reference the secret above in the deployment yaml file. Please refer to \"--credentials-directory\" , \"volumeMounts\" and \"volumes\" part below and update the other arguments as well. Then run: kubectl create -f my-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-c namespace: kube-system spec: replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-c-pod template: metadata: name: k8s-bigip-ctlr-c-pod labels: app: k8s-bigip-ctlr-c-pod spec: serviceAccountName: k8s-bigip-ctlr containers: - name: k8s-bigip-ctlr-c-pod image: \"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831\" imagePullPolicy: IfNotPresent command: [\"/f5-kic-linux\"] args: [ \"--credentials-directory=/tmp/creds\", \"--log-level=debug\", # if flannel-name is set, meanning trying to use flannel mode # and customer needs to create related tunnel on BIGIP first. # \"--flannel-name=fl-tunnel\", # \"--namespace=default\", # \"--namespace=namespace-1\", # \"--namespace-label=resource.zone=deployment\", \"--hub-mode\", \"--ignore-service-port\" ] volumeMounts: - name: bigip-creds mountPath: \"/tmp/creds\" readOnly: true - name: as3-parser image: \"f5devcentral/cis-c-as3-parser:latest\" imagePullPolicy: IfNotPresent ports: - containerPort: 8081 protocol: TCP volumes: - name: bigip-creds secret: secretName: bigip-credentials --- # the following service is optional. # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 - name: k8s-bigip-ctlr-c-debug-dumps protocol: TCP port: 8082 targetPort: 8082 nodePort: 30082 type: NodePort","title":"\u4e0b\u8f7d\u4e0e\u5b89\u88c5"},{"location":"quick-start/installation/#_1","text":"","title":"\u4e0b\u8f7d\u4e0e\u5b89\u88c5"},{"location":"quick-start/installation/#1-1installation-option-1","text":"\u53c2\u8003\u4e0b\u8ff0yaml\u6587\u4ef6\u3002\u6309\u9700\u6c42\u8c03\u6574image\u7248\u672c\u7b49\u53c2\u6570\u4fe1\u606f\uff08\u8be6\u60c5\u53c2\u8003 \u542f\u52a8\u53c2\u6570\u5217\u8868 \uff09. Please update the related arguments in the yaml file and then install CIS-C by: kubectl create -f my-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-c namespace: kube-system spec: replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-c-pod template: metadata: name: k8s-bigip-ctlr-c-pod labels: app: k8s-bigip-ctlr-c-pod spec: serviceAccountName: k8s-bigip-ctlr containers: - name: k8s-bigip-ctlr-c-pod image: \"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831\" imagePullPolicy: IfNotPresent env: - name: BIGIP_USERNAME valueFrom: secretKeyRef: name: bigip-login key: username - name: BIGIP_PASSWORD valueFrom: secretKeyRef: name: bigip-login key: password - name: BIGIP_URL valueFrom: secretKeyRef: name: bigip-login key: url command: [\"/f5-kic-linux\"] args: [ \"--bigip-username=$(BIGIP_USERNAME)\", \"--bigip-password=$(BIGIP_PASSWORD)\", \"--bigip-url=$(BIGIP_URL)\", \"--log-level=debug\", # if flannel-name is set, meanning trying to use flannel mode # and customer needs to create related tunnel on BIGIP first. # \"--flannel-name=fl-tunnel\", # \"--namespace=default\", # \"--namespace=namespace-1\", # \"--namespace-label=resource.zone=deployment\", \"--hub-mode\", \"--ignore-service-port\" ] - name: as3-parser image: \"f5devcentral/cis-c-as3-parser:latest\" imagePullPolicy: IfNotPresent ports: - containerPort: 8081 protocol: TCP --- # the following service is optional. # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 - name: k8s-bigip-ctlr-c-debug-dumps protocol: TCP port: 8082 targetPort: 8082 nodePort: 30082 type: NodePort","title":"1. \u65b9\u5f0f1\uff08Installation Option 1\uff09"},{"location":"quick-start/installation/#2-2installation-option-2","text":"\u5728 args \u53c2\u6570\u5217\u8868\u4e2d\uff0c\u5efa\u8bae\u5e94\u4f7f\u7528 --credentials-directory \u53c2\u6570\u6765\u66ff\u4ee3\u4e0a\u8ff0\u7684 --bigip-username, --bigip-bigip-url \u548c --bigip-password\uff0c\u4ee5\u4fbf\u66f4\u5b89\u5168\u7684\u4fdd\u7ba1BIGIP\u7684\u7528\u6237\u540d\u3001\u5bc6\u7801\u7b49\u3002 Another way to pass the BIGIP credentials. You can use \"--credentials-directory\" option instead of passing --bigip-username, --bigip-bigip-url and --bigip-password in the args of the yaml file above. When you use this argument, the controller looks for these three files in the specified directory: \"username\", \"password\" and \"url\". If any of these files do not exist, the controller falls back to using the CLI arguments(--bigip-username, etc) as parameters. Each file should contain only the username, password, and url, respectively. This is the more secure and thus prefered way because it can prevent the password from being exposed via commands like 'ps -ef' in the k8s node. kubectl create secret generic bigip-credentials -n kube-system --from-literal=username=admin --from-literal=password=CHANGEME --from-literal=url=https://10.10.10.10:443 Then reference the secret above in the deployment yaml file. Please refer to \"--credentials-directory\" , \"volumeMounts\" and \"volumes\" part below and update the other arguments as well. Then run: kubectl create -f my-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: k8s-bigip-ctlr-c namespace: kube-system spec: replicas: 1 selector: matchLabels: app: k8s-bigip-ctlr-c-pod template: metadata: name: k8s-bigip-ctlr-c-pod labels: app: k8s-bigip-ctlr-c-pod spec: serviceAccountName: k8s-bigip-ctlr containers: - name: k8s-bigip-ctlr-c-pod image: \"f5devcentral/k8s-bigip-ctlr-c:2.9.1-20220831\" imagePullPolicy: IfNotPresent command: [\"/f5-kic-linux\"] args: [ \"--credentials-directory=/tmp/creds\", \"--log-level=debug\", # if flannel-name is set, meanning trying to use flannel mode # and customer needs to create related tunnel on BIGIP first. # \"--flannel-name=fl-tunnel\", # \"--namespace=default\", # \"--namespace=namespace-1\", # \"--namespace-label=resource.zone=deployment\", \"--hub-mode\", \"--ignore-service-port\" ] volumeMounts: - name: bigip-creds mountPath: \"/tmp/creds\" readOnly: true - name: as3-parser image: \"f5devcentral/cis-c-as3-parser:latest\" imagePullPolicy: IfNotPresent ports: - containerPort: 8081 protocol: TCP volumes: - name: bigip-creds secret: secretName: bigip-credentials --- # the following service is optional. # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 - name: k8s-bigip-ctlr-c-debug-dumps protocol: TCP port: 8082 targetPort: 8082 nodePort: 30082 type: NodePort","title":"2. \u65b9\u5f0f2\uff08Installation Option 2\uff09"},{"location":"quick-start/prometheus/","text":"Prometheus\u96c6\u6210 \u00b6 Prometheus \u662f\u65b0\u4e00\u4ee3\u7684\u4e91\u539f\u751f\u76d1\u63a7\u7cfb\u7edf\uff0c\u548cKubernetes\u6709\u7740\u5929\u7136\u7684\u517c\u5bb9\u5173\u7cfb\uff0c\u6240\u4ee5\u5728CIS-C\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u9996\u63a8\u4f7f\u7528Prometheus\uff0c\u4f5c\u4e3a\u76d1\u63a7\u624b\u6bb5\u5b9e\u73b0CIS-C\u7684\u6027\u80fd\u8bc4\u4f30\u548c\u8fd0\u884c\u72b6\u6001\u6536\u96c6\u3002 \u670d\u52a1\u5668\u7aef\u642d\u5efa \u00b6 Prometheus \u7684\u642d\u5efa\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u672c\u6587\u6863\u4e2d\u5c55\u793a\u7684\u662f\u4ee5docker\u65b9\u5f0f\u642d\u5efa\u72ec\u7acb\u7684prometheus\u670d\u52a1\u5668\u7aef\u3002 \u5177\u4f53\u642d\u5efa\u6b65\u9aa4\u5982\u4e0b\uff1a \u7f16\u5199prometheus.yaml \u6b64\u6587\u4ef6\u4e3aprometheus\u6807\u51c6\u914d\u7f6e\u6587\u4ef6\uff0c\u8be6\u7ec6\u53ef\u53c2\u8003 prometheus\u914d\u7f6e\u6587\u4ef6\u6587\u6863 \u3002 \u8fd9\u91cc\uff0c\u6211\u4eec\u4ec5\u914d\u7f6e\u4e86metrics\u6536\u96c6\uff0c\u5e76\u4e0d\u4f7f\u7528alert\u7b49\u914d\u7f6e\u9879\u3002 ``` # my global config global: scrape_interval: 5s # Set the scrape interval to every 15 seconds. Default is every 1 minute. evaluation_interval: 5s # Evaluate rules every 15 seconds. The default is every 1 minute. # scrape_timeout is set to the global default (10s). # Alertmanager configuration alerting: alertmanagers: - static_configs: - targets: # - alertmanager:9093 # Load rules once and periodically evaluate them according to the global 'evaluation_interval'. rule_files: # - \"first_rules.yml\" # - \"second_rules.yml\" # A scrape configuration containing exactly one endpoint to scrape: # Here it's Prometheus itself. scrape_configs: # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config. - job_name: \"prometheus\" # metrics_path defaults to '/metrics' # scheme defaults to 'http'. static_configs: - targets: [\"localhost:9090\"] - job_name: \"f5-kic-1-18\" static_configs: - targets: [\"10.xx.yy.zz:30080\"] ``` \u6211\u4eec\u9700\u8981\u6309\u7167`job_name`\u7684\u65b9\u5f0f\u6dfb\u52a0\u9700\u8981\u6536\u96c6metrics\u7684target\u3002 \u8fd9\u91cc\u768410.xx.yy.zz:30080\u5373\u4e3aCIS-C deployment\u66b4\u9732\u7684prometheus metrics\u76d1\u542c\u7aef\u53e3\u3002 CIS-C deployment\u66b4\u9732prometheus metrics\u76d1\u542c\u7aef\u53e3\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a ``` # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 ``` \u7f16\u5199docker-compose.yaml \u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u672c\u5730\u7684prometheus.yaml \u6587\u4ef6\u6302\u8f7d\u5165container\u4e2d\uff1bweb\u7aef\u53e39090\u3002 ``` version: \"3\" services: prometheus_on_k8s_master: image: prom/prometheus:latest volumes: - /root/prometheus/prometheus.yaml:/etc/prometheus/prometheus.yml ports: - 9090:9090 ``` \u6570\u636e\u6570\u636e\u91c7\u96c6 \u00b6 \u76ee\u524dCIS-C\u901a\u8fc7Prometheus\u6536\u96c6\u4e86\u4e1a\u52a1\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\u5404\u4e2a\u5173\u952e\u8282\u70b9\u7684\u65f6\u8017\u6570\u636e\u3002\u5404\u4e2ametrics\u540d\u79f0\u53ca\u542b\u4e49\u5982\u4e0b\uff1a bigip_icontrol_timecost_count\uff1a CIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u9001iControlRest API\u5230BIG-IP\u6570\u91cf\u7d2f\u8ba1\u7edf\u8ba1 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"method\": REST\u8bf7\u6c42\u65b9\u6cd5\uff1aGET POST DELETE PATCH \"url\": BIG-IP url\u540d\u79f0\uff0c\u4ee5\u201c/mgmt/tm/..\u201d\u4e3a\u524d\u7f00\u3002 \u4f8b\u5982\uff1a bigip_icontrol_timecost_count{method=\"GET\",url=\"/mgmt/tm/ltm/snatpool\"} 273 \u8868\u793aCIS-C\u53d1\u9001 /mgmt/tm/ltm/snatpool \u8bf7\u6c42\u7684\u6570\u91cf\u4e3a 273 \uff0c\u8fd9\u4e2a\u6570\u5b57\u4e5f\u5305\u62ec\u4e86\u5bf9\u67d0snatpool\u5bf9\u8c61\u7684\u64cd\u4f5cAPI\uff0c\u4f8b\u5982 DELETE /mgmt/tm/ltm/snatpool/~partitionA~subfolderB~snatpoolC \u3002 bigip_icontrol_timecost_total\uff1a CIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u9001iControlRest API\u5230BIG-IP\u8017\u65f6\u7d2f\u8ba1\u7edf\u8ba1 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"method\": REST\u8bf7\u6c42\u65b9\u6cd5\uff1aGET POST DELETE PATCH \"url\": BIG-IP url\u540d\u79f0\uff0c\u4ee5\u201c/mgmt/tm/..\u201d\u4e3a\u524d\u7f00\u3002 \u4e3e\u4f8b\u540c\u4e0a\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2(ms)\u3002 phase_duration_timecost_total\uff1aCIS-C\u5404\u4e2a\u534f\u7a0b\u903b\u8f91\u7684\u8017\u65f6\u603b\u8ba1\u3002 label phase \u8868\u793a\u534f\u7a0b\u540d\u79f0\uff0c\u5305\u62ec\uff1a k8sinformer ltmworker networker respacker ressyncer evreporter . monitored_resource_timecost\uff1aCIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\u5404\u7ec6\u7c92\u5ea6\u64cd\u4f5c\u8017\u65f6\u3002 \u6b64\u76d1\u63a7\u6307\u6807\u591a\u7528\u4e8e\u7814\u53d1\u8fc7\u7a0b\u4e2d\u7684\u6027\u80fd\u8c03\u4f18\u3002 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"request_id\": \u5f53\u524d\u4e0b\u53d1\u8bf7\u6c42\u7684ID\u3002\u4e0b\u53d1\u8bf7\u6c42\u5230\u6765\u540e\uff0cCIS-C\u5185\u90e8\u4f1a\u6839\u636e\u64cd\u4f5c\u4e0d\u540c\uff0c\u5c06\u8bf7\u6c42\u62c6\u89e3\u4e3a\u4e0d\u540c\u7684\u7c7b\u578b\u4ee5\u4e0d\u540c\u7684\u6b65\u9aa4\u6267\u884c\u4e0b\u53d1\uff0c\u6b64ID\u53ef\u4ee5\u5728\u540e\u7eed\u5404\u5904\u7406\u6b65\u9aa4\u4e2d\u6807\u8bc6\u8be5\u6b65\u9aa4\u6765\u81ea\u54ea\u4e2a\u8bf7\u6c42\uff0c\u4fbf\u4e8e\u7d2f\u52a0\u4e0b\u53d1\u603b\u8017\u65f6\u3002 CIS-C\u4f1a\u5bf9\u6bcf\u4e2ak8s\u4e8b\u4ef6\u5206\u914d\u72ec\u7acb\u7684request_id\u3002k8s\u4e8b\u4ef6\u5305\u62ec configmap/endpoints/service/node/namespace\u8d44\u6e90\u7684add\u3001update\u3001delete\u3002 \"kind\": \u4e1a\u52a1\u4e0b\u53d1\u540e\u5728CIS-C\u5185\u90e8\u7684\u5904\u7406\u7c7b\u578b\uff0c\u5305\u62ec \u7f51\u7edc\u5904\u7406\u7c7b\uff1aarp, fdb, k8s\u96c6\u7fa4\u8d44\u6e90\u7c7b\uff1aconfigmap, endpoint, node, service, namespace BIG-IP\u914d\u7f6e\u7c7b\uff1adata-group, pool.members, virtualpool \"name\": \u4e0b\u53d1\u4e1a\u52a1\u5bf9\u5e94\u7684k8s\u8d44\u6e90\u6216BIG-IP\u914d\u7f6e\u540d\u79f0\uff0c\u4f8b\u5982\uff1a default/rest-service-http-configmap \u4e3aconfigmap\u7684namespace \u548cname kube-system/app-svc-2 \u4e3a service\u6216\u8005endpoint \u7684namespace\u548cname app_2_svc_pool \u4e3a BIG-IP\u4e0aPool \u540d\u79f0 \"operation\": \u4e1a\u52a1\u4e0b\u53d1\u7684\u64cd\u4f5c\u8bf7\u6c42\uff0c\u5305\u62ec BIG-IP\u914d\u7f6e\u4e0b\u53d1\u65f6\u7684\u201cdeploy\u201d\u548c\u201cdelete\u201d K8s\u96c6\u7fa4\u4e8b\u4ef6\u5904\u7406\u65f6\u7684\u201cadd\u201d\uff0c\u201cupdate\u201d \u548c\u201cdelete\u201d \"stage\": \u4e1a\u52a1\u4e0b\u53d1\u9636\u6bb5\uff0c\u5305\u62ec \u201cwait\u201d\uff1a\u8868\u793ak8s\u96c6\u7fa4\u4e8b\u4ef6\u88abCIS-C\u63a5\u53d7\u5230\uff0c\u5728\u961f\u5217\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u3002 \u201cpack\u201d\uff1a\u8868\u793a\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u9884\u5904\u7406\u7684\u65f6\u95f4\uff0c\u4e0e\u5904\u7406\u8fc7\u7a0b\u662f\u5c06k8s\u4e2d\u7684\u8d44\u6e90\u8f6c\u5316\u4e3aBIG-IP\u53ef\u8bc6\u522b\u7684\u6570\u636e\u7ed3\u6784\u3002 \u201cdeploy\u201d\uff1a\u8868\u793aCIS-C\u64cd\u63a7BIG-IP\u5b9e\u73b0\u4e0b\u53d1\u6240\u7528\u7684\u65f6\u95f4\u3002 function_duration_timecost\uff1a\u51fd\u6570\u7ea7\u522b\u8017\u65f6\u7edf\u8ba1\u3002 \u5176\u4e2d label name \u4e3a\u51fd\u6570\u540d\u79f0\u3002 \u6b64metrics\u4e3b\u8981\u7528\u4f5c\u8ffd\u8e2a\u6027\u80fd\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u7684\u51fd\u6570\u65f6\u8017\u60c5\u51b5\uff0c\u8ba9\u5f00\u53d1\u8005\u5c3d\u65e9\u53d1\u73b0\u5f53\u8d44\u6e90\u6570\u91cf\u589e\u52a0\u65f6\u7684\u6027\u80fd\u74f6\u9888\u70b9\u3002 \u6027\u80fd\u6d4b\u8bd5\u6570\u636e\u53ca\u65b9\u6cd5 \u00b6 \u5c06CIS-C\u542f\u52a8\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u6027\u80fd\u6d4b\u8bd5\u4e86\uff0cCIS-C\u542f\u52a8\u65b9\u6cd5\u3001\u53c2\u6570\u8bf7\u53c2\u8003 \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u3002 \u6027\u80fd\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528ansible \u811a\u672c**\u9010\u4e2a**\u521b\u5efa\u591a\u4e2a\u8d44\u6e90\u3002 \u4ee5\u4e0b\u4ee3\u7801\u4f1a\u9010\u4e2a\u521b\u5efa100\u4e2a\u8d44\u6e90\u3002 for n in {0..100}; do ansible-playbook \\ -e src=1.standalone.complex.resources.yaml.j2 \\ -e index=$n -e count=$(($n+1)) \\ -e action=apply \\ 2.0.crud-in-batch.yaml done \u5176\u4e2d 2.0.crud-in-batch.yaml \u7528\u4e8e\u7f16\u6392kubectl\u7684\u8d44\u6e90yaml\u6587\u4ef6\u5e76\u8c03\u7528kubectl\u521b\u5efa\u8d44\u6e90\u3002 \u5b9e\u73b0\u5185\u5bb9\u5982\u4e0b\uff1a --- - hosts: localhost gather_facts: false remote_user: root vars_files: - 0.7.test-vars.json tasks: - name: generate resource yaml template: src: '{{ src }}' dest: ./tmp-resources.yaml - name: executing {{ action }} shell: | kubectl {{ action }} -f tmp-resources.yaml 1.standalone.complex.resources.yaml.j2 \u4e3ajinja2 \u6a21\u677f\u6587\u4ef6\uff1a {% for num in range(index|int, count|int, 1) %} --- apiVersion: apps/v1 kind: Deployment metadata: name: f5-vxlan-test-d{{ num }} namespace: default spec: replicas: 3 selector: matchLabels: run: f5-vxlan-test-d{{ num }} template: metadata: labels: run: f5-vxlan-test-d{{ num }} spec: containers: - image: \"nginx:latest\" imagePullPolicy: IfNotPresent name: f5-vxlan-test-d{{ num }} ports: - containerPort: 80 protocol: TCP --- apiVersion: v1 kind: Service metadata: name: f5-vxlan-test-s{{ num }} namespace: default labels: cis.f5.com/as3-tenant: Tenant-{{ num }} cis.f5.com/as3-app: my-app cis.f5.com/as3-pool: mypool1 spec: ports: - port: 80 protocol: TCP targetPort: 80 selector: run: f5-vxlan-test-d{{ num }} sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: ConfigMap metadata: labels: f5type: virtual-server as3: \"true\" name: f5-vxlan-test-c{{ num }} namespace: default data: template: | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"urn:uuid:33045210-3ab8-4636-9b2a-c98d22ab915d\", \"label\": \"http\", \"remark\": \"application {{ num }} Template\", \"Tenant-{{ num }}\": { \"class\": \"Tenant\", \"my-app\": { \"class\": \"Application\", \"template\": \"generic\", \"foo_ns_vs\": { \"class\": \"Service_HTTP\", \"remark\": \"app in Tenant-{{ num }}\", \"virtualAddresses\": [ \"10.250.{{ 100 + (num/254)|int }}.{{ 1 + num%254 }}\" ], \"profileHTTP\": { \"use\": \"http_X-Forwarded-For\" }, \"persistenceMethods\": [ { \"use\": \"cookie_encryption\" } ], \"iRules\": [ \"myirule\" ], \"pool\": \"mypool1\" }, \"myirule\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool /Tenant-{{ num }}/my-app/mypool1 \\n } else { \\n pool /Tenant-{{ num }}/my-app/mypool2 \\n } \\n}\" }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"http_X-Forwarded-For\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"mymonitor\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"interval\": 5, \"timeout\": 16 }, \"mypool1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"mypool2\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"mymonitor\" } ], \"loadBalancingMode\": \"least-connections-member\", \"minimumMembersActive\": 0, \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } } {% endfor %} \u6d4b\u8bd5\u6570\u636e\u4e0e\u7ed3\u679c\u6837\u4f8b \u00b6 \u6d4b\u8bd5\u811a\u672c\u6267\u884c\u7ed3\u675f\u540e\uff0c\u5c31\u53ef\u4ee5\u5728prometheus\u7684UI\u4e0a\u67e5\u770b\u6d4b\u8bd5\u7ed3\u679c\u4e86\uff0c\u5177\u4f53\u7684\u805a\u5408PromSQL\u4e3a\uff1a monitored_resource_timecost sum(monitored_resource_timecost{instance=\"10.xx.yy.zz:30080\"}) by (request_id) \u6b64\u805a\u5408\u6307\u4ee4\u4ee5 request_id \u5212\u5206\uff0c\u5c06\u6765\u81ea 10.xx.yy.zz:30080 \u7684metrics\u6570\u636e\u52a0\u548c\uff08 sum \uff09\uff0c\u8ba1\u7b97 \u5f97\u5230\u5404\u4e2arequest\u7684\u65f6\u95f4\u8017\u65f6\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 phase_duration_timecost_total \u6b64\u805a\u5408\u547d\u4ee4\u53ef\u4ee5\u7edf\u8ba1CIS-C\u7d2f\u8ba1\u5de5\u4f5c\u65f6\u957f\u3002 bigip_icontrol_timecost_count & bigip_icontrol_timecost_total sum(bigip_icontrol_timecost_count) by(url) sum(bigip_icontrol_timecost_total) by(url) \u6b64\u805a\u5408\u547d\u4ee4\u7528\u4e8e\u7edf\u8ba1iControl REST\u8bf7\u6c42\u7684\u6b21\u6570\u548c\u603b\u8017\u65f6\uff0c\u7528\u4e8e\u8bc4\u4f30BIG-IP\u7684\u4e0b\u53d1\u6027\u80fd\u60c5\u51b5\u3002","title":"Prometheus\u96c6\u6210"},{"location":"quick-start/prometheus/#prometheus","text":"Prometheus \u662f\u65b0\u4e00\u4ee3\u7684\u4e91\u539f\u751f\u76d1\u63a7\u7cfb\u7edf\uff0c\u548cKubernetes\u6709\u7740\u5929\u7136\u7684\u517c\u5bb9\u5173\u7cfb\uff0c\u6240\u4ee5\u5728CIS-C\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u9996\u63a8\u4f7f\u7528Prometheus\uff0c\u4f5c\u4e3a\u76d1\u63a7\u624b\u6bb5\u5b9e\u73b0CIS-C\u7684\u6027\u80fd\u8bc4\u4f30\u548c\u8fd0\u884c\u72b6\u6001\u6536\u96c6\u3002","title":"Prometheus\u96c6\u6210"},{"location":"quick-start/prometheus/#_1","text":"Prometheus \u7684\u642d\u5efa\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u672c\u6587\u6863\u4e2d\u5c55\u793a\u7684\u662f\u4ee5docker\u65b9\u5f0f\u642d\u5efa\u72ec\u7acb\u7684prometheus\u670d\u52a1\u5668\u7aef\u3002 \u5177\u4f53\u642d\u5efa\u6b65\u9aa4\u5982\u4e0b\uff1a \u7f16\u5199prometheus.yaml \u6b64\u6587\u4ef6\u4e3aprometheus\u6807\u51c6\u914d\u7f6e\u6587\u4ef6\uff0c\u8be6\u7ec6\u53ef\u53c2\u8003 prometheus\u914d\u7f6e\u6587\u4ef6\u6587\u6863 \u3002 \u8fd9\u91cc\uff0c\u6211\u4eec\u4ec5\u914d\u7f6e\u4e86metrics\u6536\u96c6\uff0c\u5e76\u4e0d\u4f7f\u7528alert\u7b49\u914d\u7f6e\u9879\u3002 ``` # my global config global: scrape_interval: 5s # Set the scrape interval to every 15 seconds. Default is every 1 minute. evaluation_interval: 5s # Evaluate rules every 15 seconds. The default is every 1 minute. # scrape_timeout is set to the global default (10s). # Alertmanager configuration alerting: alertmanagers: - static_configs: - targets: # - alertmanager:9093 # Load rules once and periodically evaluate them according to the global 'evaluation_interval'. rule_files: # - \"first_rules.yml\" # - \"second_rules.yml\" # A scrape configuration containing exactly one endpoint to scrape: # Here it's Prometheus itself. scrape_configs: # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config. - job_name: \"prometheus\" # metrics_path defaults to '/metrics' # scheme defaults to 'http'. static_configs: - targets: [\"localhost:9090\"] - job_name: \"f5-kic-1-18\" static_configs: - targets: [\"10.xx.yy.zz:30080\"] ``` \u6211\u4eec\u9700\u8981\u6309\u7167`job_name`\u7684\u65b9\u5f0f\u6dfb\u52a0\u9700\u8981\u6536\u96c6metrics\u7684target\u3002 \u8fd9\u91cc\u768410.xx.yy.zz:30080\u5373\u4e3aCIS-C deployment\u66b4\u9732\u7684prometheus metrics\u76d1\u542c\u7aef\u53e3\u3002 CIS-C deployment\u66b4\u9732prometheus metrics\u76d1\u542c\u7aef\u53e3\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a ``` # expose the Prometheus port with NodePort apiVersion: v1 kind: Service metadata: name: k8s-bigip-ctlr-c-svc namespace: kube-system spec: selector: app: k8s-bigip-ctlr-c-pod ports: - name: k8s-bigip-ctlr-c-metrics protocol: TCP port: 8080 targetPort: 8080 nodePort: 30080 ``` \u7f16\u5199docker-compose.yaml \u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u672c\u5730\u7684prometheus.yaml \u6587\u4ef6\u6302\u8f7d\u5165container\u4e2d\uff1bweb\u7aef\u53e39090\u3002 ``` version: \"3\" services: prometheus_on_k8s_master: image: prom/prometheus:latest volumes: - /root/prometheus/prometheus.yaml:/etc/prometheus/prometheus.yml ports: - 9090:9090 ```","title":"\u670d\u52a1\u5668\u7aef\u642d\u5efa"},{"location":"quick-start/prometheus/#_2","text":"\u76ee\u524dCIS-C\u901a\u8fc7Prometheus\u6536\u96c6\u4e86\u4e1a\u52a1\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\u5404\u4e2a\u5173\u952e\u8282\u70b9\u7684\u65f6\u8017\u6570\u636e\u3002\u5404\u4e2ametrics\u540d\u79f0\u53ca\u542b\u4e49\u5982\u4e0b\uff1a bigip_icontrol_timecost_count\uff1a CIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u9001iControlRest API\u5230BIG-IP\u6570\u91cf\u7d2f\u8ba1\u7edf\u8ba1 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"method\": REST\u8bf7\u6c42\u65b9\u6cd5\uff1aGET POST DELETE PATCH \"url\": BIG-IP url\u540d\u79f0\uff0c\u4ee5\u201c/mgmt/tm/..\u201d\u4e3a\u524d\u7f00\u3002 \u4f8b\u5982\uff1a bigip_icontrol_timecost_count{method=\"GET\",url=\"/mgmt/tm/ltm/snatpool\"} 273 \u8868\u793aCIS-C\u53d1\u9001 /mgmt/tm/ltm/snatpool \u8bf7\u6c42\u7684\u6570\u91cf\u4e3a 273 \uff0c\u8fd9\u4e2a\u6570\u5b57\u4e5f\u5305\u62ec\u4e86\u5bf9\u67d0snatpool\u5bf9\u8c61\u7684\u64cd\u4f5cAPI\uff0c\u4f8b\u5982 DELETE /mgmt/tm/ltm/snatpool/~partitionA~subfolderB~snatpoolC \u3002 bigip_icontrol_timecost_total\uff1a CIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u53d1\u9001iControlRest API\u5230BIG-IP\u8017\u65f6\u7d2f\u8ba1\u7edf\u8ba1 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"method\": REST\u8bf7\u6c42\u65b9\u6cd5\uff1aGET POST DELETE PATCH \"url\": BIG-IP url\u540d\u79f0\uff0c\u4ee5\u201c/mgmt/tm/..\u201d\u4e3a\u524d\u7f00\u3002 \u4e3e\u4f8b\u540c\u4e0a\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2(ms)\u3002 phase_duration_timecost_total\uff1aCIS-C\u5404\u4e2a\u534f\u7a0b\u903b\u8f91\u7684\u8017\u65f6\u603b\u8ba1\u3002 label phase \u8868\u793a\u534f\u7a0b\u540d\u79f0\uff0c\u5305\u62ec\uff1a k8sinformer ltmworker networker respacker ressyncer evreporter . monitored_resource_timecost\uff1aCIS-C\u4e0b\u53d1\u8fc7\u7a0b\u4e2d\u5404\u7ec6\u7c92\u5ea6\u64cd\u4f5c\u8017\u65f6\u3002 \u6b64\u76d1\u63a7\u6307\u6807\u591a\u7528\u4e8e\u7814\u53d1\u8fc7\u7a0b\u4e2d\u7684\u6027\u80fd\u8c03\u4f18\u3002 \u5176\u4e2d\u5404\u4e2alabel\u7684\u542b\u4e49\u5982\u4e0b\uff1a \"request_id\": \u5f53\u524d\u4e0b\u53d1\u8bf7\u6c42\u7684ID\u3002\u4e0b\u53d1\u8bf7\u6c42\u5230\u6765\u540e\uff0cCIS-C\u5185\u90e8\u4f1a\u6839\u636e\u64cd\u4f5c\u4e0d\u540c\uff0c\u5c06\u8bf7\u6c42\u62c6\u89e3\u4e3a\u4e0d\u540c\u7684\u7c7b\u578b\u4ee5\u4e0d\u540c\u7684\u6b65\u9aa4\u6267\u884c\u4e0b\u53d1\uff0c\u6b64ID\u53ef\u4ee5\u5728\u540e\u7eed\u5404\u5904\u7406\u6b65\u9aa4\u4e2d\u6807\u8bc6\u8be5\u6b65\u9aa4\u6765\u81ea\u54ea\u4e2a\u8bf7\u6c42\uff0c\u4fbf\u4e8e\u7d2f\u52a0\u4e0b\u53d1\u603b\u8017\u65f6\u3002 CIS-C\u4f1a\u5bf9\u6bcf\u4e2ak8s\u4e8b\u4ef6\u5206\u914d\u72ec\u7acb\u7684request_id\u3002k8s\u4e8b\u4ef6\u5305\u62ec configmap/endpoints/service/node/namespace\u8d44\u6e90\u7684add\u3001update\u3001delete\u3002 \"kind\": \u4e1a\u52a1\u4e0b\u53d1\u540e\u5728CIS-C\u5185\u90e8\u7684\u5904\u7406\u7c7b\u578b\uff0c\u5305\u62ec \u7f51\u7edc\u5904\u7406\u7c7b\uff1aarp, fdb, k8s\u96c6\u7fa4\u8d44\u6e90\u7c7b\uff1aconfigmap, endpoint, node, service, namespace BIG-IP\u914d\u7f6e\u7c7b\uff1adata-group, pool.members, virtualpool \"name\": \u4e0b\u53d1\u4e1a\u52a1\u5bf9\u5e94\u7684k8s\u8d44\u6e90\u6216BIG-IP\u914d\u7f6e\u540d\u79f0\uff0c\u4f8b\u5982\uff1a default/rest-service-http-configmap \u4e3aconfigmap\u7684namespace \u548cname kube-system/app-svc-2 \u4e3a service\u6216\u8005endpoint \u7684namespace\u548cname app_2_svc_pool \u4e3a BIG-IP\u4e0aPool \u540d\u79f0 \"operation\": \u4e1a\u52a1\u4e0b\u53d1\u7684\u64cd\u4f5c\u8bf7\u6c42\uff0c\u5305\u62ec BIG-IP\u914d\u7f6e\u4e0b\u53d1\u65f6\u7684\u201cdeploy\u201d\u548c\u201cdelete\u201d K8s\u96c6\u7fa4\u4e8b\u4ef6\u5904\u7406\u65f6\u7684\u201cadd\u201d\uff0c\u201cupdate\u201d \u548c\u201cdelete\u201d \"stage\": \u4e1a\u52a1\u4e0b\u53d1\u9636\u6bb5\uff0c\u5305\u62ec \u201cwait\u201d\uff1a\u8868\u793ak8s\u96c6\u7fa4\u4e8b\u4ef6\u88abCIS-C\u63a5\u53d7\u5230\uff0c\u5728\u961f\u5217\u4e2d\u7684\u7b49\u5f85\u65f6\u95f4\u3002 \u201cpack\u201d\uff1a\u8868\u793a\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u9884\u5904\u7406\u7684\u65f6\u95f4\uff0c\u4e0e\u5904\u7406\u8fc7\u7a0b\u662f\u5c06k8s\u4e2d\u7684\u8d44\u6e90\u8f6c\u5316\u4e3aBIG-IP\u53ef\u8bc6\u522b\u7684\u6570\u636e\u7ed3\u6784\u3002 \u201cdeploy\u201d\uff1a\u8868\u793aCIS-C\u64cd\u63a7BIG-IP\u5b9e\u73b0\u4e0b\u53d1\u6240\u7528\u7684\u65f6\u95f4\u3002 function_duration_timecost\uff1a\u51fd\u6570\u7ea7\u522b\u8017\u65f6\u7edf\u8ba1\u3002 \u5176\u4e2d label name \u4e3a\u51fd\u6570\u540d\u79f0\u3002 \u6b64metrics\u4e3b\u8981\u7528\u4f5c\u8ffd\u8e2a\u6027\u80fd\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u7684\u51fd\u6570\u65f6\u8017\u60c5\u51b5\uff0c\u8ba9\u5f00\u53d1\u8005\u5c3d\u65e9\u53d1\u73b0\u5f53\u8d44\u6e90\u6570\u91cf\u589e\u52a0\u65f6\u7684\u6027\u80fd\u74f6\u9888\u70b9\u3002","title":"\u6570\u636e\u6570\u636e\u91c7\u96c6"},{"location":"quick-start/prometheus/#_3","text":"\u5c06CIS-C\u542f\u52a8\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u6027\u80fd\u6d4b\u8bd5\u4e86\uff0cCIS-C\u542f\u52a8\u65b9\u6cd5\u3001\u53c2\u6570\u8bf7\u53c2\u8003 \u4e0b\u8f7d\u4e0e\u5b89\u88c5 \u3002 \u6027\u80fd\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528ansible \u811a\u672c**\u9010\u4e2a**\u521b\u5efa\u591a\u4e2a\u8d44\u6e90\u3002 \u4ee5\u4e0b\u4ee3\u7801\u4f1a\u9010\u4e2a\u521b\u5efa100\u4e2a\u8d44\u6e90\u3002 for n in {0..100}; do ansible-playbook \\ -e src=1.standalone.complex.resources.yaml.j2 \\ -e index=$n -e count=$(($n+1)) \\ -e action=apply \\ 2.0.crud-in-batch.yaml done \u5176\u4e2d 2.0.crud-in-batch.yaml \u7528\u4e8e\u7f16\u6392kubectl\u7684\u8d44\u6e90yaml\u6587\u4ef6\u5e76\u8c03\u7528kubectl\u521b\u5efa\u8d44\u6e90\u3002 \u5b9e\u73b0\u5185\u5bb9\u5982\u4e0b\uff1a --- - hosts: localhost gather_facts: false remote_user: root vars_files: - 0.7.test-vars.json tasks: - name: generate resource yaml template: src: '{{ src }}' dest: ./tmp-resources.yaml - name: executing {{ action }} shell: | kubectl {{ action }} -f tmp-resources.yaml 1.standalone.complex.resources.yaml.j2 \u4e3ajinja2 \u6a21\u677f\u6587\u4ef6\uff1a {% for num in range(index|int, count|int, 1) %} --- apiVersion: apps/v1 kind: Deployment metadata: name: f5-vxlan-test-d{{ num }} namespace: default spec: replicas: 3 selector: matchLabels: run: f5-vxlan-test-d{{ num }} template: metadata: labels: run: f5-vxlan-test-d{{ num }} spec: containers: - image: \"nginx:latest\" imagePullPolicy: IfNotPresent name: f5-vxlan-test-d{{ num }} ports: - containerPort: 80 protocol: TCP --- apiVersion: v1 kind: Service metadata: name: f5-vxlan-test-s{{ num }} namespace: default labels: cis.f5.com/as3-tenant: Tenant-{{ num }} cis.f5.com/as3-app: my-app cis.f5.com/as3-pool: mypool1 spec: ports: - port: 80 protocol: TCP targetPort: 80 selector: run: f5-vxlan-test-d{{ num }} sessionAffinity: None type: ClusterIP --- apiVersion: v1 kind: ConfigMap metadata: labels: f5type: virtual-server as3: \"true\" name: f5-vxlan-test-c{{ num }} namespace: default data: template: | { \"class\": \"AS3\", \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.18.0\", \"id\": \"urn:uuid:33045210-3ab8-4636-9b2a-c98d22ab915d\", \"label\": \"http\", \"remark\": \"application {{ num }} Template\", \"Tenant-{{ num }}\": { \"class\": \"Tenant\", \"my-app\": { \"class\": \"Application\", \"template\": \"generic\", \"foo_ns_vs\": { \"class\": \"Service_HTTP\", \"remark\": \"app in Tenant-{{ num }}\", \"virtualAddresses\": [ \"10.250.{{ 100 + (num/254)|int }}.{{ 1 + num%254 }}\" ], \"profileHTTP\": { \"use\": \"http_X-Forwarded-For\" }, \"persistenceMethods\": [ { \"use\": \"cookie_encryption\" } ], \"iRules\": [ \"myirule\" ], \"pool\": \"mypool1\" }, \"myirule\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool /Tenant-{{ num }}/my-app/mypool1 \\n } else { \\n pool /Tenant-{{ num }}/my-app/mypool2 \\n } \\n}\" }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"http_X-Forwarded-For\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"mymonitor\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"interval\": 5, \"timeout\": 16 }, \"mypool1\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"mypool2\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"mymonitor\" } ], \"loadBalancingMode\": \"least-connections-member\", \"minimumMembersActive\": 0, \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] } } } } } {% endfor %}","title":"\u6027\u80fd\u6d4b\u8bd5\u6570\u636e\u53ca\u65b9\u6cd5"},{"location":"quick-start/prometheus/#_4","text":"\u6d4b\u8bd5\u811a\u672c\u6267\u884c\u7ed3\u675f\u540e\uff0c\u5c31\u53ef\u4ee5\u5728prometheus\u7684UI\u4e0a\u67e5\u770b\u6d4b\u8bd5\u7ed3\u679c\u4e86\uff0c\u5177\u4f53\u7684\u805a\u5408PromSQL\u4e3a\uff1a monitored_resource_timecost sum(monitored_resource_timecost{instance=\"10.xx.yy.zz:30080\"}) by (request_id) \u6b64\u805a\u5408\u6307\u4ee4\u4ee5 request_id \u5212\u5206\uff0c\u5c06\u6765\u81ea 10.xx.yy.zz:30080 \u7684metrics\u6570\u636e\u52a0\u548c\uff08 sum \uff09\uff0c\u8ba1\u7b97 \u5f97\u5230\u5404\u4e2arequest\u7684\u65f6\u95f4\u8017\u65f6\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002 phase_duration_timecost_total \u6b64\u805a\u5408\u547d\u4ee4\u53ef\u4ee5\u7edf\u8ba1CIS-C\u7d2f\u8ba1\u5de5\u4f5c\u65f6\u957f\u3002 bigip_icontrol_timecost_count & bigip_icontrol_timecost_total sum(bigip_icontrol_timecost_count) by(url) sum(bigip_icontrol_timecost_total) by(url) \u6b64\u805a\u5408\u547d\u4ee4\u7528\u4e8e\u7edf\u8ba1iControl REST\u8bf7\u6c42\u7684\u6b21\u6570\u548c\u603b\u8017\u65f6\uff0c\u7528\u4e8e\u8bc4\u4f30BIG-IP\u7684\u4e0b\u53d1\u6027\u80fd\u60c5\u51b5\u3002","title":"\u6d4b\u8bd5\u6570\u636e\u4e0e\u7ed3\u679c\u6837\u4f8b"},{"location":"quick-start/uninstall/","text":"\u5378\u8f7d \u00b6 \u5982\u679c\u90e8\u7f72\u65f6 CIS-C deployment \u7684\u540d\u79f0\u4e3a k8s-bigip-ctlr-c\uff0c\u4e14\u5c5e\u4e8ekube-system \u547d\u540d\u7a7a\u95f4\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u5982\u4e0b\u547d\u4ee4\u5220\u9664 CIS-C deployment\u3002 kubectl delete deployments.apps -n kube-system k8s-bigip-ctlr-c \u8bf7\u8c28\u614e\u505a\u5220\u9664\u7684\u64cd\u4f5c\u3002","title":"\u5378\u8f7d"},{"location":"quick-start/uninstall/#_1","text":"\u5982\u679c\u90e8\u7f72\u65f6 CIS-C deployment \u7684\u540d\u79f0\u4e3a k8s-bigip-ctlr-c\uff0c\u4e14\u5c5e\u4e8ekube-system \u547d\u540d\u7a7a\u95f4\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c\u5982\u4e0b\u547d\u4ee4\u5220\u9664 CIS-C deployment\u3002 kubectl delete deployments.apps -n kube-system k8s-bigip-ctlr-c \u8bf7\u8c28\u614e\u505a\u5220\u9664\u7684\u64cd\u4f5c\u3002","title":"\u5378\u8f7d"}]}